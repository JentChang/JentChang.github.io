<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="keywords" content="机器学习基础：汇总　, Jent 金融 量化 Python MachineLearning">
    <meta name="description" content="这里仅仅是编程的基础，和机器学习算法的简单理解和接口调用随后我会慢慢的对每个机器学习算法的原理性内容进行补充精力有限，这里直接分享了我朋友（郭伟|Welian）汇总的整篇笔记．
数据分析数据分析DAY01什么是数据分析？数据分析是指用适当的">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>机器学习基础：汇总　 | 简•客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

</head>

<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">简•客</span>
                    </a>
                </div>
                <a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Home｜主页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contents" class="waves-effect waves-light">
            
            <i class="fa fa-list-alt"></i>
            
            <span>Contents｜目录</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Tags｜标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories｜分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives｜档案</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About｜关于</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">简•客</div>
        <div class="logo-desc">
            
            一个基于python量化交易主题的博客
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Home｜主页
            </a>
        </li>
        
        <li>
            <a href="/contents" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-list-alt"></i>
                
                Contents｜目录
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Tags｜标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories｜分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives｜档案
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About｜关于
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JentChang" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

    <div class="social-link"><a href="https://github.com/JentChang" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:JentChang@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 1556915227" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JentChang" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>
</header>





<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/8.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        机器学习基础：汇总　
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1,
    #articleContent h2,
    #articleContent h3,
    #articleContent h4,
    #articleContent h5,
    #articleContent h6 {
        padding-top: 76px;
        margin-top: -76px;
    }

    #articleContent h1 {
        line-height: 3.5rem;
    }

    #articleContent h2 {
        line-height: 3.2rem;
    }

    #articleContent h3 {
        line-height: 2.8rem;
    }

    #articleContent h4 {
        line-height: 2.5rem;
    }

    #articleContent h5 {
        line-height: 2.2rem;
    }

    #articleContent h6 {
        line-height: 1.9rem;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            
            <div class="article-tag">
                
                <a href="/tags/Matplotlib/" target="_blank">
                    <span class="chip bg-color">Matplotlib</span>
                </a>
                
                <a href="/tags/Numpy/" target="_blank">
                    <span class="chip bg-color">Numpy</span>
                </a>
                
                <a href="/tags/Sklearn/" target="_blank">
                    <span class="chip bg-color">Sklearn</span>
                </a>
                
                <a href="/tags/数据分析/" target="_blank">
                    <span class="chip bg-color">数据分析</span>
                </a>
                
            </div>
            
            <div class="post-info">
                
                <span class="post-cate">
                    <i class="fa fa-bookmark fa-fw icon-category"></i>
                    
                    <a href="/categories/MachineLearning/" class="post-category" target="_blank">
                        MachineLearning
                    </a>
                    
                </span>
                

                <span class="post-date">
                    <i class="fa fa-clock-o fa-fw"></i>2019-02-26
                </span>
            </div>
        </div>
        <hr>
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><strong>这里仅仅是编程的基础，和机器学习算法的简单理解和接口调用</strong><br><strong>随后我会慢慢的对每个机器学习算法的原理性内容进行补充</strong><br>精力有限，这里直接分享了我朋友（郭伟|Welian）汇总的整篇笔记．</p>
<h1 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h1><h1 id="数据分析DAY01"><a href="#数据分析DAY01" class="headerlink" title="数据分析DAY01"></a>数据分析DAY01</h1><h2 id="什么是数据分析？"><a href="#什么是数据分析？" class="headerlink" title="什么是数据分析？"></a>什么是数据分析？</h2><p>数据分析是指用适当的统计分析方法对收集来的大量数据进行分析，提取有用的信息形成结论而对结论加以详细研究、概括、总结的过程。</p>
<p><strong>使用python做数据分析的常用库</strong></p>
<ol>
<li>numpy        基础数值算法</li>
<li>scipy                科学计算</li>
<li>matplotlib      数据可视化</li>
<li>pandas           序列高级函数</li>
</ol>
<h2 id="numpy概述"><a href="#numpy概述" class="headerlink" title="numpy概述"></a>numpy概述</h2><ol>
<li>Numerical Python, 数值的python，补充了Python语言所欠缺的数值计算能力。</li>
<li>Numpy是其他数据分析及机器学习库的底层库。</li>
<li>Numpy完全标准C语言实现，效率充分优化。</li>
<li>Numpy开源免费。</li>
</ol>
<h3 id="numpy的历史"><a href="#numpy的历史" class="headerlink" title="numpy的历史"></a>numpy的历史</h3><ol>
<li>1995年， Numeric发布（numpy的前身）。  </li>
<li><p>2001年，Scipy-&gt;Numarray，提供多维数组运算。</p>
</li>
<li><p>2005年，Numeric+Numarray -&gt; Numpy</p>
</li>
<li>2006年，Numpy脱离Scipy称为独立项目。</li>
</ol>
<h3 id="numpy的核心：多维数组"><a href="#numpy的核心：多维数组" class="headerlink" title="numpy的核心：多维数组"></a>numpy的核心：多维数组</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> array <span class="token operator">+</span> <span class="token number">10</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="numpy基础"><a href="#numpy基础" class="headerlink" title="numpy基础"></a>numpy基础</h2><h3 id="ndarray数组"><a href="#ndarray数组" class="headerlink" title="ndarray数组"></a>ndarray数组</h3><h4 id="内存中的ndarray对象"><a href="#内存中的ndarray对象" class="headerlink" title="内存中的ndarray对象"></a>内存中的ndarray对象</h4><p><strong>元数据（metadata）</strong></p>
<p>存储对目标数组的描述信息，如：dim count, dimensions, dtype, data等等。</p>
<p><strong>实际数据</strong></p>
<p>完整的数组内容</p>
<p>将实际数据与元数据分开存放，一方面提高了内存空间的使用效率， 另一方面减少对实际数据的访问频率， 提高效率。</p>
<p>Numpy数组是<strong>同质数组</strong>，所有元素的数据类型必须相同。</p>
<h4 id="ndarray对象的创建"><a href="#ndarray对象的创建" class="headerlink" title="ndarray对象的创建"></a>ndarray对象的创建</h4><p>np.array(任何可以被解释为Numpy数组的逻辑结构)</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>np.arange(起始值(0)， 终止值， 步长(1))    </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>np.zeros(数组元素个数, dtype=’类型’)</p>
<p>np.ones(数组元素格式, dtype=’类型’)  </p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int32'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'bool'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ndarray对象属性的基本操作"><a href="#ndarray对象属性的基本操作" class="headerlink" title="ndarray对象属性的基本操作"></a>ndarray对象属性的基本操作</h4><p><strong>数组的维度：</strong>array.shape</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> a<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改数组对象的维度</span>
a<span class="token punctuation">.</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> a<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> a<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>元素的类型：</strong>array.dtype</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 测试元素的类型相关操作</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把b中的每个元素当做float来看</span>
<span class="token comment" spellcheck="true"># 返回新类型的数组</span>
c <span class="token operator">=</span> b<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>数组元素个数：</strong>array.size</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 测试数组元素的个数</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>数组元素索引（下标）</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 测试数组索引操作</span>
c <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0页</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0页 0行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0页 0行 0列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 0页 0行 0列</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> k <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ndarray对象属性操作详解"><a href="#ndarray对象属性操作详解" class="headerlink" title="ndarray对象属性操作详解"></a>ndarray对象属性操作详解</h4><p><strong>Numpy的内部基本数据类型</strong></p>
<table>
<thead>
<tr>
<th>类型名</th>
<th>类型表示符</th>
</tr>
</thead>
<tbody>
<tr>
<td>布尔型</td>
<td>bool_</td>
</tr>
<tr>
<td>有符号整数型</td>
<td>int8(-128~127)/int16/int32/int64</td>
</tr>
<tr>
<td>无符号整型</td>
<td>uint8/uint16/uint32/uint64</td>
</tr>
<tr>
<td>浮点型</td>
<td>float16/float32/float64</td>
</tr>
<tr>
<td>复数型</td>
<td>complex64/complex128</td>
</tr>
<tr>
<td>字符串型</td>
<td>str_ (每个字符32位Unicode编码)</td>
</tr>
</tbody>
</table>
<p><strong>自定义复合类型</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""
demo03_cls.py
测试ndarray的自定义复合类型
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'zs'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'ww'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 第一种设置dtype的方式</span>
<span class="token comment" spellcheck="true"># 3个Unicode字符,3个32位整型组成的列表,整数</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U3, 3int32, int32'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取a数组中第一个元素的第一个字段的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'f0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 第二种设置dtype的方式</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'names'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'scores'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'formats'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'U3'</span><span class="token punctuation">,</span> <span class="token string">'3int32'</span><span class="token punctuation">,</span> <span class="token string">'int32'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'scores'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 第三种设置dtype的方式</span>
c <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'str_'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'scores'</span><span class="token punctuation">,</span> <span class="token string">'int32'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'int32'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 第四种设置dtype的方式</span>
<span class="token comment" spellcheck="true"># 存储数据时，</span>
<span class="token comment" spellcheck="true"># name字段占用8字节，从0字节的位置开始输出</span>
<span class="token comment" spellcheck="true"># scores字段占用12字节，从16字节的位置开始输出</span>
<span class="token comment" spellcheck="true"># 虽然name字段没有把前16个字节充分利用，但是</span>
<span class="token comment" spellcheck="true"># 在内存中字段的位置偏移量是一致的，访问</span>
<span class="token comment" spellcheck="true"># 效率将会得到提高。</span>
d <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'U2'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'scores'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'3int32'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'int32'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 测试日期类型数组</span>
e <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2011'</span><span class="token punctuation">,</span> <span class="token string">'2012-01-01'</span><span class="token punctuation">,</span>
              <span class="token string">'2013-01-01 01:01:01'</span><span class="token punctuation">,</span>
              <span class="token string">'2012-02-01'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> e<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'M8[D]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>类型字符码</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>字符码</th>
</tr>
</thead>
<tbody>
<tr>
<td>np.bool_</td>
<td>?</td>
</tr>
<tr>
<td>np.int8/16/32/64</td>
<td>i1/i2/i4/i8</td>
</tr>
<tr>
<td>np.uint8/16/32/64</td>
<td>u1/u2/u4/u8</td>
</tr>
<tr>
<td>np.float16/32/64</td>
<td>f2/f4/f8</td>
</tr>
<tr>
<td>np.complex64/128</td>
<td>c8/c16</td>
</tr>
<tr>
<td>np.str_</td>
<td>U&lt;字符数&gt;</td>
</tr>
<tr>
<td>np.datetime64</td>
<td>M8[Y / M / D / h / m / s]</td>
</tr>
</tbody>
</table>
<p><strong>ndarray数组对象维度操作</strong></p>
<p><strong>视图变维(数据共享):</strong> reshape()  ravel()</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a <span class="token operator">=</span> a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b <span class="token operator">=</span> a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">999</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>复制变维(数据独立):</strong> flatten()</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 复制变维 数据独立</span>
c <span class="token operator">=</span> a<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>就地变维:</strong> 使用shape属性直接改变原数组对象的维度，不返回新数组。 resize(2, 2)</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 就地变维</span>
c<span class="token punctuation">.</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
c<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ndarray数组对象的切片操作</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 数组切片的参数与列表切片基本一致</span>
<span class="token comment" spellcheck="true"># step+（步长+）：默认从头向后切</span>
<span class="token comment" spellcheck="true"># step-（步长-）：默认从后向前切</span>
array<span class="token punctuation">[</span>start<span class="token punctuation">:</span>end<span class="token punctuation">:</span>step<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>多维数组的切片操作</strong></p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 所有行的最后一列</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ndarray数组的掩码操作</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b <span class="token operator">=</span> a <span class="token operator">>=</span> <span class="token number">60</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span>
indices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出100以内3与7的倍数</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
mask <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>b <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>多维数组的组合与拆分</strong></p>
<p>垂直方向的操作：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在垂直方向a与b摞起来</span>
np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把c数组在垂直方向拆成2个</span>
np<span class="token punctuation">.</span>vsplit<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>水平方向的操作：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在水平方向a与b并起来</span>
np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把c数组在水平方向拆成2个</span>
np<span class="token punctuation">.</span>hsplit<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>深度方向的操作：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在深度方向a与b并起来</span>
np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把c数组在深度方向拆成2个</span>
np<span class="token punctuation">.</span>dsplit<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>多维数组组合与拆分的通用方法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 实现a与b数组的组合操作</span>
<span class="token comment" spellcheck="true"># axis：轴向</span>
<span class="token comment" spellcheck="true"># 如果待组合数组都是二维数组</span>
<span class="token comment" spellcheck="true"># axis：0 垂直方向组合</span>
<span class="token comment" spellcheck="true"># axis：1 水平方向组合</span>
<span class="token comment" spellcheck="true"># 如果待组合数组都是三维数组</span>
<span class="token comment" spellcheck="true"># axis：0 垂直方向组合</span>
<span class="token comment" spellcheck="true"># axis：1 水平方向组合</span>
<span class="token comment" spellcheck="true"># axis：2 深度方向组合</span>
np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把c数组拆成2分  axis为轴向</span>
np<span class="token punctuation">.</span>split<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>长度不等的数组的组合：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 长度不等的数组的组合</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把b补成5个元素, 头部补0个，尾部补1个，</span>
<span class="token comment" spellcheck="true"># 新增元素的默认值为-1</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>
    b<span class="token punctuation">,</span> pad_width<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'constant'</span><span class="token punctuation">,</span>
    constant_values<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单的一维数组的组合方案</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 把a与b两个一维数组摞在一起成两行</span>
np<span class="token punctuation">.</span>row_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把a与b两个一维数组组合在一起成两列</span>
np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ndarray对象的其他常用属性</p>
<ol>
<li>ndim        维数（n维数组的n）</li>
<li>itemsize         元素所占用字节数</li>
<li>nbytes            数组所占用的总字节数</li>
<li>real                 复数的实部</li>
<li>imag               复数的虚部</li>
<li>T                      二维数组的转置数组</li>
<li>flat                  多维数组的扁平迭代器</li>
</ol>
<h2 id="图片资料"><a href="#图片资料" class="headerlink" title="图片资料"></a>图片资料</h2><p><img src="D:\笔记\数据分析\1809\images\matplotlib_cmap.png" alt=""></p>
<p><img src="D:\笔记\数据分析\1809\images\matplotlib_colors.png" alt=""></p>
<p><img src="D:\笔记\数据分析\1809\images\matplotlib_markers.png" alt=""></p>
<p><img src="D:\笔记\数据分析\1809\images\LaTeX_eg.gif" alt=""></p>
<p><img src="D:\笔记\数据分析\1809\images\laTex_.png" alt=""></p>
<h1 id="数据分析DAY02"><a href="#数据分析DAY02" class="headerlink" title="数据分析DAY02"></a>数据分析DAY02</h1><h2 id="matplotlib概述"><a href="#matplotlib概述" class="headerlink" title="matplotlib概述"></a>matplotlib概述</h2><p>matplotlib是python的一个绘图库。使用它可以很方便的绘制出版质量级别的图形。</p>
<h3 id="matplotlib的基本功能"><a href="#matplotlib的基本功能" class="headerlink" title="matplotlib的基本功能"></a>matplotlib的基本功能</h3><ol>
<li>基本绘图<ol>
<li>设置线型、线宽、颜色</li>
<li>设置坐标轴范围及刻度</li>
<li>设置坐标轴属性</li>
<li>图例</li>
<li>绘制特殊点</li>
<li>备注</li>
</ol>
</li>
<li>高级图形绘制<ol>
<li>绘制子图</li>
<li>刻度定位器、刻度网格线</li>
<li>半对数坐标</li>
<li>散点图</li>
<li>填充图</li>
<li>条形图、饼状图</li>
<li>等高线图</li>
<li>热成像图</li>
<li>极坐标系</li>
<li>三维曲面</li>
<li>简单动画</li>
</ol>
</li>
</ol>
<h2 id="matplotlib基本功能详解"><a href="#matplotlib基本功能详解" class="headerlink" title="matplotlib基本功能详解"></a>matplotlib基本功能详解</h2><h3 id="基本绘图"><a href="#基本绘图" class="headerlink" title="基本绘图"></a>基本绘图</h3><h4 id="绘图核心API"><a href="#绘图核心API" class="headerlink" title="绘图核心API"></a>绘图核心API</h4><p>绘制一条线：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token comment" spellcheck="true"># xarray: x坐标值数组</span>
<span class="token comment" spellcheck="true"># yarray: y坐标值数组</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xarray<span class="token punctuation">,</span> yarray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 显示图像</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绘制水平线与垂直线：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token comment" spellcheck="true"># 绘制垂直线 给出x坐标值，给出y的范围即可</span>
mp<span class="token punctuation">.</span>vlines<span class="token punctuation">(</span>val<span class="token punctuation">,</span> ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制水平线 给出y坐标值，给出x的范围即可</span>
mp<span class="token punctuation">.</span>hlines<span class="token punctuation">(</span>val<span class="token punctuation">,</span> xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：绘制一条正弦曲线</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 从-π ~ π拆1000个点</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span>np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
sinx <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制[-π, π]的1/2*cos(x)曲线</span>
cosx <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sinx<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> cosx<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="线型、线宽、颜色"><a href="#线型、线宽、颜色" class="headerlink" title="线型、线宽、颜色"></a>线型、线宽、颜色</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># linestyle: 线型  "-"  "--"  ":" </span>
<span class="token comment" spellcheck="true"># linewidth: 线宽</span>
<span class="token comment" spellcheck="true"># color: 颜色  </span>
<span class="token comment" spellcheck="true">#    常见颜色的英文单词  red  blue  green...</span>
<span class="token comment" spellcheck="true">#    常见英文单词的首字母  r   b ..</span>
<span class="token comment" spellcheck="true">#    #abcdab </span>
<span class="token comment" spellcheck="true">#    (1, 1, 1)  或  (0.8, 0.6, 1, 0.5)</span>
<span class="token comment" spellcheck="true"># alpha: 透明度</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="设置坐标刻度"><a href="#设置坐标刻度" class="headerlink" title="设置坐标刻度"></a>设置坐标刻度</h4><p>把横坐标的刻度显示为 -π,  -π/2, 0,  π/2,  π</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># x_val_list: x轴刻度值列表</span>
<span class="token comment" spellcheck="true"># x_text_list: x轴相应值的刻度文本列表</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>x_val_list<span class="token punctuation">,</span> x_text_list<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># y_val_list: y轴刻度值列表</span>
<span class="token comment" spellcheck="true"># y_text_list: y轴相应值的刻度文本列表</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span>y_val_list<span class="token punctuation">,</span> y_text_list<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>matplotlib支持的latex排版语法</strong></p>
<pre><code>r&#39;$a^2 + b^2 = c^2$&#39;  
r&#39;$[a_1 + a_2 + ... + a_n]$&#39;  
r&#39;$\frac{\pi}{2}$&#39;
</code></pre><p>$$<br>a^2 + b^2 = c^2 \quad \quad<br>[a_1 + a_2 + … + a_n] \quad\quad<br>\frac{\pi}{2}<br>$$</p>
<h4 id="设置坐标轴"><a href="#设置坐标轴" class="headerlink" title="设置坐标轴"></a>设置坐标轴</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取当前坐标轴  'left' 'right' 'top' 'bottom'</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取其中某一个坐标轴</span>
ax_left <span class="token operator">=</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 设置坐标轴的位置</span>
<span class="token comment" spellcheck="true"># type: 移动坐标轴的参照类型 一般为'data' （以数据坐标轴作参照）</span>
<span class="token comment" spellcheck="true"># val: 参照值</span>
ax_left<span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置坐标轴的颜色</span>
<span class="token comment" spellcheck="true"># color: 颜色值   若为'none',则隐藏当前坐标轴</span>
ax_left<span class="token punctuation">.</span>set_color<span class="token punctuation">(</span>color<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h4><p>显示两条曲线的图例。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在plot绘制曲线时，给出label描述当前曲线的标签。</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  label<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="特殊点"><a href="#特殊点" class="headerlink" title="特殊点"></a>特殊点</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># xarray, yarray 散点的坐标</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>xarray<span class="token punctuation">,</span> yarray<span class="token punctuation">,</span> 
          marker<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 点型</span>
          s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 大小</span>
          edgecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 边缘色</span>
          facecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 填充色</span>
          zorder<span class="token operator">=</span><span class="token number">3</span>        <span class="token comment" spellcheck="true"># 绘制图层编号（越大越靠顶层）</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><p>为特殊点添加备注。</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>
    r<span class="token string">'$....$'</span><span class="token punctuation">,</span>                     <span class="token comment" spellcheck="true"># 备注文本</span>
    xycoords<span class="token operator">=</span><span class="token string">'data'</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 定位目标点使用的参照坐标系</span>
    xy<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token comment" spellcheck="true"># 目标点的坐标</span>
    textcoords<span class="token operator">=</span><span class="token string">'offset points'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 定位文本位置使用的坐标系</span>
    xytext<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 备注文本的位置坐标</span>
    fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true"># 字体大小</span>
    arrowprops<span class="token operator">=</span>dict<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 箭头的样式</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">arrowprops<span class="token operator">=</span>dict<span class="token punctuation">(</span>
    arrowstyle<span class="token operator">=</span><span class="token string">'->'</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 箭头样式</span>
    connectionstyle<span class="token operator">=</span><span class="token string">'angle3'</span>    <span class="token comment" spellcheck="true"># 箭头连接线的样式</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="设置坐标轴的范围"><a href="#设置坐标轴的范围" class="headerlink" title="设置坐标轴的范围"></a>设置坐标轴的范围</h4><p>通过设置坐标轴的范围区间，可以显示图像中的一部分内容。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 设置x轴的可视区域</span>
mp<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span> x_max<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置y轴的可视区域</span>
mp<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span> y_max<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="matplotlib图像窗口高级操作"><a href="#matplotlib图像窗口高级操作" class="headerlink" title="matplotlib图像窗口高级操作"></a>matplotlib图像窗口高级操作</h3><p>绘制两个窗口：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># title：窗口的标题</span>
<span class="token comment" spellcheck="true"># figsize： 窗口的大小</span>
<span class="token comment" spellcheck="true"># dpi：像素密度</span>
<span class="token comment" spellcheck="true"># facecolor：图表的背景色</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>mp.ffigure方法可以创建一个新的窗口，但是如果新窗口的title已经被创建过了，那么就把该title的旧窗口置为当前窗口，以后的绘图操作，都将针对当前窗口生效。</p>
<p><strong>设置当前窗口的参数</strong></p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 设置图表标题</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># x轴的描述文本</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># y轴的描述文本</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 设置刻度参数</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 绘制网格线</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># 紧凑布局</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="窗口子图"><a href="#窗口子图" class="headerlink" title="窗口子图"></a>窗口子图</h4><p><strong>矩阵式布局</strong></p>
<p>绘制矩阵式布局子图的API：</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># rows: 行数</span>
<span class="token comment" spellcheck="true"># columns: 列数</span>
<span class="token comment" spellcheck="true"># num: 子图编号 </span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 把3行3列的5号图设置为当前绘图区域</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 把3行3列的1号图设置为当前绘图区域</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：绘制九宫格</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Subplot'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 在窗前绘图区域写文字</span>
    mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span>
    mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>网格式布局</strong></p>
<p>网格式布局支持单元格的合并。</p>
<p>绘制网格式子图相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>gridspec <span class="token keyword">as</span> mg
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 创建GridSpec对象，（3行3列）</span>
gs <span class="token operator">=</span> mg<span class="token punctuation">.</span>GridSpec<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把GridSpec中第一行的前两列合并为一个子图</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>gridspec <span class="token keyword">as</span> mg

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Grid'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>

gs <span class="token operator">=</span> mg<span class="token punctuation">.</span>GridSpec<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>gs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>自由布局</strong></p>
<p>自由布局相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置图表的位置，需要给出左下角点坐标与宽、高即可</span>
<span class="token comment" spellcheck="true"># 0.03: 左下角点的横坐标</span>
<span class="token comment" spellcheck="true"># 0.04: 左下角点的纵坐标</span>
<span class="token comment" spellcheck="true"># 0.94: 图表的宽度</span>
<span class="token comment" spellcheck="true"># 0.92: 图表的高度</span>
mp<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.03</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token punctuation">,</span> <span class="token number">0.94</span><span class="token punctuation">,</span> <span class="token number">0.92</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'FlowLayou'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>
        va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="刻度定位器"><a href="#刻度定位器" class="headerlink" title="刻度定位器"></a>刻度定位器</h4><p>设置坐标轴刻度定位器相关的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取当前坐标轴</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置横轴的主刻度定位器为多点定位器，主刻度间隔为1</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_major_locator<span class="token punctuation">(</span>mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置横轴的次刻度定位器为NullLocator()（将不会显示次刻度）</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_minor_locator<span class="token punctuation">(</span> mp<span class="token punctuation">.</span>NullLocator<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

locators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'mp.NullLocator()'</span><span class="token punctuation">,</span>
            <span class="token string">'mp.MaxNLocator(nbins=6)'</span><span class="token punctuation">,</span>
            <span class="token string">'mp.MultipleLocator(1)'</span><span class="token punctuation">,</span>
            <span class="token string">'mp.AutoLocator()'</span><span class="token punctuation">,</span>
            <span class="token string">'mp.FixedLocator(locs=[0,2.5,7.5,10])'</span><span class="token punctuation">]</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Locator'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>locators<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>len<span class="token punctuation">(</span>locators<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'right'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    mp<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    mp<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 设置x轴的主刻度定位器</span>
    ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_major_locator<span class="token punctuation">(</span>eval<span class="token punctuation">(</span>locators<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 设置x轴的次刻度定位器</span>
    ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_minor_locator<span class="token punctuation">(</span>mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="刻度网格线"><a href="#刻度网格线" class="headerlink" title="刻度网格线"></a>刻度网格线</h4><pre class="line-numbers language-python"><code class="language-python">ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制刻度网格线</span>
ax<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>
    which<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 'major''minor' 绘制主刻度/次刻度网格线</span>
    axis<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 'x'/'y'/'both' 绘制x轴/y轴的刻度网格线</span>
    linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> 
    linestyle<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    alpha<span class="token operator">=</span><span class="token number">0.5</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：[1,10,100,1000,100,10,1]</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'GridLine'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'GridLine'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置刻度定位器与刻度网格线</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_major_locator<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_minor_locator<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>set_major_locator<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>set_minor_locator<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>MultipleLocator<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置x与y轴的主刻度网格线</span>
ax<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 设置x与y轴的次刻度网格线</span>
ax<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>which<span class="token operator">=</span><span class="token string">'minor'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">)</span>


mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">'o-'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'plot'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="半对数坐标轴"><a href="#半对数坐标轴" class="headerlink" title="半对数坐标轴"></a>半对数坐标轴</h4><p>y轴将会以指数方式递增。</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># mp.plot()改为mp.semilogy()方法绘制曲线即可</span>
mp<span class="token punctuation">.</span>semilogy<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h4><p>numpy.random模块提供了normal函数用于产生符合正态分布的随机数。</p>
<pre class="line-numbers language-python"><code class="language-python">n <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment" spellcheck="true"># 产生n个符合正态分布规律的随机数</span>
<span class="token comment" spellcheck="true"># 172：期望</span>
<span class="token comment" spellcheck="true"># 20：标准差（标准差越小，越集中；标准差越大，越分散）</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绘制散点图的相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span>
    marker<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    facecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    zorder<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

n <span class="token operator">=</span> <span class="token number">500</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Students'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Students List'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>
           color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
           zorder<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Stduent'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="数据分析DAY03"><a href="#数据分析DAY03" class="headerlink" title="数据分析DAY03"></a>数据分析DAY03</h1><h4 id="散点图-1"><a href="#散点图-1" class="headerlink" title="散点图"></a>散点图</h4><p>散点图颜色映射的使用。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># d 为大于0的整数，这样计算越靠近中心的样本</span>
<span class="token comment" spellcheck="true"># d的值越小，越靠近外周的样本d的值越大</span>
d <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">172</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>d<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">,</span>
           zorder<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Stduent'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="填充图"><a href="#填充图" class="headerlink" title="填充图"></a>填充图</h4><p>以某种颜色自动填充两条曲线的闭合区域。</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> sin_x<span class="token punctuation">,</span> cos_x<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 通过这3个参数，给出两条曲线</span>
    sin_x <span class="token operator">&lt;</span> cos_x<span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 填充条件，若为True时填充</span>
    color<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    alpha<span class="token operator">=</span><span class="token number">0.5</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绘制两条曲线：sin(x)  cos(x/2)/2  [0, 8π]</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

n <span class="token operator">=</span> <span class="token number">1000</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
sinx <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
cosx <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Fill'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Fill'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sinx<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span>r<span class="token string">'$y=sin(x)$'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> cosx<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span>r<span class="token string">'$y=\frac{1}{2}cos(\frac{x}{2})$'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> sinx<span class="token punctuation">,</span> cosx<span class="token punctuation">,</span> sinx <span class="token operator">&lt;</span> cosx<span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> sinx<span class="token punctuation">,</span> cosx<span class="token punctuation">,</span> sinx <span class="token operator">></span> cosx<span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="条形图（柱状图）"><a href="#条形图（柱状图）" class="headerlink" title="条形图（柱状图）"></a>条形图（柱状图）</h4><pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 水平坐标数组</span>
    y<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 每个柱子绘制的高度</span>
    width<span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 每个柱子的宽度</span>
    color<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 颜色</span>
    label<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 标签名（供legend使用）</span>
    alpha<span class="token operator">=</span><span class="token number">0.5</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

apples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">]</span>
oranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">]</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Bar'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Bar'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Price'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>apples<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制条形图</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">0.2</span><span class="token punctuation">,</span> apples<span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
       label<span class="token operator">=</span><span class="token string">'Apple'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">,</span> oranges<span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
       label<span class="token operator">=</span><span class="token string">'Orange'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span>
    <span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span>
    <span class="token string">'Nov'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="饼状图"><a href="#饼状图" class="headerlink" title="饼状图"></a>饼状图</h4><p>绘制饼状图相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>
    values<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 值列表</span>
    spaces<span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 扇形之间的间距列表</span>
    labels<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 标签列表</span>
    colors<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 颜色列表</span>
    <span class="token string">'%d%%'</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 标签所占比例的格式化字符串</span>
    shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 是否添加阴影</span>
    startangle<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 起始角度</span>
    radius<span class="token operator">=</span><span class="token number">1</span>        <span class="token comment" spellcheck="true"># 大饼半径</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

<span class="token comment" spellcheck="true"># 整理数据</span>
values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span>
spaces <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">]</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token string">'Javascript'</span><span class="token punctuation">,</span>
          <span class="token string">'C++'</span><span class="token punctuation">,</span> <span class="token string">'Java'</span><span class="token punctuation">,</span> <span class="token string">'PHP'</span><span class="token punctuation">]</span>
colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> <span class="token string">'orangered'</span><span class="token punctuation">,</span>
          <span class="token string">'limegreen'</span><span class="token punctuation">,</span> <span class="token string">'violet'</span><span class="token punctuation">,</span> <span class="token string">'gold'</span><span class="token punctuation">]</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Pie'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Pie'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'equal'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 设置等轴比例绘制</span>
mp<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>values<span class="token punctuation">,</span> spaces<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> colors<span class="token punctuation">,</span>
       <span class="token string">'%d%%'</span><span class="token punctuation">,</span> shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> startangle<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span>
       radius<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="等高线图"><a href="#等高线图" class="headerlink" title="等高线图"></a>等高线图</h4><p>整理等高线数据需要网格点坐标矩阵，也需要每个点的高度，所以等高线属于3D数学模型的范畴。</p>
<p>绘制等高线的相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">cntr <span class="token operator">=</span> mp<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 网格点坐标</span>
    z<span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># z提供每个坐标点的高度</span>
    <span class="token number">8</span><span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 把整体的高度分8份</span>
    colors<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 每条等高线的颜色</span>
    linewidths<span class="token operator">=</span><span class="token number">0.5</span>    <span class="token comment" spellcheck="true"># 每条等高线的宽度</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为等高线添加标签</span>
mp<span class="token punctuation">.</span>clabel<span class="token punctuation">(</span>cntr<span class="token punctuation">,</span> inline_spacing<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'%.1f'</span><span class="token punctuation">,</span> 
          fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为等高线每一部分设置颜色</span>
mp<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

n <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token comment" spellcheck="true"># 获取网格点坐标矩阵数组</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
                   np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 通过x与y计算每个坐标点的高度（编的）</span>
z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> x<span class="token operator">**</span><span class="token number">5</span> <span class="token operator">+</span> y<span class="token operator">**</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> \
    np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">-</span> y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制等高线</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Contour'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Contour'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
cntr <span class="token operator">=</span> mp<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> colors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span>
                  linewidths<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为等高线添加标签</span>
mp<span class="token punctuation">.</span>clabel<span class="token punctuation">(</span>cntr<span class="token punctuation">,</span> inline_spacing<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
          fmt<span class="token operator">=</span><span class="token string">'%.1f'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为等高线每一部分设置颜色</span>
mp<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="热成像图"><a href="#热成像图" class="headerlink" title="热成像图"></a>热成像图</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 把矩阵z图形化，使用cmap的颜色表示矩阵中每个元素的热度值</span>
<span class="token comment" spellcheck="true"># origin：y轴方向</span>
<span class="token comment" spellcheck="true">#     'lower'  y轴的0在下方</span>
<span class="token comment" spellcheck="true">#     'upper'  y轴的0在上方</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>z<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

n <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token comment" spellcheck="true"># 获取网格点坐标矩阵数组</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
                   np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 通过x与y计算每个坐标点的高度（编的）</span>
z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> x<span class="token operator">**</span><span class="token number">5</span> <span class="token operator">+</span> y<span class="token operator">**</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> \
    np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">-</span> y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Hot'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Hot'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制热成像图</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>z<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3D图像的绘制"><a href="#3D图像的绘制" class="headerlink" title="3D图像的绘制"></a>3D图像的绘制</h4><p>使用matplotlib绘制3D图像，需要先获取3D坐标轴，调用ax3d对象的方法绘制3D图形。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> axes3d
ax3d <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>

ax3d<span class="token punctuation">.</span>plot_wireframe<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax3d<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax3d<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>3D线框图</strong></p>
<pre class="line-numbers language-python"><code class="language-python">ax3d<span class="token punctuation">.</span>plot_wireframe<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 网格点坐标矩阵，和每个点的z轴值</span>
    rstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 行跨距</span>
    cstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 列跨距</span>
    linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 线宽</span>
    color<span class="token operator">=</span><span class="token string">''</span>        <span class="token comment" spellcheck="true"># 颜色</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> axes3d
n <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token comment" spellcheck="true"># 获取网格点坐标矩阵数组</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
                   np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 通过x与y计算每个坐标点的高度（编的）</span>
z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> x<span class="token operator">**</span><span class="token number">5</span> <span class="token operator">+</span> y<span class="token operator">**</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> \
    np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">-</span> y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'WireFrame'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot_wireframe<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> rstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> cstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>3D曲面图</strong></p>
<pre class="line-numbers language-python"><code class="language-python">ax3d<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> 
    rstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> cstride<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>3D散点图</strong></p>
<pre class="line-numbers language-python"><code class="language-python">ax3d<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 样本点的(x,y,z)坐标数组</span>
    marker<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 点型</span>
    s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 点的大小</span>
    zorder<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    facecolor<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    c<span class="token operator">=</span>d<span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 颜色值数组</span>
    cmap<span class="token operator">=</span><span class="token string">''</span>        <span class="token comment" spellcheck="true"># 所使用的颜色映射</span>
<span class="token punctuation">)</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> axes3d
n <span class="token operator">=</span> <span class="token number">500</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
z <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>

d <span class="token operator">=</span> x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> y<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> z<span class="token operator">**</span><span class="token number">2</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'3D Scatter'</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>d<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="极坐标系"><a href="#极坐标系" class="headerlink" title="极坐标系"></a>极坐标系</h4><p>某些情况下极坐标系适合显示与角度有关的图像，例如雷达。它可以处理极径&rho;(rho)与极角&theta;(theta)之间的线性关系。</p>
<pre class="line-numbers language-python"><code class="language-python">mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projecction<span class="token operator">=</span><span class="token string">'polar'</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token number">0.8</span><span class="token operator">*</span>t
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

t <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">*</span> t

x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Polar'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'polar'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="简单动画"><a href="#简单动画" class="headerlink" title="简单动画"></a>简单动画</h4><p>动画即是在一段时间内快速连续重新绘制图像的过程。</p>
<p>matplotlib提供了方法可以实现简单动画，定义一个update函数用于即时更新图像。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>animation <span class="token keyword">as</span> ma
<span class="token comment" spellcheck="true"># update中编写更新图像的代码，每隔一段时间将会自动调用</span>
<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token comment" spellcheck="true"># 每隔30毫秒，执行一次update函数，针对当前窗体绘制图像</span>
anim <span class="token operator">=</span> ma<span class="token punctuation">.</span>FuncAnimation<span class="token punctuation">(</span>mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>animation <span class="token keyword">as</span> ma

n <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment" spellcheck="true"># 初始化100个球，每个属性值都是0.0</span>
balls <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">[</span>
                <span class="token punctuation">(</span><span class="token string">'position'</span><span class="token punctuation">,</span> float<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span> float<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'growth'</span><span class="token punctuation">,</span> float<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> float<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 初始化所有球的属性</span>
<span class="token comment" spellcheck="true"># 为每个球的position属性赋值</span>
<span class="token comment" spellcheck="true"># 获取n行2列的二维数组，每个元素从0到1平均分布</span>
balls<span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span> <span class="token operator">=</span>    \
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
balls<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">=</span> \
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
balls<span class="token punctuation">[</span><span class="token string">'growth'</span><span class="token punctuation">]</span> <span class="token operator">=</span> \
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
balls<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span> <span class="token operator">=</span> \
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Animation'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把100个球都先画出来</span>
sc <span class="token operator">=</span> mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>balls<span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                balls<span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                balls<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                color<span class="token operator">=</span>balls<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 让每个球都不断增大</span>
    balls<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> balls<span class="token punctuation">[</span><span class="token string">'growth'</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 每次让一个气泡破裂， 随机生成一个新的</span>
    boom_ind <span class="token operator">=</span> number <span class="token operator">%</span> n
    balls<span class="token punctuation">[</span>boom_ind<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">=</span> \
        np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    balls<span class="token punctuation">[</span>boom_ind<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span> <span class="token operator">=</span> \
        np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># 重新设置属性</span>
    sc<span class="token punctuation">.</span>set_sizes<span class="token punctuation">(</span>balls<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>set_offsets<span class="token punctuation">(</span>balls<span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

anim <span class="token operator">=</span> ma<span class="token punctuation">.</span>FuncAnimation<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">,</span>  interval<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用生成器函数提供数据，实现动画绘制</p>
<p>很多情况下，绘制动画的参数是动态获取的，matplotlib支持定义生成生成器函数，用于生成数据，然后自动把数据交给update函数更新图像：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>·

<span class="token keyword">def</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> data
<span class="token comment" spellcheck="true"># 每10毫秒，调用生成器，把生成器yield出的数据交给update函数执行</span>
anim <span class="token operator">=</span> ma<span class="token punctuation">.</span>FuncAnimation<span class="token punctuation">(</span>mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">,</span> generator<span class="token punctuation">,</span>
                           interval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>animation <span class="token keyword">as</span> ma

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">"Signal"</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Signal"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
pl <span class="token operator">=</span> mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
             label<span class="token operator">=</span><span class="token string">'Signal'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
x <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t<span class="token punctuation">,</span> v <span class="token operator">=</span> data
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> pl<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    pl<span class="token punctuation">.</span>set_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 动态的移动可视区域</span>
    <span class="token keyword">if</span> x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>
        mp<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> x
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">*</span> \
        np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> x<span class="token punctuation">,</span> y
    x <span class="token operator">+=</span> <span class="token number">0.05</span>

<span class="token comment" spellcheck="true"># 使用动画向plot绘制的曲线中添加x，y坐标</span>
anim <span class="token operator">=</span> ma<span class="token punctuation">.</span>FuncAnimation<span class="token punctuation">(</span>
    mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">,</span> generator<span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="案例应用"><a href="#案例应用" class="headerlink" title="案例应用"></a>案例应用</h2><h3 id="加载文件"><a href="#加载文件" class="headerlink" title="加载文件"></a>加载文件</h3><p>numpy提供了加载逻辑上可以被解释为二维数组的文本文件：</p>
<pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../data/aapl.csv'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 文本路径</span>
    delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 列之间的分隔符</span>
    usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 读取哪些列</span>
    unpack<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true"># 是否拆包 False将会返回二维数组</span>
    dtype<span class="token operator">=</span><span class="token string">"U10, U10, f8"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 元素的类型</span>
    converters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> func<span class="token punctuation">}</span>    <span class="token comment" spellcheck="true"># 转换器函数字典</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：绘制收盘价折线图</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
loadtxt.py 加载文件
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> datetime <span class="token keyword">as</span> dt
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>dates <span class="token keyword">as</span> md


<span class="token keyword">def</span> <span class="token function">dmy2ymd</span><span class="token punctuation">(</span>dmy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 28-10-2011  -> 2011-10-28</span>
    <span class="token comment" spellcheck="true"># 把字符串转成日期对象，在按照需要的</span>
    <span class="token comment" spellcheck="true"># 格式把日期对象转成字符串</span>
    dmy <span class="token operator">=</span> str<span class="token punctuation">(</span>dmy<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    time <span class="token operator">=</span> dt<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>
        dmy<span class="token punctuation">,</span> <span class="token string">'%d-%m-%Y'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token keyword">return</span> t

dates<span class="token punctuation">,</span> opening_prices<span class="token punctuation">,</span> highest_prices<span class="token punctuation">,</span> \
    lowest_prices<span class="token punctuation">,</span> closing_prices <span class="token operator">=</span> \
    np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../da_data/aapl.csv'</span><span class="token punctuation">,</span>
               delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>
               usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
               dtype<span class="token operator">=</span><span class="token string">'M8[D], f8, f8, f8, f8'</span><span class="token punctuation">,</span>
               converters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> dmy2ymd<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 把收盘价绘制为折线图</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'APPL'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'APPL'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Dates'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Prices'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为了x轴显示日期，设置刻度定位器</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_major_locator<span class="token punctuation">(</span>
    md<span class="token punctuation">.</span>WeekdayLocator<span class="token punctuation">(</span>byweekday<span class="token operator">=</span>md<span class="token punctuation">.</span>MO<span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_major_formatter<span class="token punctuation">(</span>
    md<span class="token punctuation">.</span>DateFormatter<span class="token punctuation">(</span><span class="token string">'%d %b %Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_minor_locator<span class="token punctuation">(</span>md<span class="token punctuation">.</span>DayLocator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改dates的数据类型 从M8[D] -></span>
dates <span class="token operator">=</span> dates<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>md<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> closing_prices<span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Closing Prices'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="数据分析DAY04"><a href="#数据分析DAY04" class="headerlink" title="数据分析DAY04"></a>数据分析DAY04</h1><h3 id="加载文件-1"><a href="#加载文件-1" class="headerlink" title="加载文件"></a>加载文件</h3><p>案例：绘制AAPL的K线图.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制每一天的蜡烛图：</span>
rise <span class="token operator">=</span> closing_prices <span class="token operator">>=</span> opening_prices
<span class="token comment" spellcheck="true"># 整理所有的填充色</span>
color <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'white'</span> <span class="token keyword">if</span> x <span class="token keyword">else</span> <span class="token string">'limegreen'</span><span class="token punctuation">)</span>
     <span class="token keyword">for</span> x <span class="token keyword">in</span> rise<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 整理所有的边缘色</span>
edgecolor <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'red'</span> <span class="token keyword">if</span> x <span class="token keyword">else</span> <span class="token string">'limegreen'</span><span class="token punctuation">)</span>
     <span class="token keyword">for</span> x <span class="token keyword">in</span> rise<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制影线</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highest_prices <span class="token operator">-</span> lowest_prices<span class="token punctuation">,</span>
       <span class="token number">0.1</span><span class="token punctuation">,</span> lowest_prices<span class="token punctuation">,</span> color<span class="token operator">=</span>edgecolor<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制实体</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> closing_prices <span class="token operator">-</span> opening_prices<span class="token punctuation">,</span>
       <span class="token number">0.8</span><span class="token punctuation">,</span> opening_prices<span class="token punctuation">,</span> color<span class="token operator">=</span>color<span class="token punctuation">,</span>
       edgecolor<span class="token operator">=</span>edgecolor<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="算数平均数"><a href="#算数平均数" class="headerlink" title="算数平均数"></a>算数平均数</h3><p>算数平均数表示对真值的无偏估计。</p>
<pre><code>A = [a1, a2, a3, ... an]
mean = (a1 + a2 + a3 + ... + an) / n
</code></pre><p>numpy提供了方法求一组数据的均值：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1.</span>
m <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 2.</span>
m <span class="token operator">=</span> array<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制收盘价的均值水平线</span>
mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>closing_prices<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>hlines<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> dates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
          label<span class="token operator">=</span><span class="token string">'average(closing_prices)'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="加权平均值"><a href="#加权平均值" class="headerlink" title="加权平均值"></a>加权平均值</h3><pre><code>S = [s1, s2, s3, .. sn]
W = [w1, w2, w3, .. wn]
# 加权均值：
aw = (s1w1 + s2w2 + ... sn*wn)/(w1+w2+...wn)
</code></pre><p>相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># a: 原始样本数组</span>
<span class="token comment" spellcheck="true"># b: 与原始样本数组相对应的权重数组</span>
np<span class="token punctuation">.</span>average<span class="token punctuation">(</span>a<span class="token punctuation">,</span> weights<span class="token operator">=</span>b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>VWAP - 交易量加权平均价格（成交量体现了市场对于当前交易价格的认可度， 成交量加权平均价格将会更接近这只股票的价值）</p>
<p>案例：</p>
<pre class="line-numbers language-pythoon"><code class="language-pythoon"># VWAP 交易量加权平均价格
vwap = np.average(closing_prices,
                  weights=volumns)
mp.hlines(vwap, dates[0], dates[-1],
          color='limegreen', linewidth=2,
          label='VWAP')

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>TWAP-时间加权平均价格</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># TWAP 时间加权平均价格</span>
times <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span>
times <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
twap <span class="token operator">=</span> np<span class="token punctuation">.</span>average<span class="token punctuation">(</span>closing_prices<span class="token punctuation">,</span>weights<span class="token operator">=</span>times<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>hlines<span class="token punctuation">(</span>twap<span class="token punctuation">,</span> dates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          color<span class="token operator">=</span><span class="token string">'gold'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
          label<span class="token operator">=</span><span class="token string">'TWAP'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="最值"><a href="#最值" class="headerlink" title="最值"></a>最值</h3><pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回一组数据的最大值</span>
np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回一组数据的最小值</span>
np<span class="token punctuation">.</span>ptp<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回一组数据的极差 (max-min)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回一组数据最大值的下标</span>
np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>a<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># 返回一组数据最小值的下标</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 求最值</span>
max_highest <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>highest_prices<span class="token punctuation">)</span>
min_lowest <span class="token operator">=</span> np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>lowest_prices<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>max_highest <span class="token operator">-</span> min_lowest<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 求最高点、最低点的日期</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dates<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>highest_prices<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dates<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>lowest_prices<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 将两个同维数组中对应位置的元素进行比较，把最大的保留。返回新数组</span>
np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 将两个同维数组中对应位置的元素进行比较，把最小的保留。返回新数组</span>
np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="中位数"><a href="#中位数" class="headerlink" title="中位数"></a>中位数</h3><p>将多个样本按照大小排序，取中间位置的元素。</p>
<p>如果样本个数为奇数，则为中间的数字。如果样本个数为偶数，则求两个中间数字的均值即可。</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span>排序过的数组<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
median <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>size<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>a<span class="token punctuation">.</span>size<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

<span class="token comment" spellcheck="true"># 对数组排序</span>
sc <span class="token operator">=</span> np<span class="token punctuation">.</span>msort<span class="token punctuation">(</span>closing_prices<span class="token punctuation">)</span>
m2 <span class="token operator">=</span> <span class="token punctuation">(</span>sc<span class="token punctuation">[</span>int<span class="token punctuation">(</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span>
      sc<span class="token punctuation">[</span>int<span class="token punctuation">(</span>sc<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>median<span class="token punctuation">,</span> m2<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 求a数组的中位数</span>
np<span class="token punctuation">.</span>median<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="标准差"><a href="#标准差" class="headerlink" title="标准差"></a>标准差</h3><p>一组数据的标准差可以衡量这组数据的离散程度。标准差越大代表这组样本越散。反之，则代表这组样本越集中。</p>
<p>样本：S = [s1, s2, s3 …,  sn]</p>
<p>均值：m = (s1 + s2 + … + sn) / n</p>
<p>离差：D = [s1-m, s2-m, s3-m …. , sn-m]</p>
<p>离差方： D<sup>2</sup>  -&gt; [q1, q2, q3 …. qn]    每个元素求平方</p>
<p>总体方差：(q1+q2+…qn) / <strong>n</strong>  离差方数组的均值</p>
<p>总体标准差：np.sqrt(总体方差)   </p>
<p>样本方差： (q1+q2+…qn) / <strong>n-1</strong>  离差方数组的均值</p>
<p>样本标准差：np.sqrt(样本方差)   </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 求array数组的总体标准差</span>
np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 求array数组的样本标准差，分母的修正值：n-1</span>
np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>array<span class="token punctuation">,</span> ddof<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

closing_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../da_data/aapl.csv'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>
    usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 求这组数据的标准差</span>
m <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>closing_prices<span class="token punctuation">)</span>
s <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>closing_prices <span class="token operator">-</span> m<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
std <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span>

std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>closing_prices<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span>

std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>closing_prices<span class="token punctuation">,</span> ddof<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="案例应用-1"><a href="#案例应用-1" class="headerlink" title="案例应用"></a>案例应用</h3><h4 id="案例：轴向统计"><a href="#案例：轴向统计" class="headerlink" title="案例：轴向统计"></a>案例：轴向统计</h4><p>统一每个周一、周二、.. 周五的收盘价的平均值，并放入一个数组。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> datetime <span class="token keyword">as</span> dt


<span class="token keyword">def</span> <span class="token function">dmy2day</span><span class="token punctuation">(</span>dmy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 日月年字符串转成星期</span>
    dmy <span class="token operator">=</span> str<span class="token punctuation">(</span>dmy<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> dt<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>
        dmy<span class="token punctuation">,</span> <span class="token string">'%d-%m-%Y'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
    wday <span class="token operator">=</span> date<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wday

wdays<span class="token punctuation">,</span> closing_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../da_data/aapl.csv'</span><span class="token punctuation">,</span>
    delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> converters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> dmy2day<span class="token punctuation">}</span><span class="token punctuation">)</span>

ave_closing_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> wday <span class="token keyword">in</span> range<span class="token punctuation">(</span>ave_closing_prices<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ave_closing_prices<span class="token punctuation">[</span>wday<span class="token punctuation">]</span> <span class="token operator">=</span> \
        np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>closing_prices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> wday<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>ave_closing_prices<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：统一每个周一、周二、.. 周五的收盘价的平均值，最大值，最小值，并放入一个数组。</p>
<p>numpy提供了一个方法可以方便的实现<strong>二维数据的轴向汇总</strong>。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token comment" spellcheck="true"># 根据轴向的设定，把每一行（列）依次传递给func函数实现统计业务</span>
<span class="token comment" spellcheck="true"># func： 处理函数</span>
<span class="token comment" spellcheck="true"># axis： 轴向  0  1</span>
<span class="token comment" spellcheck="true"># array： 原二维数组</span>
np<span class="token punctuation">.</span>apply_along_axis<span class="token punctuation">(</span>func<span class="token punctuation">,</span> axis<span class="token punctuation">,</span> array<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo08_axis.py  轴向统计
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> datetime <span class="token keyword">as</span> dt


<span class="token keyword">def</span> <span class="token function">dmy2day</span><span class="token punctuation">(</span>dmy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 日月年字符串转成星期</span>
    dmy <span class="token operator">=</span> str<span class="token punctuation">(</span>dmy<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> dt<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>
        dmy<span class="token punctuation">,</span> <span class="token string">'%d-%m-%Y'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
    wday <span class="token operator">=</span> date<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wday

wdays<span class="token punctuation">,</span> closing_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../da_data/aapl.csv'</span><span class="token punctuation">,</span>
    delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> converters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> dmy2day<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 第一个周一的下标， 最后一个周五的下标</span>
<span class="token comment" spellcheck="true"># np.where方法返回一个元组，数据存储在[0]中</span>
first_mon <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>wdays <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
last_fri <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>wdays <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
wdays <span class="token operator">=</span> wdays<span class="token punctuation">[</span>first_mon<span class="token punctuation">:</span> last_fri <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>

indices <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>first_mon<span class="token punctuation">,</span> last_fri <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 整理这些数据为一个二维数组</span>
mon_inds <span class="token operator">=</span> indices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>
tue_inds <span class="token operator">=</span> indices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span>
wen_inds <span class="token operator">=</span> indices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">]</span>
thu_inds <span class="token operator">=</span> indices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">]</span>
fri_inds <span class="token operator">=</span> indices<span class="token punctuation">[</span>wdays <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 把不足6个元素的数组补齐</span>
mon_inds <span class="token operator">=</span> np<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>
    mon_inds<span class="token punctuation">,</span> pad_width<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mode<span class="token operator">=</span><span class="token string">'constant'</span><span class="token punctuation">,</span> constant_values<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 把这些数据在垂直方向摞在一起，执行轴向汇总</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>mon_inds<span class="token punctuation">,</span> tue_inds<span class="token punctuation">,</span> wen_inds<span class="token punctuation">,</span>
     thu_inds<span class="token punctuation">,</span> fri_inds<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">:</span>
    row <span class="token operator">=</span> row<span class="token punctuation">[</span>row <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>closing_prices<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> \
        np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>closing_prices<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    \
        np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>closing_prices<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> np<span class="token punctuation">.</span>apply_along_axis<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="案例：移动平均线"><a href="#案例：移动平均线" class="headerlink" title="案例：移动平均线"></a>案例：移动平均线</h4><p>收盘价5日平均线：从第五天开始，每天计算最近5天的收盘价的平均值所构成的一条线。</p>
<p>移动均线的算法：</p>
<pre><code>(a + b + c + d + e) / 5     均线的第1个点
(b + c + d + e + f) / 5     均线的第2个点
....
</code></pre><p>案例：绘制5日均线图</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 求5日均线</span>
sma5 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>closing_prices<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>sma5<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sma5<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> closing_prices<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sma5<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'SMA-5'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="卷积运算"><a href="#卷积运算" class="headerlink" title="卷积运算"></a>卷积运算</h4><p>a = [1, 2, 3, 4, 5]     原数组</p>
<p>b = [8, 7, 6]        卷积核数组</p>
<p>使用b数组作为卷积核对a数组执行卷积运算的过程如下：</p>
<pre><code>                44    65    86            - 有效卷积(valid)
            23    44    65    86    59        - 同维卷积(same)
        8    23    44    65    86    59    30    - 完全卷积(full)
0    0    1    2    3    4    5    0    0
6    7    8
    6    7    8
        6    7    8
            6    7    8
                6    7    8
                    6    7    8
                        6    7    8
</code></pre><p>卷积运算相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># a: 原数组</span>
<span class="token comment" spellcheck="true"># b: 卷积核数组</span>
<span class="token comment" spellcheck="true"># 卷积类型： </span>
<span class="token comment" spellcheck="true">#     'valid'    有效卷积</span>
<span class="token comment" spellcheck="true">#     'same'    同维卷积</span>
<span class="token comment" spellcheck="true">#     'full'    完全卷积</span>
np<span class="token punctuation">.</span>convole<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> 卷积类型<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>a b c d e f g h i j k l ....
b = [1/5, 1/5, 1/5, 1/5, 1/5] 
</code></pre><p>案例： 使用卷积实现5日均线</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用卷积 实现5日均线</span>
core <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span>
sma52 <span class="token operator">=</span> np<span class="token punctuation">.</span>convolve<span class="token punctuation">(</span>closing_prices<span class="token punctuation">,</span> core<span class="token punctuation">,</span>
                    <span class="token string">'valid'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sma52<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'SMA-52'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用卷积 实现10日均线</span>
core <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
sma510 <span class="token operator">=</span> np<span class="token punctuation">.</span>convolve<span class="token punctuation">(</span>closing_prices<span class="token punctuation">,</span> core<span class="token punctuation">,</span>
                     <span class="token string">'valid'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sma510<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'limegreen'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'SMA-10'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>加权卷积</strong></p>
<p>5日均线中计算的平均值为算数平均值，但是每个样本应该有不同的权重。按照时间加权均值的算法，时间越晚权重越高。所以可以选出一组卷积核，使得在卷积运算中实现加权卷积。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 实现加权5日均线</span>
weights <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
weights <span class="token operator">=</span> weights<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 处理卷积核数组，使得卷积核中元素之和为1</span>
weights <span class="token operator">/=</span> weights<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
sma53 <span class="token operator">=</span> np<span class="token punctuation">.</span>convolve<span class="token punctuation">(</span>closing_prices<span class="token punctuation">,</span>
                    weights<span class="token punctuation">,</span> <span class="token string">'valid'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sma53<span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'SMA-53'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="布林带"><a href="#布林带" class="headerlink" title="布林带"></a>布林带</h4><p>布林带由三条线组成：</p>
<p>中轨：移动均线</p>
<p>上轨：中轨 + 2*5日标准差</p>
<p>下轨：中轨 -  2*5日标准差</p>
<p>布林带收窄代表股价趋于稳定，布林带张开代表有较大的波动空间。</p>
<h1 id="数据分析DAY05"><a href="#数据分析DAY05" class="headerlink" title="数据分析DAY05"></a>数据分析DAY05</h1><h3 id="案例应用-2"><a href="#案例应用-2" class="headerlink" title="案例应用"></a>案例应用</h3><h4 id="布林带-1"><a href="#布林带-1" class="headerlink" title="布林带"></a>布林带</h4><p>布林带由三条线组成：</p>
<p>中轨：移动均线</p>
<p>上轨：中轨 + 2*5日标准差</p>
<p>下轨：中轨 -  2*5日标准差</p>
<p>布林带收窄代表股价趋于稳定，布林带张开代表有较大的波动空间。</p>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制5日均线的布林带</span>
stds <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>sma53<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>stds<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> closing_prices<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 计算上轨和下轨</span>
lowers <span class="token operator">=</span> sma53 <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> stds
uppers <span class="token operator">=</span> sma53 <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> stds

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lowers<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'gold'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Lower Line'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> uppers<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'gold'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Upper Line'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="线性预测"><a href="#线性预测" class="headerlink" title="线性预测"></a>线性预测</h3><p>若想使用线性方程预测业务结果，则必须首先假设数据样本符合线性规律。这样预测的结果才会相对准确。</p>
<pre><code>假设这组数据符合线性规律：

a    b    c    d    e    f    ?

ax + by + cz = d
bx + cy + dz = e
cx + dy + ez = f
...
dx + ey + fz = ?
</code></pre><p>基于矩阵运算解方程组：<br>$$<br>\left[<br>\begin{matrix}<br>a &amp; b &amp; c \<br>b &amp; c &amp; d \<br>c &amp; d &amp; e \<br>\end{matrix}<br>\right]<br>\times<br>\left[<br>\begin{matrix}<br>x \<br>y \<br>z \<br>\end{matrix}<br>\right]<br>=<br>\left[<br>\begin{matrix}<br>d \<br>e \<br>f \<br>\end{matrix}<br>\right]  \ \<br>\quad \quad a \quad \quad \quad \quad x \quad \quad \quad b<br>$$<br>numpy提供了方法可以求取上述矩阵运算中的x,y,z.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># a、b矩阵参数同上图所示</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>lstsq<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：基于线性预测，预测下一天的收盘价。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 整理三元一次方程组， 实现线性预测</span>
N <span class="token operator">=</span> <span class="token number">5</span>
pred_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>
    closing_prices<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把每一个预测值都求出来</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>pred_prices<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 整理矩阵a与矩阵b，使用lstsq方法求出x</span>
    a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">[</span>j<span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token operator">=</span> closing_prices<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">:</span>i <span class="token operator">+</span> j <span class="token operator">+</span> N<span class="token punctuation">]</span>
    b <span class="token operator">=</span> closing_prices<span class="token punctuation">[</span>i <span class="token operator">+</span> N<span class="token punctuation">:</span>i <span class="token operator">+</span> N <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>lstsq<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># b与x执行点积运算</span>
    pred_prices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 画出预测股价曲线</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> N<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pred_prices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'o-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Predict Line'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>pred_prices<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="线性拟合"><a href="#线性拟合" class="headerlink" title="线性拟合"></a>线性拟合</h3><p>线性拟合可以寻求与一组散点走向趋势规律相适应的线性表达式方程。</p>
<pre><code>[x1, y1]
[x2, y2]
[x3, y3]
..
[xn, yn]
</code></pre><p>若这组点符合线性规律，那么就可以使用二元线性方程拟合这组数据。</p>
<pre><code>kx + b = y
kx1 + b = y1
kx2 + b = y2
kx3 + b = y3
...
kxn + b = yn
</code></pre><p>如何求k与b：<br>$$<br>\left[<br>\begin{matrix}<br>x1 &amp; 1 \<br>x2 &amp; 1 \<br>x3 &amp; 1 \<br>xn &amp; 1 \<br>\end{matrix}<br>\right]<br>\times<br>\left[<br>\begin{matrix}<br>k \<br>b \<br>\end{matrix}<br>\right]<br>=<br>\left[<br>\begin{matrix}<br>y1 \<br>y2 \<br>y3 \<br>yn \<br>\end{matrix}<br>\right]<br>$$<br>案例：利用线性拟合画出股价的趋势线。</p>
<p>股价的趋势线 = (最高价+最低价+收盘价) / 3</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 计算所有的趋势点</span>
trend_points <span class="token operator">=</span> <span class="token punctuation">(</span>
    highest_prices <span class="token operator">+</span> lowest_prices <span class="token operator">+</span>
    closing_prices<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span>

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> trend_points<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Trend Points'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 一组x坐标</span>
days <span class="token operator">=</span> dates<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'M8[D]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>days<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>days<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> trend_points
<span class="token comment" spellcheck="true"># 通过a与b求x</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>lstsq<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 求该直线的所有x对应的函数值</span>
y <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> days <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Trend Line'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制顶部压力线  底部支撑线</span>
spreads <span class="token operator">=</span> highest_prices <span class="token operator">-</span> lowest_prices
resistance_points <span class="token operator">=</span> y <span class="token operator">+</span> spreads
support_points <span class="token operator">=</span> y <span class="token operator">-</span> spreads

mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> resistance_points<span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Resistance Line'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> support_points<span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'limegreen'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Support Line'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="数组的裁剪、压缩、累乘"><a href="#数组的裁剪、压缩、累乘" class="headerlink" title="数组的裁剪、压缩、累乘"></a>数组的裁剪、压缩、累乘</h3><p><strong>数组的裁剪</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># clip方法将会把数组中所有小于下限的元素改为下限值。把所有大于上限</span>
<span class="token comment" spellcheck="true"># 的元素改为上限值。</span>
ndarray<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>min<span class="token operator">=</span>下限<span class="token punctuation">,</span> max<span class="token operator">=</span>上限<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>数组的压缩</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 返回由调用数组中满足条件的元素组成的新数组</span>
ndarray<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>条件<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">5</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> a<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

a <span class="token operator">=</span> a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
c <span class="token operator">=</span> a<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">[</span>a <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">,</span> a <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="协方差、相关性系数"><a href="#协方差、相关性系数" class="headerlink" title="协方差、相关性系数"></a>协方差、相关性系数</h3><p>通过两组统计数据计算而得的协方差可以评估这两组统计数据的相似程度。</p>
<p><strong>样本：</strong></p>
<pre><code>A = [a1, a2, a3 ... an]
B = [b1, b2, b3 ... bn]
</code></pre><p><strong>平均值：</strong></p>
<pre><code>ave_A = (a1 + a2 + a3 + ... an) / n
ave_B = (b1 + b2 + b3 + ... bn) / n
</code></pre><p><strong>离差：</strong></p>
<pre><code>dev_A = [a1, a2 .. an] - ave_A
dev_B = [b1, b2 .. bn] - ave_B
</code></pre><p><strong>协方差：</strong></p>
<pre><code>cov_ab = np.mean(dev_A * dev_B)
</code></pre><p>协方差可以简单反映两组统计样本的相关性：值为正，则为正相关；值为负则为负相关。绝对值越大相关性越强。</p>
<p>案例：计算bhp与vale两只股票的协方差。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 计算两组样本的协方差</span>
<span class="token comment" spellcheck="true"># 两组样本的均值</span>
ave_bhp <span class="token operator">=</span> bhp_closing_prices<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>    \
    <span class="token operator">/</span> bhp_closing_prices<span class="token punctuation">.</span>size
ave_vale <span class="token operator">=</span> vale_closing_prices<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>    \
    <span class="token operator">/</span> vale_closing_prices<span class="token punctuation">.</span>size
<span class="token comment" spellcheck="true"># 两组样本的离差</span>
dev_bhp <span class="token operator">=</span> bhp_closing_prices <span class="token operator">-</span> ave_bhp
dev_vale <span class="token operator">=</span> vale_closing_prices <span class="token operator">-</span> ave_vale
<span class="token comment" spellcheck="true"># 两组样本的协方差</span>
cov_array <span class="token operator">=</span> dev_bhp <span class="token operator">*</span> dev_vale
cov <span class="token operator">=</span> cov_array<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> cov_array<span class="token punctuation">.</span>size
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'COV:'</span><span class="token punctuation">,</span> cov<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>相关性系数</strong></p>
<p>协方差除以两组统计样本的标准差的乘积是一个[-1, 1]之间的数字。该结果成为两组统计样本的相关性系数。</p>
<p>通过相关性系数可以分析两组数据的相关程度：</p>
<pre><code>若相关系数越接近于1， 则表示两组样本正相关程度越强。
若相关系数越接近于-1， 则表示两组样本负相关程度越强。
若相关系数越接近于0， 则表示两组样本没啥关系。
</code></pre><p>numpy提供了求相关性系数的API：</p>
<pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该方法将会返回<strong>相关性矩阵</strong>:<br>$$<br>\left[ \begin{matrix}<br>a与a的相关性系数 &amp; a与b的相关性系数 \<br>b与a的相关性系数 &amp; b与b的相关性系数  \<br>\end{matrix}\right]<br>$$<br>该矩阵的算法：<br>$$<br>\left[ \begin{matrix}<br>\frac{a与a的协方差}{std(a) <em> std(a)} &amp;<br>\frac{a与b的协方差}{std(a) </em> std(b)} \<br>\frac{b与a的协方差}{std(b) <em> std(a)} &amp;<br>\frac{b与b的协方差}{std(b) </em> std(b)} \<br>\end{matrix}\right]<br>$$<br>求a与b的协方差矩阵：</p>
<pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>cov<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 返回的协方差矩阵即是相关性矩阵的分子矩阵</span>

<span class="token comment" spellcheck="true"># 输出两组数据的协方差矩阵</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>cov<span class="token punctuation">(</span>bhp_closing_prices<span class="token punctuation">,</span> vale_closing_prices<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="多项式拟合"><a href="#多项式拟合" class="headerlink" title="多项式拟合"></a>多项式拟合</h3><p>多项式的一般形式：<br>$$<br>y = p_0x^n + p_1x^{n-1} + p_2x^{n-2} + … + p_n<br>$$<br>多项式拟合的目的是为了找到一组p<sub>0</sub>~p<sub>n</sub> , 使得拟合方程尽可能的域实际样本数据相符合（误差最小）。</p>
<p>在numpy中，一组p<sub>0</sub>~p<sub>n</sub>即可以表示一个多项式。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 根据一组离散样本，给出最高次幂，求出拟合多项式结果的系数数组。</span>
<span class="token comment" spellcheck="true"># P = [p0, p1 ... pn]</span>
P <span class="token operator">=</span> np<span class="token punctuation">.</span>polyfit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> 最高次幂<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 给出自变量x，该方法将把x代入多项式，求出函数值。</span>
Y <span class="token operator">=</span> np<span class="token punctuation">.</span>polyval<span class="token punctuation">(</span>P<span class="token punctuation">,</span> x<span class="token punctuation">)</span> 

<span class="token comment" spellcheck="true"># 求多项式函数的导函数  （Q = [q1, q2 ... qm]）</span>
Q <span class="token operator">=</span> np<span class="token punctuation">.</span>polyder<span class="token punctuation">(</span>P<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 求多项式的根（y等于0是x的取值）</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>roots<span class="token punctuation">(</span>P<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：使用多项式函数拟合两只股票bhp、vale收盘价的差价函数。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 修改dates的数据类型 从M8[D] -></span>
dates <span class="token operator">=</span> dates<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>md<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 求出两支股票的差价</span>
diff_prices <span class="token operator">=</span> bhp_closing_prices <span class="token operator">-</span> vale_closing_prices
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> diff_prices<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'DIFF LINE'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 多项式拟合</span>
days <span class="token operator">=</span> dates<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'M8[D]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
P <span class="token operator">=</span> np<span class="token punctuation">.</span>polyfit<span class="token punctuation">(</span>days<span class="token punctuation">,</span> diff_prices<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>polyval<span class="token punctuation">(</span>P<span class="token punctuation">,</span> days<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Polyfit Line'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 多项式求导，求导函数的根从而获取驻点坐标</span>
Q <span class="token operator">=</span> np<span class="token punctuation">.</span>polyder<span class="token punctuation">(</span>P<span class="token punctuation">)</span>
xs <span class="token operator">=</span> np<span class="token punctuation">.</span>roots<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 驻点的x坐标</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span>
ys <span class="token operator">=</span> np<span class="token punctuation">.</span>polyval<span class="token punctuation">(</span>P<span class="token punctuation">,</span> xs<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 驻点的y坐标</span>
xs_date <span class="token operator">=</span> np<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>
    <span class="token string">'M8[D]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>md<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>xs_date<span class="token punctuation">,</span> ys<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'limegreen'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Points'</span><span class="token punctuation">,</span>
           zorder<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="数据分析DAY06"><a href="#数据分析DAY06" class="headerlink" title="数据分析DAY06"></a>数据分析DAY06</h1><h3 id="数据平滑"><a href="#数据平滑" class="headerlink" title="数据平滑"></a>数据平滑</h3><p>数据平滑处理通常包含有降噪、拟合等操作。降噪的功能在于去除额外的影响因素， 拟合的目的在于数据数学模型化，可以通过更多数学工具识别曲线的特征。</p>
<h3 id="符号数组"><a href="#符号数组" class="headerlink" title="符号数组"></a>符号数组</h3><p>np.sign()函数可以把样本数组编程对应的符号数组，正数变为1，负数变为-1，0还是0。</p>
<pre class="line-numbers language-python"><code class="language-python">array <span class="token operator">=</span> np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>原数组<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>OBV能量潮</strong></p>
<p>成交量可以反映市场对某只股票的人气，成交量是一支股票上涨的能量。一支股票上涨往往需要较大的成交量，而下跌时则不然。</p>
<p>若相比上一天的收盘价上涨，则为正成交量；若相比上一天的收盘价下跌，则为负成交量。 正成交量为红色柱状图，负成交量为绿色柱状图。</p>
<p>案例：绘制OBV柱状图</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制OBV能量潮</span>
<span class="token comment" spellcheck="true"># 从第二天开始，减去前一天的收盘价得到新数组</span>
diff_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>diff<span class="token punctuation">(</span>closing_prices<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对diff_prices符号化</span>
sign_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>diff_prices<span class="token punctuation">)</span>
obvs <span class="token operator">=</span> volumns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">*</span> sign_prices
<span class="token comment" spellcheck="true"># 正成交量为红色  负成交量为红色</span>
dates <span class="token operator">=</span> dates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>dates<span class="token punctuation">[</span>obvs <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obvs<span class="token punctuation">[</span>obvs <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
       color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'OBV+'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>dates<span class="token punctuation">[</span>obvs <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span>obvs<span class="token punctuation">[</span>obvs <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
       color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'OBV-'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>数据处理函数</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 针对原数组的每个元素做条件判断，取相应的值</span>
<span class="token comment" spellcheck="true"># 条件序列：[array&lt;60, array>=60]</span>
<span class="token comment" spellcheck="true"># 取值序列：[-1, 1]</span>
ary <span class="token operator">=</span> np<span class="token punctuation">.</span>piecewise<span class="token punctuation">(</span>原数组，条件序列，取值序列<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">sign_prices <span class="token operator">=</span> np<span class="token punctuation">.</span>piecewise<span class="token punctuation">(</span>
    diff_prices<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>diff_prices <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> diff_prices <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span>
     diff_prices <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="函数矢量化"><a href="#函数矢量化" class="headerlink" title="函数矢量化"></a>函数矢量化</h3><p>把一个只能处理标量的函数矢量化后，将可以直接处理数组参数。</p>
<p>numpy提供了vectorize函数，可以把处理标量的函数矢量化，返回一个新的函数（矢量函数），该矢量函数可以直接处理ndarray数组。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math <span class="token keyword">as</span> m


<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> m<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>a<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> b<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 调用vectorize方法把foo函数矢量化</span>
vec_foo <span class="token operator">=</span> np<span class="token punctuation">.</span>vectorize<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>vec_foo<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>numpy还提供了frompyfunc函数，也可以完成与vectorize相同的功能。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 调用frompyfunc函数把foo函数矢量化</span>
<span class="token comment" spellcheck="true"># 矢量化foo函数，接收2个参数，返回1个结果</span>
fpf_foo <span class="token operator">=</span> np<span class="token punctuation">.</span>frompyfunc<span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fpf_foo<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="矩阵对象"><a href="#矩阵对象" class="headerlink" title="矩阵对象"></a>矩阵对象</h3><p>numpy中的matrix类型的对象即是矩阵对象。该类继承自numpy.ndarray所以任何针对多维数组的操作，对矩阵对象同样有效。作为子类，矩阵也结合了自身的特点，做了必要的扩充，比如：乘法计算、求逆等。</p>
<p><strong>矩阵对象的创建</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 创建矩阵对象</span>
<span class="token comment" spellcheck="true"># ary：任何可以被解释为矩阵的二维容器</span>
<span class="token comment" spellcheck="true"># copy：是否复制数据（默认为True）</span>
numpy<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span>ary<span class="token punctuation">,</span> copy<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 等价于 numpy.matrix(ary, copy=False)</span>
<span class="token comment" spellcheck="true"># 创建出的矩阵对象与原数组数据共享</span>
numpy<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>任何可以被解释为矩阵的二维容器<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 矩阵字符串拼块规则：'1 2 3; 4 5 4; 6 4 3'</span>
numpy<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>矩阵字符串拼块规则<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>矩阵的乘法(点积)</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">45</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'1 2 3; 5 6 4; 3 4 5'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'1 2 3; 5 6 4; 3 4 5'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>矩阵的逆</strong></p>
<p>一个矩阵乘以该矩阵的逆矩阵得到的结果为一个单位矩阵(E)。一个单位矩阵对角线上的元素都是1，其他元素都为0。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#A矩阵的逆矩阵：</span>
A<span class="token punctuation">.</span>I
np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">45</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>I<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a<span class="token punctuation">.</span>I<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：假设一帮人去旅游， 去程做的是大巴，小孩票价3元，大人3.2元。共花了118.4； 回来时坐火车，小孩票价3.5元，大人3.6元。共花了135.2. 求大人和小孩的人数。<br>$$<br>\left[<br>\begin{matrix}<br>3 &amp; 3.2 \<br>3.5 &amp; 3.6 \<br>\end{matrix}<br>\right]<br>\times<br>\left[<br>\begin{matrix}<br>x\<br>y \<br>\end{matrix}<br>\right]<br>=<br>\left[<br>\begin{matrix}<br>118.4 \<br>135.2 \<br>\end{matrix}<br>\right]<br>$$</p>
<pre class="line-numbers language-python"><code class="language-python">prices <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'3 3.2; 3.5 3.6'</span><span class="token punctuation">)</span>
totals <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'118.4; 135.2'</span><span class="token punctuation">)</span>
persons <span class="token operator">=</span> prices<span class="token punctuation">.</span>I <span class="token operator">*</span> totals
<span class="token keyword">print</span><span class="token punctuation">(</span>persons<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>斐波那契数列</strong></p>
<p>1    1    2    3    5    8    13    21    ….</p>
<pre><code>     1 1    1 1        1 1        1 1
     1 0    1 0        1 0        1 0
----------------------------------------------
1 1     2 1    3 2        5 3        8 5
1 0     1 1    2 1        3 2        5 3
</code></pre><p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">A <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'1 1; 1 0'</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> <span class="token number">35</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>A<span class="token operator">**</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="numpy通用函数"><a href="#numpy通用函数" class="headerlink" title="numpy通用函数"></a>numpy通用函数</h3><h4 id="加法通用函数"><a href="#加法通用函数" class="headerlink" title="加法通用函数"></a>加法通用函数</h4><pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
np<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># a与b两数组对应位置元素相加</span>
np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>a<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># a所有元素的累加和</span>
np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回累加和的过程数组</span>
np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>outer<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 列表与a数组的外和</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>add<span class="token punctuation">.</span>outer<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="乘法通用函数"><a href="#乘法通用函数" class="headerlink" title="乘法通用函数"></a>乘法通用函数</h4><pre class="line-numbers language-python"><code class="language-python">ndarray<span class="token punctuation">.</span>prod<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 返回a数组中所有元素累乘的结果</span>
np<span class="token punctuation">.</span>prod<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
ndarray<span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回a数组中所有元素累乘的过程</span>
np<span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>outer<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 外积</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="除法通用函数"><a href="#除法通用函数" class="headerlink" title="除法通用函数"></a>除法通用函数</h4><pre class="line-numbers language-python"><code class="language-python">np<span class="token punctuation">.</span>true_divide<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#  a除以b</span>
np<span class="token punctuation">.</span>divide<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#  等价于上一个API</span>
np<span class="token punctuation">.</span>floor_divide<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#  地板除</span>
np<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#  取天花板整数</span>
np<span class="token punctuation">.</span>trunc<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#  取截断整数</span>
np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>divide<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>floor_divide<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>trunc<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="位运算通用函数"><a href="#位运算通用函数" class="headerlink" title="位运算通用函数"></a>位运算通用函数</h4><p><strong>位异或</strong></p>
<pre class="line-numbers language-python"><code class="language-python">c <span class="token operator">=</span> a <span class="token operator">^</span> b
c <span class="token operator">=</span> np<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>按位异或操作可以方便的判断两个数据是否同号。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>
c <span class="token operator">=</span> np<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>c <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>位与</strong></p>
<pre><code>e = a &amp; b
e = np.bitwise_and(a, b)
</code></pre><p>利用位与运算计算某个数字是否是2的幂</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1  2^0  00001        0    00000</span>
<span class="token comment" spellcheck="true"># 2  2^1  00010        1    00001</span>
<span class="token comment" spellcheck="true"># 4  2^2  00100        3    00011</span>
<span class="token comment" spellcheck="true"># 8  2^3  01000        7    00111</span>
<span class="token comment" spellcheck="true"># 16 2^4  10000        15    01111</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">45</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>位或</strong></p>
<pre class="line-numbers language-python"><code class="language-python">f <span class="token operator">=</span> a <span class="token operator">|</span> b
f <span class="token operator">=</span> np<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>位反</strong></p>
<pre><code>g = ~a 
g = np.bitwise_not(a)
</code></pre><p><strong>移位</strong></p>
<pre><code>&lt;&lt;    np.left_shift() 
&gt;&gt;    np.right_shift()
</code></pre><h4 id="三角函数通用函数"><a href="#三角函数通用函数" class="headerlink" title="三角函数通用函数"></a>三角函数通用函数</h4><p>np.sin() 、np.cos()等三角函数都属于矢量函数，都可以处理数组数据。<br>$$<br>y = Asin(wx + \phi) + C<br>$$<br><strong>傅里叶定理</strong></p>
<p>法国科学家傅里叶说过：所有周期性的函数都是有n多个不同振幅、不同频率、不同初相位的正弦函数叠加而成。<br>$$<br>y = 4\pi \times sin(x) \<br>y = \frac{4}{3}\pi \times sin(3x) \<br>y = \frac{4}{5}\pi \times sin(5x) \<br>y = \frac{4}{7}\pi \times sin(7x) \<br>… \<br>y = \frac{4}{2n-1}\pi \times sin((2n-1)x) \<br>$$<br>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
y1 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y2 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
y3 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
y4 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">7</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 叠加1000个波形</span>
n <span class="token operator">=</span> <span class="token number">1000</span>
y <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y <span class="token operator">+=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> \
        np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Sin'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sin'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'sin(x)'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'sin(3x)'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y3<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'sin(5x)'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y4<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'sin(7x)'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'total'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="矩阵的广义逆矩阵"><a href="#矩阵的广义逆矩阵" class="headerlink" title="矩阵的广义逆矩阵"></a>矩阵的广义逆矩阵</h3><p>如果一个方阵A与另一个方阵B的乘积是一个单位矩阵，A与B互为逆矩阵。</p>
<pre><code>np.linalg.inv(A) -&gt; B
A.I
</code></pre><p>将以上有关逆矩阵的定义推广到非方阵，则成为广义逆矩阵。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'11 12 11 14;20 21 21 23;19 18 11 16'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b <span class="token operator">=</span> a<span class="token punctuation">.</span>I
<span class="token comment" spellcheck="true">#b = np.linalg.inv(a)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>解线性方程组</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用最小二乘法求取结果</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>lstsq<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 解线性方程组</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>$$<br>\begin{cases}<br>x-2y+z=0 \<br>2y-8z-8=0 \<br>-4x+5y+9z+9=0<br>\end{cases}<br>$$</p>
<p>整理矩阵：<br>$$<br>\left[\begin{matrix}<br>1 &amp; -2 &amp; 1\<br>0 &amp; 2 &amp; -8\<br>-4 &amp; 5 &amp; 9\<br>\end{matrix}\right]<br>\times<br>\left[\begin{matrix}<br>x\<br>y\<br>z\<br>\end{matrix}\right]<br>=<br>\left[\begin{matrix}<br>0\<br>8\<br>-9\<br>\end{matrix}\right]<br>$$</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'1 -2 1; 0 2 -8; -4 5 9'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'0; 8; -9'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="特征值与特征向量"><a href="#特征值与特征向量" class="headerlink" title="特征值与特征向量"></a>特征值与特征向量</h4><p>对于n阶方阵A，如果存在数a与非零n维列向量x，使得Ax=ax， 则称a是矩阵A的一个特征值，x是矩阵A属于特征值a的特征向量。</p>
<p>提取特征值与特征向量的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 已知n阶方阵A， 求特征值与特征向量</span>
<span class="token comment" spellcheck="true"># eigvals：特征值数组</span>
<span class="token comment" spellcheck="true"># eigvecs：对应的特征向量数组</span>
eigvals<span class="token punctuation">,</span> eigvecs <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 已知特征值与特征向量，求方阵</span>
S <span class="token operator">=</span> eigvecs <span class="token operator">*</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eigvals<span class="token punctuation">)</span> <span class="token operator">*</span> eigvecs<span class="token punctuation">.</span>I
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="数据分析DAY07"><a href="#数据分析DAY07" class="headerlink" title="数据分析DAY07"></a>数据分析DAY07</h1><h4 id="特征值与特征向量-1"><a href="#特征值与特征向量-1" class="headerlink" title="特征值与特征向量"></a>特征值与特征向量</h4><p>对于n阶方阵A，如果存在数a与非零n维列向量x，使得Ax=ax， 则称a是矩阵A的一个特征值，x是矩阵A属于特征值a的特征向量。</p>
<p>提取特征值与特征向量的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 已知n阶方阵A， 求特征值与特征向量</span>
<span class="token comment" spellcheck="true"># eigvals：特征值数组</span>
<span class="token comment" spellcheck="true"># eigvecs：对应的特征向量数组</span>
eigvals<span class="token punctuation">,</span> eigvecs <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 已知特征值与特征向量，求方阵</span>
S <span class="token operator">=</span> eigvecs <span class="token operator">*</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eigvals<span class="token punctuation">)</span> <span class="token operator">*</span> eigvecs<span class="token punctuation">.</span>I
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

A <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token string">'1 6 5; 9 7 3; 1 5 6'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 特征值提取</span>
eigvals<span class="token punctuation">,</span> eigvecs <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>eigvals<span class="token punctuation">,</span> eigvecs<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 通过特征值与特征向量， 求方阵</span>
S <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>eigvecs<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eigvals<span class="token punctuation">)</span><span class="token punctuation">)</span>\
    <span class="token operator">*</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>eigvecs<span class="token punctuation">)</span><span class="token punctuation">.</span>I
<span class="token keyword">print</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：读取图片的亮度矩阵，提取特征值与特征向量，保留部分特征值，重新生成新的亮度矩阵，绘制图片。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">as</span> sm
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

img <span class="token operator">=</span> sm<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../da_data/lily.jpg'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 特征值提取</span>
eigvals<span class="token punctuation">,</span> eigvecs <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把靠后的特征值与特征向量置为0（抹掉特征）</span>
eigvals<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment" spellcheck="true"># 重新生成新的图片</span>
img2 <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>eigvecs<span class="token punctuation">)</span> <span class="token operator">*</span> \
    np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eigvals<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>    \
    np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>eigvecs<span class="token punctuation">)</span><span class="token punctuation">.</span>I
img2 <span class="token operator">=</span> img2<span class="token punctuation">.</span>real
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Image Features'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="奇异值分解"><a href="#奇异值分解" class="headerlink" title="奇异值分解"></a>奇异值分解</h4><p>有一个矩阵M，可以分解为3个矩阵U、S、V，使得U x S x V等于m。U与V都是正交矩阵（乘以自身的转置矩阵结果为单位矩阵）。那么S矩阵主对角线上的元素则成为矩阵M的奇异值，其他元素均为0。</p>
<p>奇异值分解相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 奇异值分解</span>
<span class="token comment" spellcheck="true"># 得到3个矩阵： U S V。 U与V都是正交矩阵，S矩阵保存着奇异值</span>
U<span class="token punctuation">,</span> S<span class="token punctuation">,</span> V <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>svd<span class="token punctuation">(</span>M<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 奇异值分解</span>
U<span class="token punctuation">,</span> sv<span class="token punctuation">,</span> V <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>svd<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
sv<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
img3 <span class="token operator">=</span> U <span class="token operator">*</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>sv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> V
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="傅里叶变换"><a href="#傅里叶变换" class="headerlink" title="傅里叶变换"></a>傅里叶变换</h3><p>什么傅里叶变换？</p>
<p>傅里叶定理支出任何一条周期曲线，无论多么跳跃与不规则，都能表示成一组光滑的正弦曲线叠加之和。</p>
<p>傅里叶变换即是从一条周期曲线中分解出这一组光滑的正弦曲线的过程。傅里叶变换最终的结果将会得到这一组光滑正弦曲线的振幅、频率、初相位等数据。</p>
<p>傅里叶变换的目的是可以将时域（时间域）上的信号，转变为频域上的信号，随着域的不同，对一个事物的了解角度也就发生改变。因此某些在时域中不好处理的地方，放在频域中就可以较为简单的处理。（数据存储、数据降噪）<br>$$<br>y= A_1sin(\omega_1 x+\phi_1) +<br>A_2sin(\omega_2 x+\phi_2) +<br>A_3sin(\omega_3 x+\phi_3)+<br>C<br>$$</p>
<h4 id="傅里叶变换相关函数"><a href="#傅里叶变换相关函数" class="headerlink" title="傅里叶变换相关函数"></a>傅里叶变换相关函数</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入快速傅里叶变换模块</span>
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token comment" spellcheck="true"># 通过采样数量、采样周期，求得傅里叶变换分解出的所有曲线的频率</span>
freqs <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">.</span>fftfreq<span class="token punctuation">(</span>采样数量， 采样周期<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 基于原函数值序列求出傅里叶变换分解出的所有曲线的振幅和初相位</span>
<span class="token comment" spellcheck="true"># complex_array: 复数数组</span>
<span class="token comment" spellcheck="true">#     复数的 辅角  即是相位角</span>
<span class="token comment" spellcheck="true">#    复数的 模    即是振幅.</span>
complex_array <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">.</span>fft<span class="token punctuation">(</span>原函数值序列<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 逆向傅里叶变换 通过复数数组，逆向生成原函数</span>
y2 <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">.</span>ifft<span class="token punctuation">(</span>complex_array<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo05_fft.py  傅里叶变换
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf

x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
y1 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y2 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
y3 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
y4 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">7</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
y <span class="token operator">=</span> y1 <span class="token operator">+</span> y2 <span class="token operator">+</span> y3 <span class="token operator">+</span> y4

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'FFT'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Time Domain'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># mp.plot(x, y1, label='sin(x)')</span>
<span class="token comment" spellcheck="true"># mp.plot(x, y2, label='sin(3x)')</span>
<span class="token comment" spellcheck="true"># mp.plot(x, y3, label='sin(5x)')</span>
<span class="token comment" spellcheck="true"># mp.plot(x, y4, label='sin(7x)')</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'total'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 对该合成波执行FFT操作，得到分解波的信息。</span>
<span class="token comment" spellcheck="true"># 绘制频域图像。</span>
<span class="token comment" spellcheck="true"># 通过采样数量，采样周期返回频率数组</span>
freqs <span class="token operator">=</span> nf<span class="token punctuation">.</span>fftfreq<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 通过原函数图形，得到分解结果的复数数组</span>
<span class="token comment" spellcheck="true"># 复数的模就是振幅，复数的辅角为相位角</span>
ffts <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
pows <span class="token operator">=</span> np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>ffts<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 逆向傅里叶变换</span>
y2 <span class="token operator">=</span> nf<span class="token punctuation">.</span>ifft<span class="token punctuation">(</span>ffts<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制频域图像</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Frequency Domain'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Frequency'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Pow'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>freqs<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pows<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Frequency Line'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
        alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>  label<span class="token operator">=</span><span class="token string">'IFFT LINE'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>基于傅里叶变换的频域滤波</strong></p>
<p>含噪信号是高能信号与低能噪声叠加的信号，可以通过傅里叶变换的频域滤波实现降噪。</p>
<p>通过FFT使含噪信号转换为含噪频谱，取出低能噪声，留下高能频谱后再通过IFFT合成高能信号。</p>
<p>案例：基于傅里叶变换为音频文件去除噪声。</p>
<ol>
<li>读取音频文件，获取音频文件的基本信息：采样个数、采样周期，每个采样声音的信号值。绘制音频时域：时间、位移图像。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token comment" spellcheck="true"># 读取音频文件 获取采样率，与每个采样点的信号值</span>
sample_rate<span class="token punctuation">,</span> noised_sigs <span class="token operator">=</span> \
    wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../da_data/noised.wav'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(sample_rate, type(sample_rate))</span>
<span class="token comment" spellcheck="true"># print(noised_sigs, noised_sigs.shape)</span>
<span class="token comment" spellcheck="true"># 整理图像的y</span>
noised_sigs <span class="token operator">=</span> noised_sigs <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">15</span>
<span class="token comment" spellcheck="true"># 整理图像的x</span>
times <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>noised_sigs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample_rate

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Filter'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Time Domain'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Sigs'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>times<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span> noised_sigs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Noised'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>基于傅里叶变换，获取音频频域信息，绘制频域：频率、能量图像。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制频率图像</span>
freqs <span class="token operator">=</span> nf<span class="token punctuation">.</span>fftfreq<span class="token punctuation">(</span>times<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> sample_rate<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取每个频率波的能量</span>
noised_fft <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">(</span>noised_sigs<span class="token punctuation">)</span>
noised_pow <span class="token operator">=</span> np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>noised_fft<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Frequecy Domain'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Freqs'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Pows'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>semilogy<span class="token punctuation">(</span>freqs<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            noised_pow<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Noised'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>将低频噪声去除后绘制音频频域：频率、能量图像。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 请去除低频噪声  找到需要保留的高能频率</span>
fund_freq <span class="token operator">=</span> freqs<span class="token punctuation">[</span>noised_pow<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 所有噪声频率的下标</span>
noised_indices <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>freqs <span class="token operator">!=</span> fund_freq<span class="token punctuation">)</span>
filter_ffts <span class="token operator">=</span> noised_fft<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
filter_ffts<span class="token punctuation">[</span>noised_indices<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
filter_pows <span class="token operator">=</span> np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>filter_ffts<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Frequency'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Pows'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>freqs<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        filter_pows<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Filter'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>基于逆向傅里叶变换，生成新的音频信号，绘制音频时域的：时间、位移图像。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 生成新的音频图像</span>
filter_sigs <span class="token operator">=</span> nf<span class="token punctuation">.</span>ifft<span class="token punctuation">(</span>filter_ffts<span class="token punctuation">)</span><span class="token punctuation">.</span>real
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">223</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Sigs'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>times<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filter_sigs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Filter'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>生成文件</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 重新生成音频文件</span>
wf<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'../da_data/out.wav'</span><span class="token punctuation">,</span> sample_rate<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>filter_sigs <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int16<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="随机数模块"><a href="#随机数模块" class="headerlink" title="随机数模块"></a>随机数模块</h3><p>np.random可以生成服从特定统计规律的随机数序列。</p>
<h4 id="二项分布（binomial）"><a href="#二项分布（binomial）" class="headerlink" title="二项分布（binomial）"></a>二项分布（binomial）</h4><p>二项分布就是重复n次独立事件的伯努利实验。在每次实验中只有两种可能的结果，而且两种结果发生与否相互对立，相互独立，事件发生与否的概率在每一次独立实验中都保持不变。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 产生size个随机数， 每个随机数来自n次尝试中成功的次数</span>
<span class="token comment" spellcheck="true"># 其中每次尝试成功的概率为p。</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>binomial<span class="token punctuation">(</span>n<span class="token punctuation">,</span> p<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>binomial<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例： 某人投篮命中率为0.3， 投10次进5个球的概率。</p>
<pre class="line-numbers language-python"><code class="language-python">r <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>binomial<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 客服接通率0.6， 打三次电话都没人接的概率</span>
r <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>binomial<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="超几何分布-hypergeometric"><a href="#超几何分布-hypergeometric" class="headerlink" title="超几何分布(hypergeometric)"></a>超几何分布(hypergeometric)</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 产生size个随机数</span>
<span class="token comment" spellcheck="true"># 每个随机数为在总样本中随机抽取nsample个样本后，好样本的个数</span>
<span class="token comment" spellcheck="true"># 总样本由ngood个好样本和nbad个坏样本组成</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>hypergeometric<span class="token punctuation">(</span>ngood<span class="token punctuation">,</span> nobad<span class="token punctuation">,</span> nsample<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>hypergeometric<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 超几何分布</span>
<span class="token comment" spellcheck="true"># 7个好苹果、3个坏苹果中随机选个</span>
<span class="token comment" spellcheck="true"># 抽中好苹果的数量</span>
r <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>hypergeometric<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>正态分布（normal）</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 产生size个随机数，服从标准正态分布(期望=0，标准差=1)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>size<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 产生size个随机数，服从正态分布(期望=1，标准差=10)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="杂项功能"><a href="#杂项功能" class="headerlink" title="杂项功能"></a>杂项功能</h3><h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><p><strong>联合间接排序</strong></p>
<p>联合间接排序支持为待排序列排序，若待排序列值相同，则利用参考序列作为参考继续排序。最终返回排序过后的有序索引。</p>
<pre class="line-numbers language-python"><code class="language-python">indices <span class="token operator">=</span> np<span class="token punctuation">.</span>lexsort<span class="token punctuation">(</span><span class="token punctuation">(</span>参考序列， 待排序列<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

products <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'Apple'</span><span class="token punctuation">,</span> <span class="token string">'Huawei'</span><span class="token punctuation">,</span> <span class="token string">'Mi'</span><span class="token punctuation">,</span> <span class="token string">'Samsung'</span><span class="token punctuation">,</span> <span class="token string">'OPPO'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
prices <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token number">4500</span><span class="token punctuation">,</span> <span class="token number">2999</span><span class="token punctuation">,</span> <span class="token number">4999</span><span class="token punctuation">,</span> <span class="token number">2999</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
volumns <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

indices <span class="token operator">=</span> np<span class="token punctuation">.</span>lexsort<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>volumns<span class="token punctuation">,</span> prices<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>复数数组排序</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 按照实部升序排列, 对于实部相同的元素，参考虚部的升序，返回排序后</span>
<span class="token comment" spellcheck="true"># 的结果数组。</span>
np<span class="token punctuation">.</span>sort_complex<span class="token punctuation">(</span>复数数组<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>插入排序</strong></p>
<p>如果有需求向有序数组中插入元素，使数组依然有序，numpy提供了方法：searchsorted方法查询并返回可插入位置数组，然后调用insert插入元素。</p>
<pre class="line-numbers language-python"><code class="language-python">indices <span class="token operator">=</span> np<span class="token punctuation">.</span>searchsorted<span class="token punctuation">(</span>有序序列，待插入序列<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>有序序列，位置序列，待插入序列<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 插入排序</span>
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
indices <span class="token operator">=</span> np<span class="token punctuation">.</span>searchsorted<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span>
r <span class="token operator">=</span> np<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>a<span class="token punctuation">,</span> indices<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h4><p>scipy提供了常见的插值算法，可以通过一系列的离散点设计出符合一定规律的插值器函数。 若我们给插值器函数更多的x，该函数将返回对应的函数值。</p>
<p>（插值常用于数据的补充）</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>interpolate <span class="token keyword">as</span> si

<span class="token comment" spellcheck="true"># 返回插值器函数</span>
func <span class="token operator">=</span> si<span class="token punctuation">.</span>interp1d<span class="token punctuation">(</span>
    离散点x坐标，
    离散点y坐标，
    kind <span class="token operator">=</span> 插值算法<span class="token punctuation">(</span>默认<span class="token string">'linear'</span><span class="token punctuation">:</span> 线性插值<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>interpolate <span class="token keyword">as</span> si
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

<span class="token comment" spellcheck="true"># 搞出15个散点</span>
min_x<span class="token punctuation">,</span> max_x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span>
dis_x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> max_x<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
dis_y <span class="token operator">=</span> np<span class="token punctuation">.</span>sinc<span class="token punctuation">(</span>dis_x<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 把散点交给插值器，生成插值器函数，绘制图像</span>
linear <span class="token operator">=</span> si<span class="token punctuation">.</span>interp1d<span class="token punctuation">(</span>dis_x<span class="token punctuation">,</span> dis_y<span class="token punctuation">)</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> max_x<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 三次样条插值器(Cubic Spline Interpolation)</span>
cu <span class="token operator">=</span> si<span class="token punctuation">.</span>interp1d<span class="token punctuation">(</span>dis_x<span class="token punctuation">,</span> dis_y<span class="token punctuation">,</span> kind<span class="token operator">=</span><span class="token string">'cubic'</span><span class="token punctuation">)</span>
y2 <span class="token operator">=</span> cu<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Interpolate'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>dis_x<span class="token punctuation">,</span> dis_y<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">##mp.plot(x, y, color='dodgerblue')</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>插值器会在游戏领域使用，在机器学习领域我们收集到的数据有很多是不完整的数据，这样就需要根据已有数据对空白数据进行预测，对样本数据进行补充完善，这时可以利用机器学习相关算法与插值器对空白数据进行预测与补充，完善训练样本。</p>
<h4 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h4><p>直观的说，对于一个给定的正实值函数，在一个实数区间上的定积分可以理解为坐标平面上由曲线、直线、轴围城的曲边梯形的面积。（一个确定值）</p>
<p>案例：利用微元法求定积分: y=2x<sup>2</sup>+3x+4曲线在[-5,5]区间的定积分。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo10_int.py  积分案例
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">as</span> mc


<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">4</span>

a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span>
x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
y1 <span class="token operator">=</span> f<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Integral'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Integral'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'f(x)'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 微元法画梯形</span>
n <span class="token operator">=</span> <span class="token number">50</span>
x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
y2 <span class="token operator">=</span> f<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
area <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># 保存积分值</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    area <span class="token operator">+=</span> <span class="token punctuation">(</span>y2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> \
        <span class="token punctuation">(</span>x2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> x2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制图像</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>
        mc<span class="token punctuation">.</span>Polygon<span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token punctuation">[</span>x2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>x2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>x2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>x2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            fc<span class="token operator">=</span><span class="token string">'deepskyblue'</span><span class="token punctuation">,</span>
            ec<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span>
            alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>scipy.integrate模块提供了quad方法计算定积分：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>integrate <span class="token keyword">as</span> si
<span class="token comment" spellcheck="true"># 求定积分：给出函数f，积分下限a，积分上限b</span>
<span class="token comment" spellcheck="true"># 返回：(积分值， 最大误差)</span>
area <span class="token operator">=</span> si<span class="token punctuation">.</span>quad<span class="token punctuation">(</span>f<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>基于scipy的图像处理</strong></p>
<p>scipy.ndimage中提供了一些简单的图像处理API，高斯模糊、图像旋转、边缘识别等功能。</p>
<pre class="line-numbers language-python"><code class="language-python">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a><a href="https://blog.csdn.net/qq_27297393/article/details/82284384" target="_blank" rel="noopener">机器学习</a></h1><h1 id="机器学习DAY01"><a href="#机器学习DAY01" class="headerlink" title="机器学习DAY01"></a>机器学习DAY01</h1><h3 id="机器学习概述"><a href="#机器学习概述" class="headerlink" title="机器学习概述"></a>机器学习概述</h3><h4 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h4><p>机器学习是一门能够让编程计算机从数据中学习的计算机科学。</p>
<p>一个计算机程序在完成任务T之后，获得经验E，其表现效果为P，如果任务T的性能表现（P），随着E增加而增加，那么这样的计算机程序就被称为机器学习系统。拥有自我完善，自我增进，自我适应的特点。</p>
<h4 id="为什么需要机器学习"><a href="#为什么需要机器学习" class="headerlink" title="为什么需要机器学习"></a>为什么需要机器学习</h4><ul>
<li>自动化的升级和维护</li>
<li>解决那些算法过于复杂，甚至根本就没有算法的问题</li>
<li>在机器学习的过程中协助人类对事物进行深刻理解</li>
</ul>
<h4 id="机器学习的问题"><a href="#机器学习的问题" class="headerlink" title="机器学习的问题"></a>机器学习的问题</h4><ol>
<li><p>建模问题</p>
<p>所谓机器学习，形式上可以这么理解：在数据中通过统计或推理的方法，寻找一个接收特定输入x，并给出预期输出y的功能函数f(x).</p>
</li>
<li><p>评估问题</p>
<p>针对已知输入，函数给出的输出（预测值）与实际输出（目标值）之间存在一定的误差，因此需要构建一个评估体系，根据误差的大小判定函数的优劣。</p>
</li>
<li><p>优化问题</p>
<p>学习的核心在于改善自身的性能，通过数据对算法的反复锤炼，不断提升函数预测的准确性，直到获得能够满足实际需求的最优解决方案。</p>
</li>
</ol>
<h4 id="机器学习的种类"><a href="#机器学习的种类" class="headerlink" title="机器学习的种类"></a>机器学习的种类</h4><p><strong>监督学习、无监督学习、半监督学习、强化学习</strong></p>
<ol>
<li>监督学习：用已知的输出评估模型的性能，引导模型优化。</li>
<li>无监督学习：在没有已知输出的情况下，仅仅根据输入信息的相关性，进行类别的划分。</li>
<li>半监督学习：先通过无监督学习划分类别，再根据人工标记，通过有监督学习预测输出。</li>
<li>强化学习：通过对不同决策结果的奖励和惩罚，使机器学习系统经过长时间训练以后，越来越倾向于给出接近期望结果的输出。</li>
</ol>
<p><strong>批量学习和增量学习</strong></p>
<ol>
<li>批量学习：将学习的过程和应用的过程分开，用全部的训练数据训练模型，然后在应用场景中实现预测，当预测结果不够理想时，重新回到学习过程，如此循环。</li>
<li>增量学习：将学习的过程和应用的而过程统一起来，在应用的同时以增量的方式不断学习新的内容，边训练变预测，边预测边训练。</li>
</ol>
<p><strong>基于实例的学习和基于模型的学习</strong></p>
<ol>
<li>基于实例的学习：以历史数据作为经验，寻找与待预测输入最接近的样本，以其输出作为预测结果。</li>
<li>基于模型的学习：以历史数据作为经验，建立联系输入与输出的某种数学模型，将待预测输入代入该模型，预测结果。</li>
</ol>
<h4 id="机器学习的一般过程"><a href="#机器学习的一般过程" class="headerlink" title="机器学习的一般过程"></a>机器学习的一般过程</h4><p><strong>数据清理</strong></p>
<ol>
<li>数据收集（数据检索、数据挖掘、爬虫）</li>
<li>数据清洗</li>
</ol>
<p><strong>机器学习</strong></p>
<ol>
<li>选择模型（算法）</li>
<li>训练模型（算法）</li>
<li>评估模型（工具、框架、算法）</li>
<li>测试模型</li>
</ol>
<p><strong>业务运维</strong></p>
<ol>
<li>应用模型</li>
<li>维护模型</li>
</ol>
<h4 id="机器学习的典型应用"><a href="#机器学习的典型应用" class="headerlink" title="机器学习的典型应用"></a>机器学习的典型应用</h4><p>股价预测、推荐引擎、自然语言识别（NLP）、语音、图像、人脸识别等。</p>
<h4 id="机器学习的基本问题"><a href="#机器学习的基本问题" class="headerlink" title="机器学习的基本问题"></a>机器学习的基本问题</h4><ol>
<li>回归问题：根据已知的输入和输出寻找某种性能最佳的模型，将未知输出的输入代入模型，得到<strong>连续的输出</strong>。</li>
<li>分类问题：根据已知的输入和输出寻找某种性能最佳的模型，将未知输出的输入代入模型，得到<strong>离散的输出</strong>。</li>
<li>聚类问题：根据已知输入的相似程度，将其划分成不同的群落。</li>
<li>升维、降维问题：在性能损失尽可能小的情况下，实现模型业务。</li>
</ol>
<h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3><p><strong>数据样本矩阵格式</strong></p>
<table>
<thead>
<tr>
<th>年龄</th>
<th>学历</th>
<th>经验</th>
<th>性别</th>
<th>月薪</th>
</tr>
</thead>
<tbody>
<tr>
<td>27</td>
<td>硕士</td>
<td>2</td>
<td>女</td>
<td>12000</td>
</tr>
<tr>
<td>24</td>
<td>本科</td>
<td>1</td>
<td>男</td>
<td>8000</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>一行一样本，一列一特征。</p>
<p><strong>数据预处理相关库</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># sklearn是解决机器学习问题的科学计算工具包</span>
<span class="token comment" spellcheck="true"># preprocessing用于数据预处理操作</span>
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="均值移除-标准化"><a href="#均值移除-标准化" class="headerlink" title="均值移除(标准化)"></a>均值移除(标准化)</h4><p>由于一个样本的不同特征值差异较大，不利于使用现有机器学习算法进行样本处理。所以可以使用<strong>均值移除</strong>让样本矩阵中每组特征值的平均值为0，标准差为1。</p>
<p>如何使样本矩阵中每组特征平均值为0？</p>
<pre><code>年龄： 17  20  23
mean(年龄) = 20
a = -3
b = 0 
c = 3
</code></pre><p>如何使样本矩阵中每组特征标准差为1？</p>
<pre><code>a = -3
b = 0 
c = 3
s = std(a, b, c)
结果：[a/s, b/s, c/s]
</code></pre><p>sklearn提供了均值移除的相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
A <span class="token operator">=</span> sp<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

std_samples <span class="token operator">=</span> sp<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输出每一列的均值与标准差</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std_samples<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>std_samples<span class="token punctuation">.</span>std<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="范围缩放"><a href="#范围缩放" class="headerlink" title="范围缩放"></a>范围缩放</h4><p>将样本矩阵中的每一列的最小值与最大值设定为相同的区间，统一各列特征值的范围。一般情况下会把特征值缩放至[0,1]区间。</p>
<p>如何使一组特征值的最小值为0呢？</p>
<pre><code>原特征： [17, 20, 23]
每个元素减去特征值的最小值： [0, 3, 6]
</code></pre><p>如何使一组特征值的最大值为1呢？</p>
<pre><code>[0, 3, 6]
把特征值数组每个元素除以最大值： [0, 0.5, 1]
</code></pre><p>sklearn提供的范围缩放相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取MinMax范围缩放器， 定义缩放范围[0, 1]</span>
mms <span class="token operator">=</span> sp<span class="token punctuation">.</span>MinMaxScaler<span class="token punctuation">(</span>feature_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 返回缩放结果</span>
result <span class="token operator">=</span> mms<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>原始样本矩阵<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 执行范围缩放</span>
mms <span class="token operator">=</span> sp<span class="token punctuation">.</span>MinMaxScaler<span class="token punctuation">(</span>feature_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> mms<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该范围缩放过程也可以这么理解：</p>
<p>当x=17时，y=0； 当x=23时，y=1；问：当x=20时，y=几？<br>$$<br>\left[\begin{matrix}<br>17 &amp; 1 \<br>23 &amp; 1 \<br>\end{matrix}\right]<br>\times<br>\left[\begin{matrix}<br>k \<br>b \<br>\end{matrix}\right]<br>=<br>\left[\begin{matrix}<br>0 \<br>1 \<br>\end{matrix}\right]<br>$$</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用解方程的方式求解k与b，实现线性范围缩放</span>
mms_samples <span class="token operator">=</span> raw_samples<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> mms_samples<span class="token punctuation">.</span>T<span class="token punctuation">:</span>
    col_min <span class="token operator">=</span> col<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span>
    col_max <span class="token operator">=</span> col<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span>
    a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>col_min<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span>col_max<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 计算 kx + b</span>
    col <span class="token operator">=</span> col <span class="token operator">*</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    col <span class="token operator">+=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mms_samples<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h4><p>有些情况每个样本的每个特征值具体是多少并不重要，但是每个样本特征值的占比更加重要。</p>
<table>
<thead>
<tr>
<th></th>
<th>Python</th>
<th>Java</th>
<th>PHP</th>
</tr>
</thead>
<tbody>
<tr>
<td>2017</td>
<td>10</td>
<td>20</td>
<td>5</td>
</tr>
<tr>
<td>2018</td>
<td>8</td>
<td>5</td>
<td>0</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>归一化即是用每个样本的每个特征值除以该样本各个特征值绝对值的总和。变换后样本矩阵，每个样本的特征值绝对值之和为1。</p>
<p>sklearn提供的归一化相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># array：原始样本矩阵</span>
<span class="token comment" spellcheck="true"># norm：范数</span>
<span class="token comment" spellcheck="true">#    l1：l1范数，这组数据每个元素绝对值之和为1</span>
<span class="token comment" spellcheck="true">#   l2：l2范数，这组数据每个元素平方之和为1</span>
sp<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>array<span class="token punctuation">,</span> norm<span class="token operator">=</span><span class="token string">'l1'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 归一化处理</span>
nor_samps <span class="token operator">=</span> sp<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>raw_samples<span class="token punctuation">,</span> norm<span class="token operator">=</span><span class="token string">'l1'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nor_samps<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>abs<span class="token punctuation">(</span>nor_samps<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 自己算：</span>
nor_samps <span class="token operator">=</span> raw_samples<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> nor_samps<span class="token punctuation">:</span>
    row <span class="token operator">/=</span> abs<span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nor_samps<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>abs<span class="token punctuation">(</span>nor_samps<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="二值化"><a href="#二值化" class="headerlink" title="二值化"></a>二值化</h4><p>有些业务并不需要分析矩阵的详细完整数据（比如图像边缘识别只需要分析图像边缘即可），可以根据一个事先给定的阈值，用0和1对特征值进行转换，分别表示不高于或高于阈值。二值化后的数组中每个元素非0即1，达到简化数学模型的目的。</p>
<p>sklearn提供二值化相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 给出阈值，获取二值化器</span>
bin <span class="token operator">=</span> sp<span class="token punctuation">.</span>Binarizer<span class="token punctuation">(</span>threshold<span class="token operator">=</span>阈值<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对原始样本矩阵执行二值化预处理操作</span>
result <span class="token operator">=</span> bin<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>原始样本矩阵<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 二值化处理</span>
bin <span class="token operator">=</span> sp<span class="token punctuation">.</span>Binarizer<span class="token punctuation">(</span>threshold<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
bin_samples <span class="token operator">=</span> bin<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bin_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 自己做：</span>
bin_samples <span class="token operator">=</span> raw_samples<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
bin_samples<span class="token punctuation">[</span>bin_samples <span class="token operator">&lt;=</span> <span class="token number">80</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
bin_samples<span class="token punctuation">[</span>bin_samples <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bin_samples<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="独热编码"><a href="#独热编码" class="headerlink" title="独热编码"></a>独热编码</h4><p>为样本特征的每个值建立一个由一个1与若干个0组成的序列，用该序列对所有的特征值进行编码。</p>
<pre><code>2个数      3个数    4个数
1        3        2
7        5        4
1        8        6
7        3        9
为每一个数组进行编码：
1-10    3-100    2-1000
7-01    5-010    4-0100
        8-001    6-0010
                9-0001
编码完毕后得到的最终样本矩阵：
101001000
010100100
100010010
011000001
</code></pre><p>独热编码相关的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 创建独热编码器对象</span>
<span class="token comment" spellcheck="true"># sparse：是否采用紧缩格式</span>
<span class="token comment" spellcheck="true"># dtype:数据类型</span>
ohe<span class="token operator">=</span>sp<span class="token punctuation">.</span>OneHotEncoder<span class="token punctuation">(</span>sparse<span class="token operator">=</span>是否采用紧缩格式，dtype<span class="token operator">=</span>数据类型<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对原始样本矩阵进行处理，返回度热编码后的样本矩阵</span>
result<span class="token operator">=</span>ohe<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>原始样本矩阵<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取ohe的编码字典</span>
ohe_dict <span class="token operator">=</span> ohe<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
ohe_samples <span class="token operator">=</span> ohe_dict<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ohe_samples<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 独热编码</span>
ohe <span class="token operator">=</span> sp<span class="token punctuation">.</span>OneHotEncoder<span class="token punctuation">(</span>sparse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int<span class="token punctuation">)</span>
ohe_samples <span class="token operator">=</span> ohe<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ohe_samples<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取ohe的编码字典</span>
ohe_dict <span class="token operator">=</span> ohe<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
ohe_samples <span class="token operator">=</span> ohe_dict<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ohe_samples<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="标签编码"><a href="#标签编码" class="headerlink" title="标签编码"></a>标签编码</h4><p>根据字符串形式的特征值在特征序列中的位置，为其制定一个数字标签，用于提供给基于数值算法的学习模型。</p>
<p>标签编码相关的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取标签编码器</span>
lbe <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对原始样本矩阵执行标签编码，返回编码完毕后的结果</span>
result <span class="token operator">=</span> lbe<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>原始样本矩阵<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 给出编码矩阵，反向逆推出原始样本矩阵</span>
samples <span class="token operator">=</span> lbe<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp

raw_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'audi'</span><span class="token punctuation">,</span> <span class="token string">'ford'</span><span class="token punctuation">,</span> <span class="token string">'audi'</span><span class="token punctuation">,</span> <span class="token string">'toyota'</span><span class="token punctuation">,</span>
    <span class="token string">'ford'</span><span class="token punctuation">,</span> <span class="token string">'bmw'</span><span class="token punctuation">,</span> <span class="token string">'toyota'</span><span class="token punctuation">,</span> <span class="token string">'byd'</span><span class="token punctuation">,</span>
    <span class="token string">'audi'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 执行标签编码</span>
lbe <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
lbe_samples <span class="token operator">=</span> lbe<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>raw_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>lbe_samples<span class="token punctuation">)</span>

inv_sampls <span class="token operator">=</span> lbe<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>lbe_samples<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>inv_sampls<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="线性回归"><a href="#线性回归" class="headerlink" title="线性回归"></a>线性回归</h3><p>线性回归的本质为针对符合线性数学模型的一组数据，可以找到一个线性方程拟合样本数据。从而当给出自变量后，通过线性方程实现预测输出的目的。</p>
<pre><code>输入       输出
0.5        5.0
0.6        5.5
0.8        6.0
1.1        6.8
1.4        7.0
....
y = kx + b
</code></pre><p>预测函数： y = w<sub>0</sub> + w<sub>1</sub>x</p>
<p>x： 输入   </p>
<p>y： 输出</p>
<p> w<sub>0</sub>  w<sub>1</sub>: 模型参数</p>
<p><strong>所谓模型的训练，就是根据已知的x与y，找到最佳的模型参数 w<sub>0</sub>  w<sub>1</sub>，使得尽可能的精确描述所有输出和输出的关系（误差最小）。</strong></p>
<p><strong>单样本误差：</strong></p>
<p>根据预测函数求出输入为x时的预测值： y’ = w<sub>0</sub> + w<sub>1</sub>x。</p>
<p>单样本误差则为：1/2  (y’ - y)<sup>2</sup></p>
<p><strong>总样本误差：</strong> </p>
<p>把所有单样本误差相加即是总样本误差： 1/2 &Sigma; (y’ - y)<sup>2</sup></p>
<p><strong>损失函数：</strong></p>
<p>loss =  1/2 &Sigma; (w<sub>0</sub> + w<sub>1</sub>x - y)<sup>2</sup></p>
<p>所以最终的结果即是需要找到一组w<sub>0</sub>  w<sub>1</sub>使得loss函数值最小。</p>
<h1 id="机器学习DAY02"><a href="#机器学习DAY02" class="headerlink" title="机器学习DAY02"></a>机器学习DAY02</h1><h3 id="线性回归-1"><a href="#线性回归-1" class="headerlink" title="线性回归"></a>线性回归</h3><p>线性回归的本质为针对符合线性数学模型的一组数据，可以找到一个线性方程拟合样本数据。从而当给出自变量后，通过线性方程实现预测输出的目的。</p>
<pre><code>输入       输出
0.5        5.0
0.6        5.5
0.8        6.0
1.1        6.8
1.4        7.0
....
y = kx + b
</code></pre><p>预测函数： y = w<sub>0</sub> + w<sub>1</sub>x</p>
<p>x： 输入   </p>
<p>y： 输出</p>
<p> w<sub>0</sub>  w<sub>1</sub>: 模型参数</p>
<p><strong>所谓模型的训练，就是根据已知的x与y，找到最佳的模型参数 w<sub>0</sub>  w<sub>1</sub>，使得尽可能的精确描述所有输入和输出的关系（误差最小）。</strong></p>
<p><strong>单样本误差：</strong></p>
<p>根据预测函数求出输入为x时的预测值： y’ = w<sub>0</sub> + w<sub>1</sub>x。</p>
<p>单样本误差则为：1/2  (y’ - y)<sup>2</sup></p>
<p><strong>总样本误差：</strong> </p>
<p>把所有单样本误差相加即是总样本误差： 1/2 &Sigma; (y’ - y)<sup>2</sup></p>
<p><strong>损失函数：</strong></p>
<p>loss =  1/2 &Sigma; (w<sub>0</sub> + w<sub>1</sub>x - y)<sup>2</sup></p>
<p>所以最终的结果即是需要找到一组w<sub>0</sub>  w<sub>1</sub>使得loss函数值最小。</p>
<p>案例：基于梯度下降理论实现线性回归，求出w<sub>0</sub>  w<sub>1</sub>。</p>
<ol>
<li>整理训练集数据，自定义梯度下降算法，求出w<sub>0</sub>  w<sub>1</sub>，绘制回归线。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

train_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">6.0</span><span class="token punctuation">,</span> <span class="token number">6.8</span><span class="token punctuation">,</span> <span class="token number">7.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.55</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">5.3</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">6.9</span><span class="token punctuation">,</span> <span class="token number">7.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 基于梯度下降理论，完成线性回归，求w0与w1</span>
times <span class="token operator">=</span> <span class="token number">1000</span>  <span class="token comment" spellcheck="true"># 梯度下降次数</span>
lrate <span class="token operator">=</span> <span class="token number">0.01</span>  <span class="token comment" spellcheck="true"># 每次梯度下降参数的变化率</span>
epoches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 记录每次梯度下降的索引</span>
w0<span class="token punctuation">,</span> w1<span class="token punctuation">,</span> losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 参数</span>
<span class="token comment" spellcheck="true"># 做1000次梯度下降</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> times <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    epoches<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    loss <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> train_x
             <span class="token operator">-</span> train_y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 使用偏导数取出w0与w1梯度下降值</span>
    d0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> train_x<span class="token punctuation">)</span>
          <span class="token operator">-</span> train_y<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
    d1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> train_x <span class="token operator">-</span> train_y<span class="token punctuation">)</span>
          <span class="token operator">*</span> train_x<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>'<span class="token punctuation">{</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span> <span class="token operator">></span> w0<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token number">8f</span><span class="token punctuation">}</span><span class="token punctuation">,</span> w1<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token number">8f</span><span class="token punctuation">}</span><span class="token punctuation">,</span> \
          loss<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token number">8f</span><span class="token punctuation">}</span>'<span class="token punctuation">.</span>format<span class="token punctuation">(</span>
        epoches<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        losses<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># w0, w1梯度下降：</span>
    w0<span class="token punctuation">.</span>append<span class="token punctuation">(</span>w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> lrate <span class="token operator">*</span> d0<span class="token punctuation">)</span>
    w1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> lrate <span class="token operator">*</span> d1<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
           label<span class="token operator">=</span><span class="token string">'Training Points'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 通过w0与w1，绘制回归线</span>
pred_train_y <span class="token operator">=</span> w1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> train_x <span class="token operator">+</span> w0<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> pred_train_y<span class="token punctuation">,</span>
        color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'Regression Line'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>绘制每次梯度下降过程中w<sub>0</sub>  w<sub>1</sub> loss值的变化。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 绘制每次梯度下降过程中w0 w1 loss值的变化。</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Training Progress'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">311</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training Progress'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'w0'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epoches<span class="token punctuation">,</span> w0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'w0'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">312</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training Progress'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'w1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epoches<span class="token punctuation">,</span> w1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'w1'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">313</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training Progress'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'loss'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epoches<span class="token punctuation">,</span> losses<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'loss'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>基于三维曲面绘制梯度下降过程中的每一个空间点。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">as</span> axes3d

<span class="token comment" spellcheck="true"># 绘制空间曲面，观察梯度下降过程</span>
grid_w0<span class="token punctuation">,</span> grid_w1 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建一个数组，结构与grid_w0一致，元素全是0</span>
grid_loss <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>grid_w0<span class="token punctuation">)</span>
<span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> zip<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    grid_loss <span class="token operator">+=</span> \
        <span class="token punctuation">(</span>grid_w0 <span class="token operator">+</span> x <span class="token operator">*</span> grid_w1 <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token comment" spellcheck="true"># 绘制曲面</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">"Loss Function"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> mp<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Loss Function'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'w0'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'w1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'loss'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>
    grid_w0<span class="token punctuation">,</span> grid_w1<span class="token punctuation">,</span> grid_loss<span class="token punctuation">,</span>
    rstride<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> cstride<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w0<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> w1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> losses<span class="token punctuation">,</span>
        <span class="token string">'o-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>以等高线的方式绘制梯度下降的过程。</li>
</ol>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 以等高线的方式绘制梯度下降的过程。</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Contour'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'w0'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'w1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>grid_w0<span class="token punctuation">,</span> grid_w1<span class="token punctuation">,</span> grid_loss<span class="token punctuation">,</span>
            <span class="token number">10</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
cntr <span class="token operator">=</span> mp<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>grid_w0<span class="token punctuation">,</span> grid_w1<span class="token punctuation">,</span> grid_loss<span class="token punctuation">,</span>
                  <span class="token number">10</span><span class="token punctuation">,</span> colors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span>
                  linewidths<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>clabel<span class="token punctuation">(</span>cntr<span class="token punctuation">,</span> inline_spacing<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
          fmt<span class="token operator">=</span><span class="token string">'%.2f'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w0<span class="token punctuation">,</span> w1<span class="token punctuation">,</span> <span class="token string">'o-'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'BGD'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="线性回归模型"><a href="#线性回归模型" class="headerlink" title="线性回归模型"></a>线性回归模型</h4><p>sklearn提供了线性回归相关的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token comment" spellcheck="true"># 创建线性回归模型</span>
model <span class="token operator">=</span> lm<span class="token punctuation">.</span>LinearRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 模型训练</span>
<span class="token comment" spellcheck="true"># 输入：一个二维数组表示的样本矩阵</span>
<span class="token comment" spellcheck="true"># 输出：每个样本最终的结果</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>输入，输出<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 模型预测  给出与训练时格式相同的输入， 返回预测输出</span>
result <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>测试输入<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：基于线性回归训练single.txt中的样本，使用模型预测样本。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm

<span class="token comment" spellcheck="true"># 读取数据</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../ml_data/single.txt'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>
    usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># x变为n行1列</span>
<span class="token comment" spellcheck="true"># 创建模型->训练模型->使用模型</span>
model <span class="token operator">=</span> lm<span class="token punctuation">.</span>LinearRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把这些点画出来</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Sample Points'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> pred_y<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Regression Line'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="评估训练结果的误差"><a href="#评估训练结果的误差" class="headerlink" title="评估训练结果的误差"></a>评估训练结果的误差</h4><p>线性回归模型训练完毕后，可以利用测试集评估训练结果误差。sklearn.metrics 提供了计算模型误差的几个常用算法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm

<span class="token comment" spellcheck="true"># 平均绝对值误差:  1/m*∑|实际输出-预测输出|</span>
sm<span class="token punctuation">.</span>mean_absolute_error<span class="token punctuation">(</span>y， pred_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 平均平方误差:  sqrt(1/m*∑(实际输出-预测输出)^2)</span>
sm<span class="token punctuation">.</span>mean_squared_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 中位数绝对值误差: median(|实际输出-预测输出|)</span>
sm<span class="token punctuation">.</span>median_absolute_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># R2得分 (0, 1]区间上的分值，分数越高，模型越好, 误差越小</span>
sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 输出误差指标</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>mean_absolute_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>mean_squared_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>median_absolute_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="模型的保存与加载"><a href="#模型的保存与加载" class="headerlink" title="模型的保存与加载"></a>模型的保存与加载</h4><p>模型训练是一个耗时的过程，一个优秀的机器学习模型是很宝贵的。可以把模型保存到磁盘中，也可以在需要的时候从磁盘中重新加载模型。不需要重新训练。</p>
<p>模型保存和加载相关的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pickle
pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>内存对象<span class="token punctuation">,</span> 磁盘文件<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 保存模型</span>
model <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>磁盘文件<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 加载模型</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：把训练好的模型保存到磁盘中，在合适的时间读取模型对象。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 保存模型</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'../ml_data/linear.pkl'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>model<span class="token punctuation">,</span> f<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 加载模型</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'../ml_data/linear.pkl'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    model <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="岭回归"><a href="#岭回归" class="headerlink" title="岭回归"></a>岭回归</h3><p>普通线性回归模型使用基于梯度下降的最小二乘法，在损失函数最小化的前提下，寻找最优的模型参数。在此过程中，包括<strong>少数异常样本</strong>在内的全部训练数据会对模型参数造成相当程度的一些影响，而异常样本无法在训练过程中被识别出来。为此，岭回归在模型迭代过程中增加了<strong>正则项</strong>，以限制模型参数对异常样本的匹配程度。进而提高模型对多数正常样本的拟合精度。</p>
<p>岭回归相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token comment" spellcheck="true"># 正则强度: 该数字越大，越忽略异常样本</span>
<span class="token comment" spellcheck="true"># fit_intercept: 是否训练截距 </span>
<span class="token comment" spellcheck="true"># max_iter: 最大迭代次数</span>
m <span class="token operator">=</span> lm<span class="token punctuation">.</span>Ridge<span class="token punctuation">(</span>正则强度<span class="token punctuation">,</span> fit_intercept<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 训练模型</span>
m<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>输入， 输出<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用模型</span>
pred_y <span class="token operator">=</span> m<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：加载abnormal.txt </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用岭回归</span>
model <span class="token operator">=</span> lm<span class="token punctuation">.</span>Ridge<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> fit_intercept<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                 max_iter<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> pred_y<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'limegreen'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Ridge Regression'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="多项式回归"><a href="#多项式回归" class="headerlink" title="多项式回归"></a>多项式回归</h3><p>若希望回归模型更好的拟合训练样本的数据，可以用多项式回归器。</p>
<p><strong>一元多项式回归</strong><br>$$<br>y = w_0  + w_1x + w_2x^2 + w_3x^3 + … + w_dx^d<br>$$<br>将高次项看做对1次项的扩展:<br>$$<br>y = w_0  + w_1x_1 + w_2x_2 + w_3x_3 + … + w_dx_d<br>$$<br>那么一元多项式回归即可以看做为多元线性回归。可以直接使用LinearRegression模型对样本数据进行模型训练。</p>
<p>所以一元多项式回归的实现需要两个步骤：</p>
<ol>
<li>将一元多项式回归问题转换为多元线性回归问题（只需给出高次数）</li>
<li>将1步骤得到的多项式结果中w<sub>1</sub> w<sub>2</sub> .. 当做样本特征，交给线性回归器训练多元线性模型。</li>
</ol>
<p>使用sklearn提供的<strong>数据管线</strong>实现两个步骤的顺序执行：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">as</span> pl
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token comment" spellcheck="true"># 该管线将会组织两个步骤，首先使用多项式特征扩展器扩展出多项式，</span>
<span class="token comment" spellcheck="true"># 而后把数据交给线性回归器训练多元线性模型。</span>
model <span class="token operator">=</span> pl<span class="token punctuation">.</span>make_pipeline<span class="token punctuation">(</span>
    sp<span class="token punctuation">.</span>PolynomialFeatures<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 多项式特征扩展器</span>
    lm<span class="token punctuation">.</span>LinearRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 线性回归器    </span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo06_poly.py 多项式回归 single.txt
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">as</span> pl

<span class="token comment" spellcheck="true"># 读取数据</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>
    <span class="token string">'../ml_data/single.txt'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>
    usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># x变为n行1列</span>

<span class="token comment" spellcheck="true"># 创建管线</span>
model <span class="token operator">=</span> pl<span class="token punctuation">.</span>make_pipeline<span class="token punctuation">(</span>
    sp<span class="token punctuation">.</span>PolynomialFeatures<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 多项式特征扩展</span>
    lm<span class="token punctuation">.</span>LinearRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 线性回归器</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pred_y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 把这些点画出来</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Linear Regression'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Sample Points'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制多项式曲线</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>x<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span>
        linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'PolyFit Line'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>过于简单的模型，无论对于训练数据还是测试数据都无法给出足够高的预测精度，这种现象叫做欠拟合。</p>
<p>过于复杂的模型，对于训练数据可以得到较高的预测精度，但是对于预测数据通常精度较低。这种现象叫做过拟合。</p>
<p>一个性能可以接收的学习模型，应该对训练数据和测试数据都有接近的预测精度，而且精度不能太低。</p>
<h3 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h3><p><strong>基本算法原理</strong></p>
<p>核心思想：相似的输入必会产生相似的输出。比如预测薪资：</p>
<p>年龄：1-青年， 2-中年， 3 -老年</p>
<p>学历：1-本科， 2-硕士，3-博士</p>
<p>经验：1-出道，2-一般，3-老手， 4-骨灰</p>
<p>性别：1-男性，2-女性</p>
<table>
<thead>
<tr>
<th>年龄</th>
<th>学历</th>
<th>工作经验</th>
<th>性别</th>
<th>==&gt;</th>
<th>薪资</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>==&gt;</td>
<td>6000</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>==&gt;</td>
<td>10000</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>4</td>
<td>1</td>
<td>==&gt;</td>
<td>50000</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>==&gt;</td>
<td>?</td>
</tr>
</tbody>
</table>
<p>为了提高搜索效率，使用树形数据结构处理样本数据：<br>$$<br>年龄1\left{<br>\begin{aligned}<br>学历1 \<br>学历2 \<br>学历3 \<br>\end{aligned}<br>\right.<br>\quad\quad<br>年龄2\left{<br>\begin{aligned}<br>学历1 \<br>学历2 \<br>学历3 \<br>\end{aligned}<br>\right.<br>\quad\quad<br>年龄3\left{<br>\begin{aligned}<br>学历1 \<br>学历2 \<br>学历3 \<br>\end{aligned}<br>\right.<br>$$<br>首先从训练样本矩阵中选择第一个特征正进行子表划分，使每个子表中该特征的值全部相同。然后在每个子表中选择下一个特征按照同样的规则继续划分更小的子表，不断重复，直到所有的特征全部使用完为止。</p>
<p>此时便得到了叶级子表，其中所有样本的特征值全部相同。对于待预测样本，根据其每一个特征的值，选择对应的子表，逐一匹配，直到找到域值完全匹配的叶级子表，利用该子表中样本的输出，通过平均（回归问题）或投票（分类问题）为待预测样本提供预测输出。</p>
<p>随着子表的划分，信息熵（信息的混乱度）将会越来越小，信息越来越纯，数据越来越精准。</p>
<p>决策树回归器模型相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">as</span> st
<span class="token comment" spellcheck="true"># 创建决策树回归器模型</span>
<span class="token comment" spellcheck="true"># max_depth: 树的最大深度</span>
model <span class="token operator">=</span> st<span class="token punctuation">.</span>DecisionTreeRegressor<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 训练模型</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用模型</span>
pred_y<span class="token operator">=</span>model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：预测波士顿地区房屋价格。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo07_dt.py 决策树预测房屋价格
"""</span>
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> sd
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">as</span> su
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">as</span> st
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm

boston <span class="token operator">=</span> sd<span class="token punctuation">.</span>load_boston<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 数据量</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>target<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>feature_names<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 13个特征名</span>

<span class="token comment" spellcheck="true"># 打乱原始输入、输出数据集</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> su<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>
    boston<span class="token punctuation">.</span>data<span class="token punctuation">,</span> boston<span class="token punctuation">.</span>target<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 划分测试集、训练集</span>
train_size <span class="token operator">=</span> int<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    x<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> \
    x<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 创建模型， 使用训练集数据进行训练</span>
model <span class="token operator">=</span> st<span class="token punctuation">.</span>DecisionTreeRegressor<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 测试集数据预测</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输出R2得分</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="集合算法"><a href="#集合算法" class="headerlink" title="集合算法"></a>集合算法</h4><p>根据多个不同模型给出的预测结果，利用平均（回归问题）或者投票（分类问题）的方法，得出最终预测的结果。</p>
<p>基于决策树的集合算法，就是按照某种规则构建多颗彼此不同的决策树模型，分别给出针对未知样本的预测结果，最后通过平均或投票的方式得到相对综合的结论。</p>
<p><strong>正向激励</strong></p>
<p>首先为样本矩阵中的每行样本随机分配初始权重，由此构建一棵带有权重的决策树。在使用该决策树提供预测输出时，通过加权平均或加权投票的方式产生预测值。将训练样本代入模型，预测输出，对那些预测失败的样本，提高其权重，由此形成第二棵树。重复以上过程，构建出不同权重的n棵树。</p>
<p>正向激励相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">as</span> st
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token comment" spellcheck="true"># 普通决策树模型</span>
model <span class="token operator">=</span> st<span class="token punctuation">.</span>DecisionTreeRegressor<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用正向激励集合算法构建400棵树</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>AdaBoostRegressor<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 基础模型</span>
    n_estimators<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 决策树的数量</span>
    random_state<span class="token operator">=</span><span class="token number">7</span>    <span class="token comment" spellcheck="true"># 随机种子</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<h1 id="机器学习DAY03"><a href="#机器学习DAY03" class="headerlink" title="机器学习DAY03"></a>机器学习DAY03</h1><h2 id="机器学习-1"><a href="#机器学习-1" class="headerlink" title="机器学习"></a>机器学习</h2><h4 id="集合算法-1"><a href="#集合算法-1" class="headerlink" title="集合算法"></a>集合算法</h4><p>根据多个不同模型给出的预测结果，利用平均（回归问题）或者投票（分类问题）的方法，得出最终预测的结果。</p>
<p>基于决策树的集合算法，就是按照某种规则构建多颗彼此不同的决策树模型，分别给出针对未知样本的预测结果，最后通过平均或投票的方式得到相对综合的结论。</p>
<h5 id="正向激励"><a href="#正向激励" class="headerlink" title="正向激励"></a>正向激励</h5><p>首先为样本矩阵中的每行样本随机分配初始权重，由此构建一棵带有权重的决策树。在使用该决策树提供预测输出时，通过加权平均或加权投票的方式产生预测值。将训练样本代入模型，预测输出，对那些预测失败的样本，提高其权重，由此形成第二棵树。重复以上过程，构建出不同权重的n棵树。</p>
<p>正向激励相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">as</span> st
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token comment" spellcheck="true"># 普通决策树模型</span>
model <span class="token operator">=</span> st<span class="token punctuation">.</span>DecisionTreeRegressor<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用正向激励集合算法构建400棵树</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>AdaBoostRegressor<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 基础模型</span>
    n_estimators<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 决策树的数量</span>
    random_state<span class="token operator">=</span><span class="token number">7</span>    <span class="token comment" spellcheck="true"># 随机种子</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>特征重要性</strong></p>
<p>作为决策树模型训练过程的副产品，根据每个特征划分子表前后的信息熵减少量就标志了该特征的重要程度，此即为该特征的特征重要性指标。通过模型训练得到的model对象提供了属性：feature_importances_来存储每个特征的特征重要性指标值。</p>
<p>获取特征重要性相关API:</p>
<pre class="line-numbers language-python"><code class="language-python">model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
fi <span class="token operator">=</span> model<span class="token punctuation">.</span>feature_importances_
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo01_fi.py 特征重要性
"""</span>
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> sd
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">as</span> su
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">as</span> st
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

boston <span class="token operator">=</span> sd<span class="token punctuation">.</span>load_boston<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 数据量</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>target<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>boston<span class="token punctuation">.</span>feature_names<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 13个特征名</span>

<span class="token comment" spellcheck="true"># 打乱原始输入、输出数据集</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> su<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>
    boston<span class="token punctuation">.</span>data<span class="token punctuation">,</span> boston<span class="token punctuation">.</span>target<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 划分测试集、训练集</span>
train_size <span class="token operator">=</span> int<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    x<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> \
    x<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 创建模型， 使用训练集数据进行训练</span>
model <span class="token operator">=</span> st<span class="token punctuation">.</span>DecisionTreeRegressor<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 测试集数据预测</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输出R2得分</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 单颗决策树模型，输出特征重要性</span>
fi <span class="token operator">=</span> model<span class="token punctuation">.</span>feature_importances_
<span class="token comment" spellcheck="true"># 把特征重要性绘制成柱状图</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Feature Importance'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Tree'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Importance'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
indices <span class="token operator">=</span> fi<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
pos <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>indices<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>pos<span class="token punctuation">,</span> fi<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'DT'</span><span class="token punctuation">,</span>
       facecolor<span class="token operator">=</span><span class="token string">'deepskyblue'</span><span class="token punctuation">,</span>
       edgecolor<span class="token operator">=</span><span class="token string">'steelblue'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>pos<span class="token punctuation">,</span> boston<span class="token punctuation">.</span>feature_names<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 正向激励</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>AdaBoostRegressor<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 基础模型</span>
    n_estimators<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 决策树的数量</span>
    random_state<span class="token operator">=</span><span class="token number">7</span>  <span class="token comment" spellcheck="true"># 随机种子</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输出R2得分</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 基于决策树的正向激励，输出特征重要性</span>
fi2 <span class="token operator">=</span> model<span class="token punctuation">.</span>feature_importances_
<span class="token comment" spellcheck="true"># 把特征重要性绘制成柱状图</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'AdaBoostRegressor'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Importance'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
indices <span class="token operator">=</span> fi2<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
pos <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>indices<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>pos<span class="token punctuation">,</span> fi2<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'AB'</span><span class="token punctuation">,</span>
       facecolor<span class="token operator">=</span><span class="token string">'deepskyblue'</span><span class="token punctuation">,</span>
       edgecolor<span class="token operator">=</span><span class="token string">'steelblue'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>pos<span class="token punctuation">,</span> boston<span class="token punctuation">.</span>feature_names<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="自助聚合"><a href="#自助聚合" class="headerlink" title="自助聚合"></a>自助聚合</h5><p>每次从总样本矩阵中以有放回抽样的方式随机抽取部分样本构建决策树，这样形成多颗包含不同训练样本的决策树。以削弱某些强势样本对模型预测结果的影响，提高模型的普适性。</p>
<h5 id="随机森林"><a href="#随机森林" class="headerlink" title="随机森林"></a>随机森林</h5><p>在自主聚合的基础上，每次构建决策树模型时，不仅随机选择部分样本，而且还随机选择部分特征，这样的集合算法，不仅规避了强势样本对预测结果的影响，而且也削弱了强制特征的影响，使模型的预测能力更加泛化。</p>
<p>随机森林相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token comment" spellcheck="true"># 随机森林回归器</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestRegressor<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>         <span class="token comment" spellcheck="true">#  数的最大深度</span>
    n_estimators<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#  决策树的数量</span>
    min_samples_split<span class="token operator">=</span><span class="token number">2</span>    <span class="token comment" spellcheck="true">#  子表中最小样本数，小于该值，不再拆分</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：分析共享单车的需求，从而判断如何进行共享单车的投放。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo02_bike.py 共享单车分析
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">as</span> su
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/bike_day.csv'</span><span class="token punctuation">,</span>
                  unpack<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U20'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取表头字符序列</span>
day_headers <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 整理输入输出集</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>

x<span class="token punctuation">,</span> y <span class="token operator">=</span> su<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
train_size <span class="token operator">=</span> int<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    x<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span>  \
    x<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 随机森林回归器</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestRegressor<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
    min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
fi <span class="token operator">=</span> model<span class="token punctuation">.</span>feature_importances_
indices <span class="token operator">=</span> fi<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>day_headers<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 以小时为单位</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/bike_hour.csv'</span><span class="token punctuation">,</span>
                  unpack<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U20'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取表头字符序列</span>
hour_headers <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 整理输入输出集</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>

x<span class="token punctuation">,</span> y <span class="token operator">=</span> su<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
train_size <span class="token operator">=</span> int<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    x<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">]</span><span class="token punctuation">,</span>  \
    x<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 随机森林回归器</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestRegressor<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
    min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
fi <span class="token operator">=</span> model<span class="token punctuation">.</span>feature_importances_
indices <span class="token operator">=</span> fi<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>hour_headers<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="人工分类-简单分类"><a href="#人工分类-简单分类" class="headerlink" title="人工分类(简单分类)"></a>人工分类(简单分类)</h3><table>
<thead>
<tr>
<th style="text-align:center">特征1</th>
<th style="text-align:center">特征2</th>
<th style="text-align:center">输出</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">5</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">8</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">5</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">7</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">-1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">8</td>
<td style="text-align:center">?</td>
</tr>
</tbody>
</table>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制类别边界线</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
n <span class="token operator">=</span> <span class="token number">500</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> np<span class="token punctuation">.</span>piecewise<span class="token punctuation">(</span>
    grid_x<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>grid_x <span class="token operator">&lt;</span> grid_y<span class="token punctuation">,</span> grid_x <span class="token operator">>=</span> grid_y<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用matplotlib绘制这些点，以及点的类别</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Simple Classification'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Simple Classification'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Feture1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feture2'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为网格点坐标矩阵填充颜色</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span>
              cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="逻辑分类"><a href="#逻辑分类" class="headerlink" title="逻辑分类"></a>逻辑分类</h3><p>通过输入的样本数据，基于多元线性回归模型求出线性预测方程。</p>
<p>y = w<sub>0</sub> + w<sub>1</sub>x<sub>1</sub> + w<sub>2</sub>x<sub>2</sub></p>
<pre><code>x1    x2     y
7     13     0.823423423
12    4      0.224234234  
......
</code></pre><p>但通过线性回归方程返回的是连续值，不可以直接用于分类业务模型，所以急需一种方式使得把连续的预测值-&gt;离散的预测值。[-∞, +∞] -&gt; (0, 1)<br>$$<br>逻辑函数：y=\frac{1}{1+e^{-x}}<br>$$<br>该逻辑函数当x&gt;0，y&gt;0.5; 当x&lt;0, y&lt;0.5； 可以把样本数据经过线性预测模型求得的值代入逻辑函数的x，即将预测函数的输出看做被划分成为1类别的概率，则概率大的类别作为预测结果，就可以根据函数值确定两个分类。这也是线性函数非线性化的一种方式。</p>
<p>逻辑分类相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm
<span class="token comment" spellcheck="true"># 创建逻辑分类模型</span>
<span class="token comment" spellcheck="true"># solver：liblinear指的是逻辑分类底层使用线性回归模型</span>
m <span class="token operator">=</span> lm<span class="token punctuation">.</span>LogisticRegression<span class="token punctuation">(</span>solver<span class="token operator">=</span><span class="token string">'liblinear'</span><span class="token punctuation">,</span> C<span class="token operator">=</span>正则强度<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>训练输入，训练输出<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>测试输入<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制类别边界线</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
n <span class="token operator">=</span> <span class="token number">500</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建逻辑分类器</span>
model <span class="token operator">=</span> lm<span class="token punctuation">.</span>LogisticRegression<span class="token punctuation">(</span>
    solver<span class="token operator">=</span><span class="token string">'liblinear'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
samples <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>
    grid_x<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grid_y<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> grid_z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用matplotlib绘制这些点，以及点的类别</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Simple Classification'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Simple Classification'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Feture1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feture2'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为网格点坐标矩阵填充颜色</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span>
              cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>多元分类</strong></p>
<p>通过多个二元分类器解决多元分类的问题。</p>
<p>若拿到一组新的样本，可以基于二元逻辑分类器，训练出一个模型，判断属于A类别的概率。在使用同样的方法训练出两个模型，分别判断属于B、C类别的概率，最终选择概率最高的类别作为这组样本的分类结果。</p>
<p>案例：基于逻辑分类模型的多元分类。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">as</span> lm

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3.1</span><span class="token punctuation">,</span> <span class="token number">6.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">5.7</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">5.4</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制类别边界线</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
n <span class="token operator">=</span> <span class="token number">500</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建逻辑分类器</span>
model <span class="token operator">=</span> lm<span class="token punctuation">.</span>LogisticRegression<span class="token punctuation">(</span>
    solver<span class="token operator">=</span><span class="token string">'liblinear'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
samples <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>
    grid_x<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grid_y<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> grid_z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用matplotlib绘制这些点，以及点的类别</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Logistic Classification'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Logistic Classification'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Feture1'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feture2'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为网格点坐标矩阵填充颜色</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span>
              cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="朴素贝叶斯分类"><a href="#朴素贝叶斯分类" class="headerlink" title="朴素贝叶斯分类"></a>朴素贝叶斯分类</h3><p>朴素贝叶斯分类是一种依据统计概率理论而实现的一种分类方式。</p>
<table>
<thead>
<tr>
<th style="text-align:center">天气情况</th>
<th style="text-align:center">穿衣风格</th>
<th style="text-align:center">约女朋友</th>
<th style="text-align:center">==&gt;</th>
<th style="text-align:center">心情</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0（晴天）</td>
<td style="text-align:center">0（休闲）</td>
<td style="text-align:center">0（约了）</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">0（高兴）</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1（风骚）</td>
<td style="text-align:center">1（没约）</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1（多云）</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">2（破旧）</td>
<td style="text-align:center">1</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">1（郁闷）</td>
</tr>
<tr>
<td style="text-align:center">2（下雨）</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">…</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">==&gt;</td>
<td style="text-align:center">？</td>
</tr>
</tbody>
</table>
<p><strong>贝叶斯定理：</strong> </p>
<p><strong>P(A|B) = P(A) P(B|A) / P(B)</strong>   &lt;=  <strong>P(A, B) = P(A)P(B|A) = P(B) P(A|B)</strong></p>
<p>例如：假设一个学校里有60%男生和40%女生，女生穿裤子的人数和穿裙子的人数相等，所有男生都穿裤子，一个人在远处随机看到了一个穿裤子的学生，那么这个学生是女生的概率是多少？</p>
<pre><code>P(女) = 0.4
P(裤子|女) = 0.5
P(裤子) = 0.6+0.2 = 0.8
P(女生|裤子)= 0.4*0.5/0.8 = 0.25
</code></pre><p>由此可得，统计总样本空间中晴天、休闲、没约并且高兴的概率，然后在求总样本空间中晴天、休闲、没约并且郁闷的概率，取其大者作为分类结果。</p>
<pre><code>P(晴天，休闲，没约，高兴)
=P(晴天|休闲，没约，高兴) P(休闲，没约，高兴)
=P(晴天|休闲，没约，高兴) P(休闲|没约，高兴) P(没约，高兴)
=P(晴天|休闲，没约，高兴) P(休闲|没约，高兴) P(没约|高兴)P(高兴)
（朴素:条件独立，特征值中间没有因果关系）
=P(晴天|高兴) P(休闲|高兴) P(没约|高兴)P(高兴)
</code></pre><p>朴素贝叶斯分类器相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">as</span> nb
<span class="token comment" spellcheck="true"># 创建符合高斯分布的朴素贝叶斯分类器</span>
model <span class="token operator">=</span> nb<span class="token punctuation">.</span>GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
result <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：multiple1.txt</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">as</span> nb
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/multiple1.txt'</span><span class="token punctuation">,</span>
                  unpack<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U20'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 构建高斯朴素贝叶斯分类器</span>
model <span class="token operator">=</span> nb<span class="token punctuation">.</span>GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
n <span class="token operator">=</span> <span class="token number">500</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
samples <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grid_y<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> grid_z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Naive Bayes Classification'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Naive Bayes Classification'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span>
              cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="数据集的划分"><a href="#数据集的划分" class="headerlink" title="数据集的划分"></a>数据集的划分</h4><p>对于分类问题，训练集和测试集的划分不应该用整个样本空间的特定百分比作为训练数据，而应该在其每一个类别的样本中抽取特定百分比作为训练数据。</p>
<p>sklearn提供了数据集划分相关方法，可以方便的划分训练集与测试数据，相关API如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token comment" spellcheck="true"># train_test_split自动划分测试集与训练街</span>
训练输入，测试输入，训练输出，测试输出 <span class="token operator">=</span> ms<span class="token punctuation">.</span>train_test_split<span class="token punctuation">(</span>
    输入集，输出集，
    test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 测试集占比</span>
    random_state<span class="token operator">=</span><span class="token number">7</span>    
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 划分训练集与测试集</span>
train_x<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    ms<span class="token punctuation">.</span>train_test_split<span class="token punctuation">(</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 让模型预测测试集结果</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输出精准度：预测正确的个数/总预测个数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>test_y <span class="token operator">==</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> pred_test_y<span class="token punctuation">.</span>size<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制测试集图形</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>test_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>test_y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="交叉验证"><a href="#交叉验证" class="headerlink" title="交叉验证"></a>交叉验证</h4><p>由于数据集的划分有不确定性，若随机划分的样本正好处于某类特殊样本，那么得到的训练模型所预测的结果可信度将会受到质疑。所以需要进行多次交叉验证。把样本空间中所有的样本均分成n分，使用不同的训练集训练模型，对不同的测试集进行测试，输出指标得分。</p>
<p>sklearn提供了交叉验证相关API:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token comment" spellcheck="true"># 交叉验证</span>
指标值数组 <span class="token operator">=</span> ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    模型，            <span class="token comment" spellcheck="true"># 原始模型</span>
    输入集，输出集， 
    cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>           <span class="token comment" spellcheck="true"># 折叠数 （做5次交叉验证）</span>
    scoring<span class="token operator">=</span>指标名 
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>交叉验证指标</strong></p>
<ol>
<li>精确度（accuracy）： 分类正确的样本数/总样本数</li>
<li>查准率（precision_weighted）：针对每一个类别，预测正确的样本数/预测出来的样本数。</li>
<li>召回率（recall_weighted）：针对每一个类别，预测正确的样本数/实际存在的样本数。</li>
<li>f1得分（f1_weighted）: 2 x 查准率 x 召回率/(查准率+召回率)</li>
</ol>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 构建高斯朴素贝叶斯分类器</span>
model <span class="token operator">=</span> nb<span class="token punctuation">.</span>GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 先做交叉验证，看一下f1得分</span>
ac <span class="token operator">=</span> ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
pw <span class="token operator">=</span> ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'precision_weighted'</span><span class="token punctuation">)</span>
rw <span class="token operator">=</span> ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'recall_weighted'</span><span class="token punctuation">)</span>
f1 <span class="token operator">=</span> ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'f1_weighted'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ac<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pw<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rw<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="混淆矩阵"><a href="#混淆矩阵" class="headerlink" title="混淆矩阵"></a>混淆矩阵</h4><p>sklearn提供了混淆矩阵清晰的显示出每一类别的查准率、召回率等验证结果。每一行和每一列分别对应样本输出中的每一个类别，行表示实际类别，列表示预测类别。</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">A类别</th>
<th style="text-align:center">B类别</th>
<th style="text-align:center">C类别</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A类别</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">B类别</td>
<td style="text-align:center">0</td>
<td style="text-align:center">6</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">C类别</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">7</td>
</tr>
</tbody>
</table>
<p>上述矩阵为理想的混淆矩阵。不理想的如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">A类别</th>
<th style="text-align:center">B类别</th>
<th style="text-align:center">C类别</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A类别</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">B类别</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">C类别</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">7</td>
</tr>
</tbody>
</table>
<p>获取模型分类结果的混淆矩阵相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
m <span class="token operator">=</span> sm<span class="token punctuation">.</span>confusion_matrix<span class="token punctuation">(</span>实际输出<span class="token punctuation">,</span> 预测输出<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 输出预测结果的混淆矩阵</span>
m <span class="token operator">=</span> sm<span class="token punctuation">.</span>confusion_matrix<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>m<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="机器学习DAY04"><a href="#机器学习DAY04" class="headerlink" title="机器学习DAY04"></a>机器学习DAY04</h1><h3 id="朴素贝叶斯分类-1"><a href="#朴素贝叶斯分类-1" class="headerlink" title="朴素贝叶斯分类"></a>朴素贝叶斯分类</h3><h4 id="分类报告"><a href="#分类报告" class="headerlink" title="分类报告"></a>分类报告</h4><p>sklearn.metrics提供了分类报告相关API，不仅可以得到混淆矩阵，还可以得到交叉验证的查准率、召回率、f1得分的结果。这样可以方便的分析出哪些样本是异常样本。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token comment" spellcheck="true"># 获取分类报告</span>
cr <span class="token operator">=</span> sm<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>实际输出<span class="token punctuation">,</span> 预测输出<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cr<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="决策树分类"><a href="#决策树分类" class="headerlink" title="决策树分类"></a>决策树分类</h3><p>决策树分类模型会找到与样本特征匹配的叶子节点，然后以投票的方式进行分类。</p>
<p>案例：基于决策树分类算法，训练模型，预测小汽车（car.txt）等级。需要注意的是每一个特征都需要使用标签编码做预处理。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
汽车评估 案例
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms

<span class="token comment" spellcheck="true"># 读取文本数据，对特征进行标签编码，</span>
<span class="token comment" spellcheck="true"># 基于随机森林进行模型训练，完成交叉验证。</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/car.txt'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U10'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>T
encoders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        train_y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
    encoders<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">)</span>
train_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token comment" spellcheck="true"># 基于随机森林分类器完成模型训练</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestClassifier<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>
    random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'f1_weighted'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 造一些测试数据，进行测试。</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'5more'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'big'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'unacc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'acc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'vgood'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 对测试数据进行相同的标签编码，</span>
<span class="token comment" spellcheck="true"># 才可以使用训练好的模型</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>T
test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> encoders<span class="token punctuation">[</span>row<span class="token punctuation">]</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        test_y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>
            data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
test_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token comment" spellcheck="true"># 使用模型开始预测</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
e <span class="token operator">=</span> encoders<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 针对最后一列的标签编码器</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="验证曲线"><a href="#验证曲线" class="headerlink" title="验证曲线"></a>验证曲线</h4><p>验证曲线 :  模型性能 = f(超参数)</p>
<p>验证曲线是超参数优选的一种解决方案，通过验证曲线相关API，可以得到相同模型在不同超参数下的模型性能得分，从而得知最优超参数。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> ms<span class="token punctuation">.</span>validation_curve<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 初始模型</span>
    输入集<span class="token punctuation">,</span> 输出集<span class="token punctuation">,</span>
    <span class="token string">'n_estimators'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 超参数名</span>
    np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 超参数取值列表</span>
    cv<span class="token operator">=</span><span class="token number">5</span>    <span class="token comment" spellcheck="true"># 折叠数</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>train_scores的结构：</p>
<table>
<thead>
<tr>
<th>超参数</th>
<th>CV1</th>
<th>CV2</th>
<th>CV3</th>
<th>CV4</th>
<th>CV5</th>
</tr>
</thead>
<tbody>
<tr>
<td>50</td>
<td>0.973</td>
<td>0.894</td>
<td>0.944</td>
<td>0.924</td>
<td>0.914</td>
</tr>
<tr>
<td>100</td>
<td>0.914</td>
<td>0.924</td>
<td>0.934</td>
<td>0.954</td>
<td>0.934</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>test_scores的结构与上述结构一致。</p>
<p>案例：小汽车案例中使用验证曲线选择超参数。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
汽车评估 案例  验证曲线选择超参数
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp


<span class="token comment" spellcheck="true"># 读取文本数据，对特征进行标签编码，</span>
<span class="token comment" spellcheck="true"># 基于随机森林进行模型训练，完成交叉验证。</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/car.txt'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U10'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>T
encoders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        train_y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
    encoders<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">)</span>
train_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token triple-quoted-string string">'''
# 基于随机森林分类器完成模型训练
model = se.RandomForestClassifier(
    max_depth=6, random_state=7)
# 获取关于n_estimators的验证曲线
n_estimators = np.arange(50, 550, 50)
train_scores, test_scores = \
    ms.validation_curve(
        model, train_x, train_y,
        'n_estimators', n_estimators, cv=5)
# 每个超参数取值对应的得分
train_means = train_scores.mean(axis=1)
for p, s in zip(n_estimators, train_means):
    print(p, '->', s)

mp.figure('N_estimators', facecolor='lightgray')
mp.title('N_estimators', fontsize=16)
mp.xlabel('Estimators', fontsize=14)
mp.ylabel('Scores', fontsize=14)
mp.tick_params(labelsize=12)
mp.grid(linestyle=":")
mp.plot(n_estimators, train_means,
        c='dodgerblue', label='Valid Curve')
mp.legend()
mp.show()


# 基于随机森林分类器完成模型训练
model = se.RandomForestClassifier(
    n_estimators=200, random_state=7)
# 获取关于max_depth的验证曲线
max_depths = np.arange(1, 11)
train_scores, test_scores = \
    ms.validation_curve(
        model, train_x, train_y,
        'max_depth', max_depths, cv=5)
# 每个超参数取值对应的得分
train_means = train_scores.mean(axis=1)
for p, s in zip(max_depths, train_means):
    print(p, '->', s)

mp.figure('Max_depth', facecolor='lightgray')
mp.title('Max_depth', fontsize=16)
mp.xlabel('Max_depths', fontsize=14)
mp.ylabel('Scores', fontsize=14)
mp.tick_params(labelsize=12)
mp.grid(linestyle=":")
mp.plot(max_depths, train_means,
        c='dodgerblue', label='Valid Curve')
mp.legend()
mp.show()
'''</span>

<span class="token comment" spellcheck="true"># 基于随机森林分类器完成模型训练</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestClassifier<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
    n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ms<span class="token punctuation">.</span>cross_val_score<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token string">'f1_weighted'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 造一些测试数据，进行测试。</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'5more'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'big'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'unacc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'acc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">,</span> <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
     <span class="token string">'med'</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">,</span> <span class="token string">'vgood'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 对测试数据进行相同的标签编码，</span>
<span class="token comment" spellcheck="true"># 才可以使用训练好的模型</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>T
test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> encoders<span class="token punctuation">[</span>row<span class="token punctuation">]</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        test_y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>
            data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
test_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token comment" spellcheck="true"># 使用模型开始预测</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
e <span class="token operator">=</span> encoders<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># 针对最后一列的标签编码器</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="学习曲线"><a href="#学习曲线" class="headerlink" title="学习曲线"></a>学习曲线</h4><p>学习曲线： 模型性能=f(训练集大小)</p>
<p>学习曲线相关API:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token comment" spellcheck="true"># 获取学习曲线</span>
_<span class="token punctuation">,</span> train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> ms<span class="token punctuation">.</span>learning_curve<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 初始模型</span>
    输入集<span class="token punctuation">,</span> 输出集<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 训练集的大小</span>
    cv<span class="token operator">=</span><span class="token number">5</span>    <span class="token comment" spellcheck="true"># 折叠数</span>
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
汽车评估 案例  学习曲线选择最优训练集大小
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">as</span> se
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp


<span class="token comment" spellcheck="true"># 读取文本数据，对特征进行标签编码，</span>
<span class="token comment" spellcheck="true"># 基于随机森林进行模型训练，完成交叉验证。</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/car.txt'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U10'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>T
encoders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        train_y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
    encoders<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">)</span>
train_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_x<span class="token punctuation">)</span><span class="token punctuation">.</span>T

<span class="token comment" spellcheck="true"># 基于随机森林分类器完成模型训练</span>
model <span class="token operator">=</span> se<span class="token punctuation">.</span>RandomForestClassifier<span class="token punctuation">(</span>
    max_depth<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
    n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用学习曲线获取最优训练集大小</span>
train_sizes <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span> train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> \
    ms<span class="token punctuation">.</span>learning_curve<span class="token punctuation">(</span>model<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span>
        train_sizes<span class="token operator">=</span>train_sizes<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
train_means <span class="token operator">=</span> train_scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> size<span class="token punctuation">,</span> score <span class="token keyword">in</span> zip<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> train_means<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> score<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Learning Curve'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Learning Curve'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Train Size'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Curve Score'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> train_means<span class="token punctuation">,</span> <span class="token string">'o-'</span><span class="token punctuation">,</span>
        c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Curve'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="支持向量机-SVM"><a href="#支持向量机-SVM" class="headerlink" title="支持向量机(SVM)"></a>支持向量机(SVM)</h3><h4 id="支持向量机原理"><a href="#支持向量机原理" class="headerlink" title="支持向量机原理"></a>支持向量机原理</h4><p><strong>核心理念：寻求最优分类边界</strong></p>
<p>正确：对大部分样本可以正确的划分类别。</p>
<p>泛化：最大化支持向量间距。</p>
<p>公平：类别与支持向量等距。</p>
<p>简单：线性，直线、平面做类别分割。</p>
<p><strong>基于核函数的升维变换</strong></p>
<p>对于难以分类的一些样本，执行基于核函数的升维变换。增加新的特征，使得低维度空间中的线性不可分问题，变成高维度空间中的线性可分问题。</p>
<p><strong>SVM提供的常用核函数</strong></p>
<ol>
<li>线性核函数        linear</li>
<li>多项式核函数         poly</li>
<li>径向基核函数         rbf</li>
</ol>
<p><strong>线性核函数</strong></p>
<p>不通过核函数进行维度提升，仅在原始维度空间中寻求线性分类边界。</p>
<p>基于线性核函数的SVM分类器：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">as</span> svm
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">)</span>
mpdel<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：使用线性核函数的SVM训练simple2.txt。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo05_svm_linear.py 线性核函数的SVM
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">as</span> svm
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/multiple2.txt'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'f8'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

train_x<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    ms<span class="token punctuation">.</span>train_test_split<span class="token punctuation">(</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 基于线性核函数的支持向量机模型</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 预测分类边界</span>
n <span class="token operator">=</span> <span class="token number">500</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
samples <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grid_y<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> grid_z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用模型预测测试集数据，输出分类报告</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
cr <span class="token operator">=</span> sm<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>
    test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cr<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 绘制分类边界</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'SVM Linear Classification'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'SVM Linear Classification'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span>
              cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>test_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>test_y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>多项式核函数</strong></p>
<p>通过多项式函数增加原始样本特征的高次方幂作为新的特征，在新的思考维度中对样本进行分类。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 基于多项式函数扩展新的特征</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'poly'</span><span class="token punctuation">,</span> degree<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>径向基核函数</strong></p>
<p>通过高斯分布函数增加原始样本特征的分布概率。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 基于径向基核函数的支持向量机分类器</span>
<span class="token comment" spellcheck="true"># C: 正则强度</span>
<span class="token comment" spellcheck="true"># gamma: 正态分布曲线的标准差</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="样本类别均衡化"><a href="#样本类别均衡化" class="headerlink" title="样本类别均衡化"></a>样本类别均衡化</h4><p>通过类别均衡化，使所占比例较小的样本权重较高，而所占比例较大的样本权重较低。以此平均化不同类别样本对分类模型的贡献，提高模型精度。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 添加 class_weight='balanced' 实现样本类别均衡化</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span> class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：基于线性核函数对imbalance.txt进行训练</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 基于线性核函数的支持向量机模型</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>
                class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="置信概率"><a href="#置信概率" class="headerlink" title="置信概率"></a>置信概率</h4><p>根据样本与分类边界的距离远近，对其预测类别的可信程度进行量化，离边界越近的样本，置信概率越低，反之，离边界越远的样本，置信概率越高。</p>
<p>获取每个样本的置信概率API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在获取支持向量机模型时，给出超参数 probability=True</span>
m <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> probability<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取每个样本的置信概率</span>
置信概率矩阵 <span class="token operator">=</span> model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>置信概率矩阵格式：</p>
<table>
<thead>
<tr>
<th></th>
<th>类别1</th>
<th>类别2</th>
</tr>
</thead>
<tbody>
<tr>
<td>样本1</td>
<td>0.8</td>
<td>0.2</td>
</tr>
<tr>
<td>样本2</td>
<td>0.6</td>
<td>0.4</td>
</tr>
</tbody>
</table>
<p>案例：修改径向基核函数的SVM案例，新增测试样本，输出置信概率。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 新增测试点   输出置信概率， 绘制图像</span>
prob_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">5.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">5.4</span><span class="token punctuation">,</span> <span class="token number">5.9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pred_prob_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>prob_x<span class="token punctuation">)</span>
probs <span class="token operator">=</span> model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>prob_x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>prob_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prob_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>pred_prob_y<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet_r'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 为每个点都加上备注: 1类别概率, 2类别概率</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>
        <span class="token string">'{}% {}%'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>
            round<span class="token punctuation">(</span>probs<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            round<span class="token punctuation">(</span>probs<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        xy<span class="token operator">=</span><span class="token punctuation">(</span>prob_x<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prob_x<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        xytext<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        textcoords<span class="token operator">=</span><span class="token string">'offset points'</span><span class="token punctuation">,</span>
        fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span>
        bbox<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'boxstyle'</span><span class="token punctuation">:</span> <span class="token string">'round,pad=0.6'</span><span class="token punctuation">,</span>
              <span class="token string">'fc'</span><span class="token punctuation">:</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="网格搜索"><a href="#网格搜索" class="headerlink" title="网格搜索"></a>网格搜索</h4><p>获取一个最优超参数的方式可以绘制验证曲线，但是验证曲线只能每次获取一个最优超参数。如果多个超参数有很多排列组合的话，就可以使用网格搜索寻求最优超参数组合。</p>
<p>在网格搜索过程中，针对每一个超参数组合，实例化给定的模型，做cv次交叉验证，将其中平均f1得分最高的超参数组合作为最佳选择，实例化模型对象。</p>
<p>网格搜索相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token comment" spellcheck="true"># 返回的是已经使用了最优超参数组合的model对象</span>
model <span class="token operator">=</span> ms<span class="token punctuation">.</span>GridSearchCV<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>             <span class="token comment" spellcheck="true"># 原始模型</span>
    超参数组合列表<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 使用列表的方式把所有组合列出</span>
    cv<span class="token operator">=</span><span class="token number">5</span>             <span class="token comment" spellcheck="true"># 交叉验证折叠数</span>
<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取网格搜索过程中的每个参数组合</span>
model<span class="token punctuation">.</span>cv_results_<span class="token punctuation">[</span><span class="token string">'params'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 获取王国搜索过程每个参数组合对应的平均测试分</span>
model<span class="token punctuation">.</span>cv_results_<span class="token punctuation">[</span><span class="token string">'mean_test_score'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 获取最好的参数</span>
model<span class="token punctuation">.</span>best_params_        <span class="token comment" spellcheck="true"># 最优参数</span>
model<span class="token punctuation">.</span>best_scores_        <span class="token comment" spellcheck="true"># 最优得分</span>
model<span class="token punctuation">.</span>best_estimator_    <span class="token comment" spellcheck="true"># 最优模型</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：修改置信概率案例，基于网格搜索寻的最优超参数。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 基于径向基核函数的支持向量机模型</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 整理超参数列表，做网格搜索，寻找最优</span>
params <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">'kernel'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'linear'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'kernel'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'poly'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token string">'degree'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'kernel'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'rbf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token string">'gamma'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
model <span class="token operator">=</span> ms<span class="token punctuation">.</span>GridSearchCV<span class="token punctuation">(</span>model<span class="token punctuation">,</span> params<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>best_estimator_<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 查看网格搜索过程的细节</span>
<span class="token keyword">for</span> p<span class="token punctuation">,</span> s <span class="token keyword">in</span> zip<span class="token punctuation">(</span>
    model<span class="token punctuation">.</span>cv_results_<span class="token punctuation">[</span><span class="token string">'params'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        model<span class="token punctuation">.</span>cv_results_<span class="token punctuation">[</span><span class="token string">'mean_test_score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="案例：事件预测"><a href="#案例：事件预测" class="headerlink" title="案例：事件预测"></a>案例：事件预测</h3><p>加载event.txt, 预测某个时间段是否会出现特殊事件。</p>
<pre class="line-numbers language-python"><code class="language-python">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="机器学习DAY05"><a href="#机器学习DAY05" class="headerlink" title="机器学习DAY05"></a>机器学习DAY05</h1><h3 id="案例：事件预测-1"><a href="#案例：事件预测-1" class="headerlink" title="案例：事件预测"></a>案例：事件预测</h3><p>加载event.txt, 预测某个时间段是否会出现特殊事件。</p>
<pre class="line-numbers language-python"><code class="language-python">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="案例：交通流量预测"><a href="#案例：交通流量预测" class="headerlink" title="案例：交通流量预测"></a>案例：交通流量预测</h3><p>加载traffic.txt，预测某个时间段某个路口的车流量。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo01_traffic.py 车流量预测
"""</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">as</span> sp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">as</span> ms
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">as</span> svm
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm


<span class="token keyword">class</span> <span class="token class-name">DigitEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""自定义数字编码器"""</span>

    <span class="token keyword">def</span> <span class="token function">fit_transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> y<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> y<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">inverse_transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> y<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>str<span class="token punctuation">)</span>

data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/traffic.txt'</span><span class="token punctuation">,</span>
                  delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'U20'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>T
encoders<span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        encoder <span class="token operator">=</span> DigitEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        encoder <span class="token operator">=</span> sp<span class="token punctuation">.</span>LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        y <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>
    encoders<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">)</span>

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token comment" spellcheck="true"># 划分测试集训练集</span>
train_x<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_y <span class="token operator">=</span> \
    ms<span class="token punctuation">.</span>train_test_split<span class="token punctuation">(</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用SVM回归器训练模型</span>
model <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVR<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>r2_score<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 执行业务预测</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Tuesday'</span><span class="token punctuation">,</span> <span class="token string">'13:35'</span><span class="token punctuation">,</span> <span class="token string">'San Francisco'</span><span class="token punctuation">,</span> <span class="token string">'yes'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>T
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> encoders<span class="token punctuation">[</span>row<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>encoder<span class="token punctuation">)</span>
    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>T
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="聚类"><a href="#聚类" class="headerlink" title="聚类"></a>聚类</h3><p>分类（classification）与聚类（cluster）不同，分类是有监督学习模型，聚类属于无监督学习模型。聚类讲究实用一些算法把样本划分为n个群落。一般情况下，这种算法都需要计算<strong>欧式距离</strong>。</p>
<p><strong>欧几里得距离</strong><br>$$<br>P(x_1) - Q(x_2): |x_1-x_2| = \sqrt{(x_1 - x_2)^2}  \<br>P(x_1, y_1) - Q(x_2, y_2): \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}  \<br>P(x_1, y_1, z_1) - Q(x_2, y_2, z_2): \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2 + (z_1 - z_2)^2}  \<br>$$<br>两个样本对应特征值之差的平方和的平方根，即欧式距离，用来表示两个样本的相似性。</p>
<h4 id="K均值算法"><a href="#K均值算法" class="headerlink" title="K均值算法"></a>K均值算法</h4><p>第一步：随机选择K个样本作为K个聚类中心，计算每个样本到各个聚类中的欧氏距离，将该样本分配到与之最近的聚类中心所在类别中。</p>
<p>第二步：根据第一步得到的聚类划分，分别计算每个聚类的几何中心，将几何中心作为新的聚类中心，重复第一步，直到计算所得几何中心与聚类中心重合或接近重合为止。</p>
<p>注意：</p>
<ol>
<li>聚类数必须事先已知，借助某些评估指标，优选最好的聚类数量。</li>
<li>聚类中心的初始选择会影响到最终聚类划分的结果，初始中心尽量选择距离较远的样本。</li>
</ol>
<p>K均值相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">as</span> sc
<span class="token comment" spellcheck="true"># n_clusters：聚类的类别数量。</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 给出训练样本</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 预测样本的类别</span>
c <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取训练结果的聚类中心</span>
centers <span class="token operator">=</span> model<span class="token punctuation">.</span>cluster_centers_
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：加载multiple3.txt, 完成KMeans聚类。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo02_kmeans.py  聚类案例
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">as</span> sc
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

x <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/multiple3.txt'</span><span class="token punctuation">,</span>
               delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># KMeans聚类模型</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
pred_c <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
centers <span class="token operator">=</span> model<span class="token punctuation">.</span>cluster_centers_
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_c<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 预测分类边界</span>
n <span class="token operator">=</span> <span class="token number">500</span>
l<span class="token punctuation">,</span> r <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
b<span class="token punctuation">,</span> t <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
grid_x<span class="token punctuation">,</span> grid_y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
samples <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grid_y<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>samples<span class="token punctuation">)</span>
grid_z <span class="token operator">=</span> grid_z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>grid_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 画图</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'K-Means Cluster'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'K-Means Cluster'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制分类边界</span>
mp<span class="token punctuation">.</span>pcolormesh<span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">,</span> grid_z<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制所有样本</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>pred_c<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>
           cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'samples'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>centers<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> centers<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>
           label<span class="token operator">=</span><span class="token string">'Centers'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="图像量化"><a href="#图像量化" class="headerlink" title="图像量化"></a>图像量化</h4><p>KMeans聚类算法可以应用于图像量化领域。 通过KMeans算法把一张图像所包含的颜色值进行聚类划分，求每一类别的平均值后，再重新生成新的图像。可以达到图像降维的目的，更有利于图像识别。这个过程称为图像量化。</p>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo03_image.py 图像量化
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">as</span> sm
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>ndimage <span class="token keyword">as</span> sn
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">as</span> sc
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

img <span class="token operator">=</span> sm<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/lily.jpg'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># n行1列</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y <span class="token operator">=</span> model<span class="token punctuation">.</span>labels_   <span class="token comment" spellcheck="true"># 返回聚类标签</span>
centers <span class="token operator">=</span> model<span class="token punctuation">.</span>cluster_centers_<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 把y数组中相应元素的值改为centers中的值</span>
<span class="token comment" spellcheck="true"># 生成新图片，处理后，图片中只包含centers范围内的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>centers<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>  centers<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
img2 <span class="token operator">=</span> centers<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Image'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="均值漂移算法"><a href="#均值漂移算法" class="headerlink" title="均值漂移算法"></a>均值漂移算法</h4><p>首先假定样本空间中的每个聚类均服从某种已知的概率分布规则，然后用不同的概率密度函数拟合样本中的统计直方图，不断移动密度函数的中心位置，直到获得最佳的拟合效果为止。这些概率密度函数曲线的峰值点就是聚类的中心，再根据每个样本与各个中心的距离，选择最近的聚类中心所属类别作为该样本的类别。</p>
<p>均值漂移算法的特点：</p>
<ol>
<li>聚类数不必事先已知，算法会自动识别出统计直方图的中心数量。</li>
<li>聚类中心不依据于最初假定，聚类划分的结果相对稳定。</li>
<li>样本空间应该服从某种概率分布规则，否则算法的准确性将会大大折扣。</li>
</ol>
<p>均值漂移算法相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 获取量化带宽对象</span>
bw <span class="token operator">=</span> sc<span class="token punctuation">.</span>estimate_bandwidth<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 输入集</span>
    n_samples<span class="token operator">=</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 样本数量</span>
    quantile<span class="token operator">=</span><span class="token number">0.1</span>    <span class="token comment" spellcheck="true"># 量化带宽（统计直方图的宽度）</span>
<span class="token punctuation">)</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>MeanShift<span class="token punctuation">(</span>bandwidth<span class="token operator">=</span>bw<span class="token punctuation">,</span> bin_seeding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例： multiple3.txt， 使用均值漂移做聚类划分。</p>
<pre class="line-numbers language-python"><code class="language-python">x <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/multiple3.txt'</span><span class="token punctuation">,</span>
               delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># KMeans聚类模型</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
pred_c <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
centers <span class="token operator">=</span> model<span class="token punctuation">.</span>cluster_centers_
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_c<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="凝聚层次算法"><a href="#凝聚层次算法" class="headerlink" title="凝聚层次算法"></a>凝聚层次算法</h4><p>首先假定每个样本都是一个独立的聚类，如果统计出来的聚类数大于期望的聚类数，则从每个样本出发，寻找离自己最近的另一个样本，与之聚集，形成更大的聚类。同时令总聚类数减少，不断重复以上过程，直到统计出来的聚类数达到期望值为止。</p>
<p>凝聚层次算法的特点：</p>
<ol>
<li>聚类数k必须事先已知。借助某些评估指标，优选最好的聚类数。</li>
<li>没有聚类中心概念，因此只能在训练集中划分聚类，不能对训练集以外的未知样本确定其归属。</li>
<li>在确定被凝聚的样本时，除了以距离作为条件外，还可以根据连续性来确定被聚集的样本。</li>
</ol>
<p>凝聚层次算法相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 构建凝聚层次聚类模型</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>AgglomerativeClustering<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 训练+预测</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo05_agglo.py  凝聚层次聚类
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">as</span> sc
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

x <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/multiple3.txt'</span><span class="token punctuation">,</span>
               delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 凝聚层次聚类模型</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>AgglomerativeClustering<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
pred_c <span class="token operator">=</span> model<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_c<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 画图</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Agglo Cluster'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Agglo Cluster'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制所有样本</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>pred_c<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>
           cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'samples'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用凝聚层次算法，根据<strong>连续性</strong>来确定被聚集的样本类别划分相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># linkage='average'： 无连续性的凝聚层次聚类器</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>AgglomerativeClustering<span class="token punctuation">(</span>
            linkage<span class="token operator">=</span><span class="token string">'average'</span><span class="token punctuation">,</span> n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 基于连续性的凝聚层次聚类器</span>
<span class="token comment" spellcheck="true"># 近邻筛选器</span>
conn <span class="token operator">=</span> nb<span class="token punctuation">.</span>kneighbors_graph<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> include_self<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>AgglomerativeClustering<span class="token punctuation">(</span>
            linkage<span class="token operator">=</span><span class="token string">'average'</span><span class="token punctuation">,</span> n_clusters<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
            conntivity<span class="token operator">=</span>conn<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="轮廓系数"><a href="#轮廓系数" class="headerlink" title="轮廓系数"></a>轮廓系数</h4><p>轮廓系数用于评估聚类器的好坏。好的聚类：内密外疏，同一个聚类内部的样本要足够密集，不同的聚类之间样本要足够疏远。</p>
<p>轮廓系数的计算规则：针对样本空间中的一个特定样本，计算它与所在聚类其他样本的平均距离a，以及该样本与距离最近的另一个聚类中所有样本的平均距离b，该样本的轮廓系数为(b-a)/max(a, b)。将整个样本空间中所有样本的轮廓系数取算数平均值，作为聚类划分的性能指标。</p>
<p>轮廓系数的取值区间：[-1, 1]。 -1代表分类效果差，1代表分类效果好。0代表聚类重叠,没有很好的划分。</p>
<p>轮廓系数相关API:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm
<span class="token comment" spellcheck="true"># v:返回样本空间所有样本的平均轮廓系数</span>
<span class="token comment" spellcheck="true"># metric:euclidean 使用欧几里得距离算法</span>
v <span class="token operator">=</span> sm<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>
    输入集，输出集，
    sample_size<span class="token operator">=</span>样本数<span class="token punctuation">,</span>
    metric<span class="token operator">=</span>距离算法
<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 输出轮廓系数指标</span>
v <span class="token operator">=</span> sm<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>
    x<span class="token punctuation">,</span> pred_c<span class="token punctuation">,</span> sample_size<span class="token operator">=</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="DBSCAN算法"><a href="#DBSCAN算法" class="headerlink" title="DBSCAN算法"></a>DBSCAN算法</h4><p>从样本空间中任意选择一个样本，以事先给定的半径做圆，凡被该圆圈中的样本都与该样本处于相同的聚类，以这些被圈中的样本为圆心继续画圆，重复以上过程，不断扩大被圈中样本的规模，直到再也没有新的样本加入为止，至此即得到一个聚类。在剩余样本中，重复以上过程，直到耗尽样本空间中的所有样本为止。</p>
<p>DBSCAN算法的特点：</p>
<ol>
<li>事先给定的半径会影响最后的聚类效果，可以借助轮廓系数选择较优方案</li>
<li>根据聚类的形成过程，把样本细分为三类：<ol>
<li>外周样本：被其他样本聚集到某个聚类中，但无法再引入新样本的样本。</li>
<li>孤立样本：据类中的样本数低于所设定的下限，则不称其为聚类，称其为孤立样本。</li>
<li>核心样本：除了外周样本和孤立样本以外的样本。</li>
</ol>
</li>
</ol>
<p>DBSCAN算法相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 构建DBSCAN聚类模型</span>
<span class="token comment" spellcheck="true"># eps：圆的半径</span>
<span class="token comment" spellcheck="true"># min_samples：聚类样本数量的下限，低于该数值则为孤立样本。</span>
model <span class="token operator">=</span> sc<span class="token punctuation">.</span>DBSCAN<span class="token punctuation">(</span>eps<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> min_samples<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取所有核心样本的index</span>
model<span class="token punctuation">.</span>core_sample_indices_
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：读取perf.txt，实现聚类划分。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo06_dbscan.py  dbscan算法实现聚类划分
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">as</span> sc
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">as</span> sm

x <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'../ml_data/perf.txt'</span><span class="token punctuation">,</span>
               delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 基于轮廓系数优先eps超参数</span>
eps<span class="token punctuation">,</span> scores<span class="token punctuation">,</span> models <span class="token operator">=</span>     \
    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> epsilon <span class="token keyword">in</span> eps<span class="token punctuation">:</span>
    model <span class="token operator">=</span> sc<span class="token punctuation">.</span>DBSCAN<span class="token punctuation">(</span>eps<span class="token operator">=</span>epsilon<span class="token punctuation">,</span> min_samples<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 输出轮廓系数指标</span>
    score <span class="token operator">=</span> sm<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>
        x<span class="token punctuation">,</span> model<span class="token punctuation">.</span>labels_<span class="token punctuation">,</span> sample_size<span class="token operator">=</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
        metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span>
    scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>append<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
scores <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>scores<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 最高分的下标</span>
best_index <span class="token operator">=</span> scores<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>eps<span class="token punctuation">[</span>best_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span>best_index<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 获取最优模型</span>
model <span class="token operator">=</span> models<span class="token punctuation">[</span>best_index<span class="token punctuation">]</span>
pred_y <span class="token operator">=</span> model<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_y<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建核心样本的掩码</span>
core_mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>
core_mask<span class="token punctuation">[</span>model<span class="token punctuation">.</span>core_sample_indices_<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token comment" spellcheck="true"># 获取孤立样本的掩码</span>
offset_mask <span class="token operator">=</span> model<span class="token punctuation">.</span>labels_ <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token comment" spellcheck="true"># 外周样本的掩码</span>
p_mask <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>core_mask <span class="token operator">|</span> offset_mask<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 画图</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'DBSCAN Cluster'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'DBSCAN Cluster'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> model<span class="token punctuation">.</span>labels_
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span>core_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           x<span class="token punctuation">[</span>core_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>labels<span class="token punctuation">[</span>core_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span>
           s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'core'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span>p_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span>p_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span>labels<span class="token punctuation">[</span>p_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'brg'</span><span class="token punctuation">,</span>
           alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'p'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span>offset_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           x<span class="token punctuation">[</span>offset_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>
           c<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'offset'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="推荐引擎"><a href="#推荐引擎" class="headerlink" title="推荐引擎"></a>推荐引擎</h3><p>推荐引擎意在把最需要的推荐给用户。</p>
<p>在不同的机器学习场景中通常需要分析相似样本，而统计相似样本的方式可以基于欧式距离分数，也可以基于皮氏距离分数。</p>
<p>简单推荐引擎的过程：</p>
<ol>
<li>当A登录后，系统检索A看过（评过分）的电影，发现A喜欢什么电影。</li>
<li>数据库中有哪些人与A的习惯相似。找到相似用户。</li>
<li>检索相似用户看过的电影，寻求评分较高的推荐给A。</li>
</ol>
<p><strong>欧式距离分数</strong><br>$$<br>欧式距离分数=\frac{1}{1+欧氏距离}<br>$$<br>计算所得欧氏距离分数区间处于 (0, 1]， 越趋向于0，样本间的距离越远，样本越不相似。趋向于1，代表越相似。</p>
<p>为了更方便的找到相似用户，需要构建样本之间的欧氏距离分数矩阵。</p>
<p>案例： 分析ratings.json。</p>
<pre class="line-numbers language-python"><code class="language-python">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="机器学习DAY06"><a href="#机器学习DAY06" class="headerlink" title="机器学习DAY06"></a>机器学习DAY06</h1><h3 id="推荐引擎-1"><a href="#推荐引擎-1" class="headerlink" title="推荐引擎"></a>推荐引擎</h3><p>推荐引擎意在把最需要的推荐给用户。</p>
<p>在不同的机器学习场景中通常需要分析相似样本，而统计相似样本的方式可以基于欧式距离分数，也可以基于皮氏距离分数。</p>
<p>简单推荐引擎的过程：</p>
<ol>
<li>当A登录后，系统检索A看过（评过分）的电影，发现A喜欢什么电影。</li>
<li>数据库中有哪些人与A的习惯相似。找到相似用户。</li>
<li>检索相似用户看过的电影，寻求评分较高的推荐给A。</li>
</ol>
<p><strong>欧式距离分数</strong><br>$$<br>欧式距离分数=\frac{1}{1+欧氏距离}<br>$$<br>计算所得欧氏距离分数区间处于 (0, 1]， 越趋向于0，样本间的距离越远，样本越不相似。趋向于1，代表越相似。</p>
<p>为了更方便的找到相似用户，需要构建样本之间的欧氏距离分数矩阵。</p>
<p>案例： 分析ratings.json。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token keyword">import</span> json
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'../ml_data/ratings.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    ratings <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 所有用户</span>
users <span class="token operator">=</span> list<span class="token punctuation">(</span>ratings<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># scmat用于存储每个人之间的欧氏距离得分矩阵</span>
scmat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> user1 <span class="token keyword">in</span> users<span class="token punctuation">:</span>
    scrow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> user2 <span class="token keyword">in</span> users<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># movies存储两个用户共同看过的电影</span>
        movies <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> movie <span class="token keyword">in</span> ratings<span class="token punctuation">[</span>user1<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> movie <span class="token keyword">in</span> ratings<span class="token punctuation">[</span>user2<span class="token punctuation">]</span><span class="token punctuation">:</span>
                movies<span class="token punctuation">.</span>add<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>movies<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            score <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># 两人没有共同语言得分为0</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 计算两人相似度得分</span>
            <span class="token comment" spellcheck="true"># x，y保存两人同时看过的多部电影的评分</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
                x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span>user1<span class="token punctuation">]</span><span class="token punctuation">[</span>movie<span class="token punctuation">]</span><span class="token punctuation">)</span>
                y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span>user2<span class="token punctuation">]</span><span class="token punctuation">[</span>movie<span class="token punctuation">]</span><span class="token punctuation">)</span>
            x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
            score <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span>
                <span class="token number">1</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        scrow<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span>
    scmat<span class="token punctuation">.</span>append<span class="token punctuation">(</span>scrow<span class="token punctuation">)</span>

users <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>users<span class="token punctuation">)</span>
scmat <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>scmat<span class="token punctuation">)</span>

<span class="token keyword">for</span> scrow <span class="token keyword">in</span> scmat<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'{:.2f}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>score<span class="token punctuation">)</span>
                   <span class="token keyword">for</span> score <span class="token keyword">in</span> scrow<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>皮尔逊相关系数</strong></p>
<pre class="line-numbers language-python"><code class="language-python">A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># A用户打分列表</span>
B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># B用户打分列表</span>
C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># C用户打分列表</span>
np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>A<span class="token punctuation">,</span> C<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>皮尔逊相关系数 = 协方差/标准差之积</p>
<p>相关系数处于[-1, 1]区间，接近于-1， 代表两组样本负相关；接近1则代表两组样本正相关。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token keyword">import</span> json
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'../ml_data/ratings.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    ratings <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 所有用户</span>
users <span class="token operator">=</span> list<span class="token punctuation">(</span>ratings<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># scmat用于存储每个人之间的欧氏距离得分矩阵</span>
scmat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> user1 <span class="token keyword">in</span> users<span class="token punctuation">:</span>
    scrow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> user2 <span class="token keyword">in</span> users<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># movies存储两个用户共同看过的电影</span>
        movies <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> movie <span class="token keyword">in</span> ratings<span class="token punctuation">[</span>user1<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> movie <span class="token keyword">in</span> ratings<span class="token punctuation">[</span>user2<span class="token punctuation">]</span><span class="token punctuation">:</span>
                movies<span class="token punctuation">.</span>add<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>movies<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            score <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># 两人没有共同语言得分为0</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># 计算两人相似度得分</span>
            <span class="token comment" spellcheck="true"># x，y保存两人同时看过的多部电影的评分</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies<span class="token punctuation">:</span>
                x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span>user1<span class="token punctuation">]</span><span class="token punctuation">[</span>movie<span class="token punctuation">]</span><span class="token punctuation">)</span>
                y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span>user2<span class="token punctuation">]</span><span class="token punctuation">[</span>movie<span class="token punctuation">]</span><span class="token punctuation">)</span>
            x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
            score <span class="token operator">=</span> np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        scrow<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span>
    scmat<span class="token punctuation">.</span>append<span class="token punctuation">(</span>scrow<span class="token punctuation">)</span>

users <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>users<span class="token punctuation">)</span>
scmat <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>scmat<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># for scrow in scmat:</span>
<span class="token comment" spellcheck="true">#     print(' '.join('{:.2f}'.format(score)</span>
<span class="token comment" spellcheck="true">#                    for score in scrow))</span>

<span class="token comment" spellcheck="true"># 按照相似度从而高低排序每个用户的相似用户</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> user <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 当前用户与所有人的相似度得分并排序</span>
    sorted_indices <span class="token operator">=</span> scmat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 不跟自己比</span>
    sorted_indices <span class="token operator">=</span> \
        sorted_indices<span class="token punctuation">[</span>sorted_indices <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 与当前用户的所有相似用户及相似度得分</span>
    similar_users <span class="token operator">=</span> users<span class="token punctuation">[</span>sorted_indices<span class="token punctuation">]</span>
    similar_scores <span class="token operator">=</span> scmat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>sorted_indices<span class="token punctuation">]</span>

    <span class="token comment" spellcheck="true"># 生成推荐清单</span>
    <span class="token comment" spellcheck="true"># 1. 找到所有皮尔逊系数正相关的用户</span>
    <span class="token comment" spellcheck="true"># 2. 遍历每个相似用户，找到相似看过的看是</span>
    <span class="token comment" spellcheck="true">#    当前用户没看过的电影</span>
    <span class="token comment" spellcheck="true"># 3. 多个相似用户可能推荐同一部电影，</span>
    <span class="token comment" spellcheck="true">#    取它们对该电影评分的均值作为推荐度。</span>
    positive_mask <span class="token operator">=</span> similar_scores <span class="token operator">></span> <span class="token number">0</span>
    similar_users <span class="token operator">=</span> similar_users<span class="token punctuation">[</span>positive_mask<span class="token punctuation">]</span>
    similar_scores <span class="token operator">=</span> similar_scores<span class="token punctuation">[</span>positive_mask<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 存储对当前用户所推荐的电影，以及电影</span>
    <span class="token comment" spellcheck="true"># 推荐度（对电影的评分）</span>
    recomm_movies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> similar_user <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>
            similar_users<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> movie<span class="token punctuation">,</span> score <span class="token keyword">in</span> \
                ratings<span class="token punctuation">[</span>similar_user<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> movie <span class="token operator">not</span> <span class="token keyword">in</span> ratings<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> movie <span class="token operator">not</span> <span class="token keyword">in</span> recomm_movies<span class="token punctuation">:</span>
                    recomm_movies<span class="token punctuation">[</span>movie<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    recomm_movies<span class="token punctuation">[</span>movie<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    recomm_movies <span class="token operator">=</span> \
        sorted<span class="token punctuation">(</span>recomm_movies<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span>average<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>recomm_movies<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="自然语言处理-NLP"><a href="#自然语言处理-NLP" class="headerlink" title="自然语言处理(NLP)"></a>自然语言处理(NLP)</h3><p>Siri：1. 听   2. 懂   3. 思考   4. 组织语言   5. 回答</p>
<ol>
<li>语音识别</li>
<li>自然语言处理 - 语义分析</li>
<li>逻辑分析 - 综合业务场景上下文</li>
<li>自然语言处理 - 分析结果生成自然语言文本</li>
<li>语音合成</li>
</ol>
<p>自然语言处理的常用处理过程：</p>
<p>先针对训练文本进行分词处理（词干提取、原型提取），统计词频，通过词频-逆文档频率算法获得该词对某种语义的贡献，根据每个词的贡献力度，构建有监督分类学习模型，把测试样本，交给模型处理，得到语义类别。</p>
<p>自然语言工具包 - NLTK</p>
<h4 id="文本分词"><a href="#文本分词" class="headerlink" title="文本分词"></a>文本分词</h4><p>分词处理相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> nltk<span class="token punctuation">.</span>tokenize <span class="token keyword">as</span> tk
<span class="token comment" spellcheck="true"># 把样本按照句子进行拆分  sent_list：句子列表</span>
sent_list <span class="token operator">=</span> tk<span class="token punctuation">.</span>sent_tokenize<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># # 把样本字符串按照单词进行拆分  word_list：单词列表</span>
word_list <span class="token operator">=</span> tk<span class="token punctuation">.</span>word_tokenize<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># WordPunctTokenizer:分词器对象</span>
tokenizer <span class="token operator">=</span> tk<span class="token punctuation">.</span>WordPunctTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
word_list <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>tokenize<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo02_tk.py  文本分词
"""</span>
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>tokenize <span class="token keyword">as</span> tk
doc <span class="token operator">=</span> <span class="token string">"Are you curious about tokenization? "</span>\
    <span class="token string">"Let's see how it works! "</span> \
    <span class="token string">"We need to analyze a couple of "</span> \
    <span class="token string">"sentences with punctuations to see "</span>\
    <span class="token string">"it in action."</span>
<span class="token comment" spellcheck="true"># 拆出句子</span>
sent_list <span class="token operator">=</span> tk<span class="token punctuation">.</span>sent_tokenize<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> sent <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>sent_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%2d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sent<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">45</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 拆分单词</span>
word_list <span class="token operator">=</span> tk<span class="token punctuation">.</span>word_tokenize<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> word <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>word_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%2d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">45</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 拆分单词  WordPunctTokenizer</span>
tokenizer <span class="token operator">=</span> tk<span class="token punctuation">.</span>WordPunctTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
word_list <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>tokenize<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> word <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>word_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%2d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="词干提取"><a href="#词干提取" class="headerlink" title="词干提取"></a>词干提取</h4><p>分词后的单词词性与时态对语义分析没有影响，所以需要对单词进行词干提取。</p>
<p>词干提取相关API:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>porter <span class="token keyword">as</span> pt
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>lancaster <span class="token keyword">as</span> lc
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>snowball <span class="token keyword">as</span> sb

stemmer <span class="token operator">=</span> pt<span class="token punctuation">.</span>PorterStemmer<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 波特词干提取器（宽松）</span>
stemmer <span class="token operator">=</span> lc<span class="token punctuation">.</span>LancasterStemmer<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 朗卡斯特词干提取器（严格）</span>
stemmer <span class="token operator">=</span> sb<span class="token punctuation">.</span>SnowballStemmer<span class="token punctuation">(</span><span class="token string">'english'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 思诺博词干提取器（中庸）</span>

r <span class="token operator">=</span> stemmer<span class="token punctuation">.</span>stem<span class="token punctuation">(</span><span class="token string">'playing'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 提取词干，返回结果</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo03_stem.py 词干提取
"""</span>
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>porter <span class="token keyword">as</span> pt
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>lancaster <span class="token keyword">as</span> lc
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem<span class="token punctuation">.</span>snowball <span class="token keyword">as</span> sb

words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'probably'</span><span class="token punctuation">,</span> <span class="token string">'wolves'</span><span class="token punctuation">,</span>
         <span class="token string">'playing'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span>
         <span class="token string">'beaches'</span><span class="token punctuation">,</span> <span class="token string">'grounded'</span><span class="token punctuation">,</span> <span class="token string">'dreamt'</span><span class="token punctuation">,</span>
         <span class="token string">'envision'</span><span class="token punctuation">]</span>
pt_stemmer <span class="token operator">=</span> pt<span class="token punctuation">.</span>PorterStemmer<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 波特词干提取器（宽松）</span>
lc_stemmer <span class="token operator">=</span> lc<span class="token punctuation">.</span>LancasterStemmer<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 朗卡斯特词干提取器（严格）</span>
sb_stemmer <span class="token operator">=</span> sb<span class="token punctuation">.</span>SnowballStemmer<span class="token punctuation">(</span><span class="token string">'english'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 思诺博词干提取器（中庸）</span>
<span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
    pt_stem <span class="token operator">=</span> pt_stemmer<span class="token punctuation">.</span>stem<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    lc_stem <span class="token operator">=</span> lc_stemmer<span class="token punctuation">.</span>stem<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    sb_stem <span class="token operator">=</span> sb_stemmer<span class="token punctuation">.</span>stem<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%8s %8s %8s %8s'</span> <span class="token operator">%</span>
          <span class="token punctuation">(</span>word<span class="token punctuation">,</span> pt_stem<span class="token punctuation">,</span> lc_stem<span class="token punctuation">,</span> sb_stem<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="词性还原"><a href="#词性还原" class="headerlink" title="词性还原"></a>词性还原</h4><p>与词干提取作用类似，词性还原更利于人工二次处理。因为有些词干并非正确的单词，人工阅读更麻烦。此行还原可以把名词的复数形式改为单数，动词特殊形式恢复为原型。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem <span class="token keyword">as</span> ns
<span class="token comment" spellcheck="true"># 词性还原器</span>
lemmatizer <span class="token operator">=</span> ns<span class="token punctuation">.</span>WordNetLemmatizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 还原名词</span>
n_lemma <span class="token operator">=</span> lemmatizer<span class="token punctuation">.</span>lemmatize<span class="token punctuation">(</span>word<span class="token punctuation">,</span> pos<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 还原动词</span>
v_lemma <span class="token operator">=</span> lemmatizer<span class="token punctuation">.</span>lemmatize<span class="token punctuation">(</span>word<span class="token punctuation">,</span> pos<span class="token operator">=</span><span class="token string">'v'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo03_lemm.py 词性还原
"""</span>
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>stem <span class="token keyword">as</span> ns

words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'probably'</span><span class="token punctuation">,</span> <span class="token string">'wolves'</span><span class="token punctuation">,</span>
         <span class="token string">'playing'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span>
         <span class="token string">'beaches'</span><span class="token punctuation">,</span> <span class="token string">'grounded'</span><span class="token punctuation">,</span> <span class="token string">'dreamt'</span><span class="token punctuation">,</span>
         <span class="token string">'envision'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 词性还原器</span>
lemmatizer <span class="token operator">=</span> ns<span class="token punctuation">.</span>WordNetLemmatizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
    n <span class="token operator">=</span> lemmatizer<span class="token punctuation">.</span>lemmatize<span class="token punctuation">(</span>word<span class="token punctuation">,</span> pos<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">)</span>
    v <span class="token operator">=</span> lemmatizer<span class="token punctuation">.</span>lemmatize<span class="token punctuation">(</span>word<span class="token punctuation">,</span> pos<span class="token operator">=</span><span class="token string">'v'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%8s %8s %8s'</span> <span class="token operator">%</span>
          <span class="token punctuation">(</span>word<span class="token punctuation">,</span> n<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="词袋模型"><a href="#词袋模型" class="headerlink" title="词袋模型"></a>词袋模型</h4><p>一句话的语义很大程度取决于某个单词出现的次数，所以可以把句子中所有可能出现的单词作为特征名，每一个句子为一个样本，单词在句子中出现的次数为特征值构建数学模型。该模型即称为词袋模型。</p>
<p>The brown dog is running. The black dog is in the black room. Running in the room is forbidden.</p>
<ol>
<li>The brown dog is running.</li>
<li>The black dog is in the black room.</li>
<li>Running in the room is forbidden.</li>
</ol>
<table>
<thead>
<tr>
<th>the</th>
<th>brown</th>
<th>dog</th>
<th>is</th>
<th>running</th>
<th>black</th>
<th>in</th>
<th>room</th>
<th>forbidden</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>构建词袋模型相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">as</span> ft
<span class="token comment" spellcheck="true"># 词袋模型对象</span>
cv <span class="token operator">=</span> ft<span class="token punctuation">.</span>CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
bow <span class="token operator">=</span> cv<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>sent<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取所有特征名（词袋的表头，所有的单词）</span>
words <span class="token operator">=</span> cv<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo05_bow.py 测试词袋模型
"""</span>
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>tokenize <span class="token keyword">as</span> tk
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">as</span> ft

doc <span class="token operator">=</span> <span class="token string">'The brown dog is running. '</span>    \
    <span class="token string">'The black dog is in the black room. '</span>\
    <span class="token string">'Running in the room is forbidden.'</span>
<span class="token comment" spellcheck="true"># 分解所有句子</span>
sentences <span class="token operator">=</span> tk<span class="token punctuation">.</span>sent_tokenize<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sentences<span class="token punctuation">)</span>
cv <span class="token operator">=</span> ft<span class="token punctuation">.</span>CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
bow <span class="token operator">=</span> cv<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bow<span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
words <span class="token operator">=</span> cv<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="词频（TF）"><a href="#词频（TF）" class="headerlink" title="词频（TF）"></a>词频（TF）</h4><p>单词在句子中出现的次数除以句子的总词数称为词频。即一个单词在一个句子中出现的频率。词频相比单词出现的次数更可以客观的评估单词对一句话语义的贡献度。对词袋矩阵归一化处理即可得到单词的词频。</p>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">tf <span class="token operator">=</span> sp<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>bow<span class="token punctuation">,</span> norm<span class="token operator">=</span><span class="token string">'l1'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="文档频率（DF）"><a href="#文档频率（DF）" class="headerlink" title="文档频率（DF）"></a>文档频率（DF）</h4><p>含有某个单词的文档样本数量 /  总文档样本数量</p>
<p>文档频率越低，代表某个单词对语义的贡献越高。</p>
<h4 id="逆文档频率（IDF）"><a href="#逆文档频率（IDF）" class="headerlink" title="逆文档频率（IDF）"></a>逆文档频率（IDF）</h4><p>总文档样本数量 / 含有某个单词的文档样本数量 </p>
<h4 id="词频-逆文档频率（TF-IDF）"><a href="#词频-逆文档频率（TF-IDF）" class="headerlink" title="词频-逆文档频率（TF-IDF）"></a>词频-逆文档频率（TF-IDF）</h4><p>词频矩阵中的每一个元素，乘以相应单词的逆文档频率，其值越大说明该词对样本语义的贡献度越大，根据每个词的贡献力度，构建学习模型。</p>
<p>获取TF-IDF矩阵的API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 首先获取词袋模型矩阵</span>
cv <span class="token operator">=</span> ft<span class="token punctuation">.</span>CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
bow <span class="token operator">=</span> cv<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">.</span>toArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取TF-IDF模型训练器</span>
tt <span class="token operator">=</span> ft<span class="token punctuation">.</span>TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>
tfidf <span class="token operator">=</span> tt<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>bow<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python">tt <span class="token operator">=</span> ft<span class="token punctuation">.</span>TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>
tfidf <span class="token operator">=</span> tt<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>bow<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tfidf<span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="文本分类（主题识别）"><a href="#文本分类（主题识别）" class="headerlink" title="文本分类（主题识别）"></a>文本分类（主题识别）</h4><p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo08_news.py 主题识别
"""</span>
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> sd
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">as</span> ft
<span class="token keyword">import</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">as</span> nb

train <span class="token operator">=</span> sd<span class="token punctuation">.</span>load_files<span class="token punctuation">(</span>
    <span class="token string">'../ml_data/20news'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin1'</span><span class="token punctuation">,</span>
    shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># load_file将会在文件夹下所有文件</span>
train_data <span class="token operator">=</span> train<span class="token punctuation">.</span>data
train_y <span class="token operator">=</span> train<span class="token punctuation">.</span>target
<span class="token comment" spellcheck="true"># 获取所有类别标签</span>
categories <span class="token operator">=</span> train<span class="token punctuation">.</span>target_names
<span class="token comment" spellcheck="true"># 构建词袋模型</span>
cv <span class="token operator">=</span> ft<span class="token punctuation">.</span>CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_bow <span class="token operator">=</span> cv<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建TFIDF矩阵</span>
tt <span class="token operator">=</span> ft<span class="token punctuation">.</span>TfidfTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_x <span class="token operator">=</span> tt<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>train_bow<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 基于多项分布的朴素贝叶斯分类器进行模型训练</span>
model <span class="token operator">=</span> nb<span class="token punctuation">.</span>MultinomialNB<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 测试模型：</span>
test_data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'The curveballs of right handed '</span>
    <span class="token string">'pitchers tend to curve to the left.'</span><span class="token punctuation">,</span>
    <span class="token string">'Caesar cipher is an ancient form '</span>
    <span class="token string">'of encryption.'</span><span class="token punctuation">,</span>
    <span class="token string">'This two-wheeler is really good '</span>
    <span class="token string">'on slippery roads'</span><span class="token punctuation">]</span>
test_bow <span class="token operator">=</span> cv<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
test_x <span class="token operator">=</span> tt<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>test_bow<span class="token punctuation">)</span>
pred_test_y <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>

<span class="token keyword">for</span> sent<span class="token punctuation">,</span> i <span class="token keyword">in</span> zip<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> pred_test_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sent<span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> categories<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="nltk分类器"><a href="#nltk分类器" class="headerlink" title="nltk分类器"></a>nltk分类器</h4><p>nltk提供了朴素贝叶斯分类器方便的处理自然语言相关的分类问题。并且可以自动处理词袋、TFIDF矩阵的整理，完成模型训练，最终实现类别预测。</p>
<p>相关API如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> nltk<span class="token punctuation">.</span>classify <span class="token keyword">as</span> cf
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>classify<span class="token punctuation">.</span>util <span class="token keyword">as</span> cu 

<span class="token triple-quoted-string string">''' train_data的数据格式：
[ ({'age':1, 'score':2, 'student':1}, 'good'),
  ({'age':1, 'score':2, 'student':1}, 'bad') ]
'''</span>
<span class="token comment" spellcheck="true"># 使用nltk直到的朴素贝叶斯分类器训练模型</span>
model <span class="token operator">=</span> cf<span class="token punctuation">.</span>NaiveBayesClassifier<span class="token punctuation">.</span>train<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对测试数据进行预测：test_data:  {'age':1, 'score':2}</span>
cls <span class="token operator">=</span> model<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 评估分类器  返回分类器的得分</span>
ac <span class="token operator">=</span> cu<span class="token punctuation">.</span>accuracy<span class="token punctuation">(</span>model<span class="token punctuation">,</span> test_data<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="情感分析"><a href="#情感分析" class="headerlink" title="情感分析"></a>情感分析</h4><p>分析语料库中movie_reviews文档，通过正面即负面的评价进行自然语言训练，实现情感分析。</p>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo09_movie.py  情感分析
"""</span>
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>corpus <span class="token keyword">as</span> nc
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>classify <span class="token keyword">as</span> cf
<span class="token keyword">import</span> nltk<span class="token punctuation">.</span>classify<span class="token punctuation">.</span>util <span class="token keyword">as</span> cu

pdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 获取pos目录下的所有文件id</span>
fileids <span class="token operator">=</span> nc<span class="token punctuation">.</span>movie_reviews<span class="token punctuation">.</span>fileids<span class="token punctuation">(</span><span class="token string">'pos'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 整理所有正面评论的单词，存入pdata列表</span>
<span class="token keyword">for</span> fileid <span class="token keyword">in</span> fileids<span class="token punctuation">:</span>
    sample <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true"># 对fileid该文件执行分词操作</span>
    words <span class="token operator">=</span> nc<span class="token punctuation">.</span>movie_reviews<span class="token punctuation">.</span>words<span class="token punctuation">(</span>fileid<span class="token punctuation">)</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
        sample<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    pdata<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token string">'POSITIVE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ndata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 获取neg目录下的所有文件id</span>
fileids <span class="token operator">=</span> nc<span class="token punctuation">.</span>movie_reviews<span class="token punctuation">.</span>fileids<span class="token punctuation">(</span><span class="token string">'neg'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 整理所有正面评论的单词，存入ndata列表</span>
<span class="token keyword">for</span> fileid <span class="token keyword">in</span> fileids<span class="token punctuation">:</span>
    sample <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true"># 对fileid该文件执行分词操作</span>
    words <span class="token operator">=</span> nc<span class="token punctuation">.</span>movie_reviews<span class="token punctuation">.</span>words<span class="token punctuation">(</span>fileid<span class="token punctuation">)</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
        sample<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    ndata<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token string">'NEGATIVE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 拆分训练集与测试集 (80%作为训练)</span>
pnumb <span class="token operator">=</span> int<span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>pdata<span class="token punctuation">)</span><span class="token punctuation">)</span>
nnumb <span class="token operator">=</span> int<span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>ndata<span class="token punctuation">)</span><span class="token punctuation">)</span>
train_data <span class="token operator">=</span> pdata<span class="token punctuation">[</span><span class="token punctuation">:</span>pnumb<span class="token punctuation">]</span> <span class="token operator">+</span> ndata<span class="token punctuation">[</span><span class="token punctuation">:</span>nnumb<span class="token punctuation">]</span>
test_data <span class="token operator">=</span> pdata<span class="token punctuation">[</span>pnumb<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> ndata<span class="token punctuation">[</span>nnumb<span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 基于朴素贝叶斯分类器开始训练</span>
model <span class="token operator">=</span>\
    cf<span class="token punctuation">.</span>NaiveBayesClassifier<span class="token punctuation">.</span>train<span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>
ac <span class="token operator">=</span> cu<span class="token punctuation">.</span>accuracy<span class="token punctuation">(</span>model<span class="token punctuation">,</span> test_data<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 模拟业务场景：</span>
reviews <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'It is an amazing movie.'</span><span class="token punctuation">,</span>
    <span class="token string">'This is a dull movie, I would never '</span>
    <span class="token string">'recommend it to anyone.'</span><span class="token punctuation">,</span>
    <span class="token string">'The cinematography is pretty great '</span>
    <span class="token string">'in this movie.'</span><span class="token punctuation">,</span>
    <span class="token string">'The direction was terrible and the '</span>
    <span class="token string">'story was all over the place.'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> review <span class="token keyword">in</span> reviews<span class="token punctuation">:</span>
    sample <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    words <span class="token operator">=</span> review<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>
        sample<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    pcls <span class="token operator">=</span> model<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>sample<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>review<span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> pcls<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="语音识别"><a href="#语音识别" class="headerlink" title="语音识别"></a>语音识别</h3><p>通过傅里叶变换，将时间域的声音函数分解为一系列不同频率的正弦函数的叠加，通过频率谱线的特殊分布，建立音频内容和文本的对应关系，以此作为模型训练的基础。</p>
<p>案例：freq.wav</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo10_freq.py 音频分解
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> \
    wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../ml_data/freq.wav'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sample_rate<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sigs<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> sigs<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># x坐标</span>
times <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sigs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample_rate
<span class="token comment" spellcheck="true"># 傅里叶变换，获取拆解出的正弦波频率与能量信息</span>
freqs <span class="token operator">=</span> nf<span class="token punctuation">.</span>fftfreq<span class="token punctuation">(</span>sigs<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> sample_rate<span class="token punctuation">)</span>
ffts <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">(</span>sigs<span class="token punctuation">)</span>
pows <span class="token operator">=</span> np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>ffts<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制两个图像</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Audio'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Time Domain'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Signal'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>times<span class="token punctuation">,</span> sigs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制频域图像</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Frequency Domain'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Frequency'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Pow'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>freqs<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pows<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="语音识别-1"><a href="#语音识别-1" class="headerlink" title="语音识别"></a>语音识别</h4><p>梅尔频率倒谱系数（MFCC）：对声音做傅里叶变换后，发现与声音内容密切相关的13个特殊频率所对应的能量分布。可以使用MFCC矩阵作为语音识别的特征。基于隐马尔科夫模型进行模式识别，找到测试样本最匹配的声音模型，从而识别语音内容。</p>
<p>MFCC相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> python_speech_features <span class="token keyword">as</span> sf

<span class="token comment" spellcheck="true"># 读取音频文件获取采样率及每个采样点的值</span>
sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../data/freq.wav'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 交给语音特征提取器获取该拼音的梅尔频率倒普矩阵</span>
mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：比较不同音频的mfcc矩阵。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo11_mfcc.py
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> python_speech_features <span class="token keyword">as</span> sf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> \
    wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../ml_data/speeches/training'</span>
            <span class="token string">'/banana/banana01.wav'</span><span class="token punctuation">)</span>
mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mfcc<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>mfcc<span class="token punctuation">.</span>T<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gist_rainbow'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'MFCC'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Sample'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feature'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>隐马尔可夫模型相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> hmmlearn<span class="token punctuation">.</span>hmm <span class="token keyword">as</span> hl
<span class="token comment" spellcheck="true"># 构建隐马模型</span>
<span class="token comment" spellcheck="true"># n_components：用几个高斯分布函数拟合样本数据</span>
<span class="token comment" spellcheck="true"># convariance_type： 使用相关矩阵的辅对角线进行相关性比较</span>
<span class="token comment" spellcheck="true"># n_iter：最大迭代上限</span>
model <span class="token operator">=</span> hl<span class="token punctuation">.</span>GaussianHMM<span class="token punctuation">(</span>
    n_components<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>     
    convariance_type<span class="token operator">=</span><span class="token string">'diag'</span><span class="token punctuation">,</span>
    n_iter<span class="token operator">=</span><span class="token number">1000</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>
score <span class="token operator">=</span> model<span class="token punctuation">.</span>score<span class="token punctuation">(</span>test_mfccs<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="机器学习DAY07"><a href="#机器学习DAY07" class="headerlink" title="机器学习DAY07"></a>机器学习DAY07</h1><h3 id="语音识别-2"><a href="#语音识别-2" class="headerlink" title="语音识别"></a>语音识别</h3><p>通过傅里叶变换，将时间域的声音函数分解为一系列不同频率的正弦函数的叠加，通过频率谱线的特殊分布，建立音频内容和文本的对应关系，以此作为模型训练的基础。</p>
<p>案例：freq.wav</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo10_freq.py 音频分解
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> \
    wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../ml_data/freq.wav'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sample_rate<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sigs<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> sigs<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># x坐标</span>
times <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sigs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample_rate
<span class="token comment" spellcheck="true"># 傅里叶变换，获取拆解出的正弦波频率与能量信息</span>
freqs <span class="token operator">=</span> nf<span class="token punctuation">.</span>fftfreq<span class="token punctuation">(</span>sigs<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> sample_rate<span class="token punctuation">)</span>
ffts <span class="token operator">=</span> nf<span class="token punctuation">.</span>fft<span class="token punctuation">(</span>sigs<span class="token punctuation">)</span>
pows <span class="token operator">=</span> np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>ffts<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制两个图像</span>
mp<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token string">'Audio'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Time Domain'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Signal'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>times<span class="token punctuation">,</span> sigs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'dodgerblue'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制频域图像</span>
mp<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Frequency Domain'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Frequency'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Pow'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">':'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>freqs<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pows<span class="token punctuation">[</span>freqs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        c<span class="token operator">=</span><span class="token string">'orangered'</span><span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="语音识别-3"><a href="#语音识别-3" class="headerlink" title="语音识别"></a>语音识别</h4><p>梅尔频率倒谱系数（MFCC）：对声音做傅里叶变换后，发现与声音内容密切相关的13个特殊频率所对应的能量分布。可以使用MFCC矩阵作为语音识别的特征。基于隐马尔科夫模型进行模式识别，找到测试样本最匹配的声音模型，从而识别语音内容。</p>
<p>MFCC相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> python_speech_features <span class="token keyword">as</span> sf

<span class="token comment" spellcheck="true"># 读取音频文件获取采样率及每个采样点的值</span>
sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../data/freq.wav'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 交给语音特征提取器获取该拼音的梅尔频率倒普矩阵</span>
mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：比较不同音频的mfcc矩阵。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo11_mfcc.py
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> numpy<span class="token punctuation">.</span>fft <span class="token keyword">as</span> nf
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> python_speech_features <span class="token keyword">as</span> sf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> \
    wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'../ml_data/speeches/training'</span>
            <span class="token string">'/banana/banana01.wav'</span><span class="token punctuation">)</span>
mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mfcc<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

mp<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>mfcc<span class="token punctuation">.</span>T<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gist_rainbow'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'MFCC'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Sample'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feature'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>隐马尔可夫模型相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> hmmlearn<span class="token punctuation">.</span>hmm <span class="token keyword">as</span> hl
<span class="token comment" spellcheck="true"># 构建隐马模型</span>
<span class="token comment" spellcheck="true"># n_components：用几个高斯分布函数拟合样本数据</span>
<span class="token comment" spellcheck="true"># convariance_type： 使用相关矩阵的辅对角线进行相关性比较</span>
<span class="token comment" spellcheck="true"># n_iter：最大迭代上限</span>
model <span class="token operator">=</span> hl<span class="token punctuation">.</span>GaussianHMM<span class="token punctuation">(</span>
    n_components<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>     
    convariance_type<span class="token operator">=</span><span class="token string">'diag'</span><span class="token punctuation">,</span>
    n_iter<span class="token operator">=</span><span class="token number">1000</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>
score <span class="token operator">=</span> model<span class="token punctuation">.</span>score<span class="token punctuation">(</span>test_mfccs<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：遍历文件夹，使用多个隐马模型训练所有音频的mfcc矩阵。然后使用测试集验证训练结果。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo01_hmm.py 语音识别
"""</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>wavfile <span class="token keyword">as</span> wf
<span class="token keyword">import</span> python_speech_features <span class="token keyword">as</span> sf
<span class="token keyword">import</span> hmmlearn<span class="token punctuation">.</span>hmm <span class="token keyword">as</span> hl


<span class="token keyword">def</span> <span class="token function">search_files</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    搜索directory目录下的所有wav文件，返回字典
    """</span>
    directory <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>directory<span class="token punctuation">)</span>
    objects <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> curdir<span class="token punctuation">,</span> subdirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> \
            os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> file <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            <span class="token keyword">if</span> file<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.wav'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                label <span class="token operator">=</span> curdir<span class="token punctuation">.</span>split<span class="token punctuation">(</span>
                    os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> label <span class="token operator">not</span> <span class="token keyword">in</span> objects<span class="token punctuation">:</span>
                    objects<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>curdir<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
                objects<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">return</span> objects

train_samples <span class="token operator">=</span> \
    search_files<span class="token punctuation">(</span><span class="token string">'../ml_data/speeches/training'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_samples<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 整理训练集数据，把每一个类别中音频的mfcc</span>
<span class="token comment" spellcheck="true"># 整理入训练集中.</span>
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> label<span class="token punctuation">,</span> filenames <span class="token keyword">in</span> train_samples<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mfccs <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>
        sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            mfccs <span class="token operator">=</span> mfcc
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mfccs <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                mfccs<span class="token punctuation">,</span> mfcc<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>
    train_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 基于隐马模型，进行训练，把所有训练结果model</span>
<span class="token comment" spellcheck="true"># 都存起来，供以后使用</span>
models <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> mfccs<span class="token punctuation">,</span> label <span class="token keyword">in</span> zip<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> hl<span class="token punctuation">.</span>GaussianHMM<span class="token punctuation">(</span>
        n_components<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> covariance_type<span class="token operator">=</span><span class="token string">'diag'</span><span class="token punctuation">,</span>
        n_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
    models<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 读取测试集中的文件，输出模式匹配的结果</span>
test_samples <span class="token operator">=</span> \
    search_files<span class="token punctuation">(</span><span class="token string">'../ml_data/speeches/testing'</span><span class="token punctuation">)</span>
test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> label<span class="token punctuation">,</span> filenames <span class="token keyword">in</span> test_samples<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mfccs <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>
        sample_rate<span class="token punctuation">,</span> sigs <span class="token operator">=</span> wf<span class="token punctuation">.</span>read<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        mfcc <span class="token operator">=</span> sf<span class="token punctuation">.</span>mfcc<span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> sample_rate<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            mfccs <span class="token operator">=</span> mfcc
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mfccs <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                mfccs<span class="token punctuation">,</span> mfcc<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>
    test_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 让每一个隐马模型验证每一个测试样本的匹配度</span>
pred_test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> mfccs <span class="token keyword">in</span> test_x<span class="token punctuation">:</span>
    best_score<span class="token punctuation">,</span> best_label <span class="token operator">=</span> None<span class="token punctuation">,</span> None
    <span class="token keyword">for</span> label<span class="token punctuation">,</span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        score <span class="token operator">=</span> model<span class="token punctuation">.</span>score<span class="token punctuation">(</span>mfccs<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>best_score <span class="token keyword">is</span> None<span class="token punctuation">)</span> <span class="token operator">or</span> \
                <span class="token punctuation">(</span>best_score <span class="token operator">&lt;</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>
            best_score<span class="token punctuation">,</span> best_label <span class="token operator">=</span> score<span class="token punctuation">,</span> label
    pred_test_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_label<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>test_y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pred_test_y<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="图像识别"><a href="#图像识别" class="headerlink" title="图像识别"></a>图像识别</h3><h4 id="OpenCV基础"><a href="#OpenCV基础" class="headerlink" title="OpenCV基础"></a>OpenCV基础</h4><p>openCV是一个开源的计算机视觉库。提供了很多图像处理的常用工具。</p>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo02_cv.py  opencv基础
"""</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/forest.jpg'</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Img'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 显示图像每个颜色通道的信息</span>
blue <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 仅保留原数组的蓝色通道</span>
blue<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span>
green <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
green<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span>
red <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
red<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> red<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 图像裁剪</span>
h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
l<span class="token punctuation">,</span> t <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span>
r<span class="token punctuation">,</span> b <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span>
cropped <span class="token operator">=</span> img<span class="token punctuation">[</span>t<span class="token punctuation">:</span>b<span class="token punctuation">,</span> l<span class="token punctuation">:</span>r<span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Cropped'</span><span class="token punctuation">,</span> cropped<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 图像缩小  给出目标图像的w与h即可</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
sc1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>
    img<span class="token punctuation">,</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    interpolation<span class="token operator">=</span>cv<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Scale1'</span><span class="token punctuation">,</span> sc1<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 图像放大 若不给出w与h，可以给出x、y缩放比例</span>
sc2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>
    sc1<span class="token punctuation">,</span> None<span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
    interpolation<span class="token operator">=</span>cv<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Scale2'</span><span class="token punctuation">,</span> sc2<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 图像保存</span>
cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'../ml_data/blue.jpg'</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'../ml_data/green.jpg'</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'../ml_data/red.jpg'</span><span class="token punctuation">,</span> red<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'../ml_data/sc2.jpg'</span><span class="token punctuation">,</span> sc2<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a>边缘检测</h4><p>物体的边缘检测是物体识别常用的手段，边缘检测常用亮度梯度的方法。通过识别亮度梯度变化最大的像素点从而检测出物体的边缘。</p>
<p>边缘识别相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 索贝尔边缘识别</span>
<span class="token comment" spellcheck="true"># cv.CV_64F:图片像素为整型，转为浮点型避免精度损失</span>
<span class="token comment" spellcheck="true"># 1:水平方向做索贝尔偏微分</span>
<span class="token comment" spellcheck="true"># 0:垂直方向不做索贝尔偏微分</span>
<span class="token comment" spellcheck="true"># ksize: 索贝尔卷积核为5*5</span>
cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 拉普拉斯边缘识别</span>
cv<span class="token punctuation">.</span>Laplacian<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Canny边缘识别</span>
<span class="token comment" spellcheck="true"># 50: 水平方向的阈值  240: 垂直方向的阈值</span>
cv<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
sobel.py 边缘识别
"""</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/chair.jpg'</span><span class="token punctuation">,</span>
                cv<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 索贝尔边缘识别器</span>
s1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'H-Sobel'</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span>
s2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'V-Sobel'</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span>
s3 <span class="token operator">=</span> cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Sobel'</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 拉普拉斯边缘识别</span>
laplacian <span class="token operator">=</span> cv<span class="token punctuation">.</span>Laplacian<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>CV_64F<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'laplacian'</span><span class="token punctuation">,</span> laplacian<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># canny边缘识别</span>
canny <span class="token operator">=</span> cv<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Canny'</span><span class="token punctuation">,</span> canny<span class="token punctuation">)</span>


cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="亮度提升"><a href="#亮度提升" class="headerlink" title="亮度提升"></a>亮度提升</h4><p>OpenCV提供了直方图均衡化的方式实现亮度提升，亮度提升后更有利于边缘识别模型的训练。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 针对灰度图像 做直方图均衡化处理</span>
gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
equalized_gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>equalizeHist<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo04_equalhist.py  直方图均衡化
"""</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/sunrise.jpg'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 直方图均衡化</span>
gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'gray'</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span>
equalized_gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>equalizeHist<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'equalized_gray'</span><span class="token punctuation">,</span> equalized_gray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 彩色图提亮度  YUV：亮度，色度，饱和度</span>
yuv <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2YUV<span class="token punctuation">)</span>
yuv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> cv<span class="token punctuation">.</span>equalizeHist<span class="token punctuation">(</span>yuv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>yuv<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_YUV2BGR<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'equalized_color'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>

cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="角点检测"><a href="#角点检测" class="headerlink" title="角点检测"></a>角点检测</h4><p>角点 - 平直棱线的交汇点。（颜色梯度方向改变的像素点的位置）</p>
<p>OpenCV提供的角点检测相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Harris角点检测器</span>
<span class="token comment" spellcheck="true"># 边缘的水平方向、垂直方向颜色值改变超过阈值7,5时即为边缘</span>
<span class="token comment" spellcheck="true"># 边缘线的方向改变超过阈值0.04即为一个角点</span>
corners <span class="token operator">=</span> cv<span class="token punctuation">.</span>cornerHarris<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo05_harris.py  角点检测
"""</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/box.png'</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Image'</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 返回所有的角点坐标</span>
corners <span class="token operator">=</span> cv<span class="token punctuation">.</span>cornerHarris<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
mixture <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>corners<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>corners<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>corners<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对彩色图像做掩码，找到角点把颜色改为红色</span>
mixture<span class="token punctuation">[</span>corners <span class="token operator">></span> corners<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">]</span> <span class="token operator">=</span>\
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Mixture'</span><span class="token punctuation">,</span> mixture<span class="token punctuation">)</span>

cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="特征点检测"><a href="#特征点检测" class="headerlink" title="特征点检测"></a>特征点检测</h4><p>特征点检测集合了边缘检测与角点检测，从而可以识别出图像的特征点。</p>
<p>常用的特征点检测：STAR特征点检测、SIFT特征点检测</p>
<p>star特征值检测相关API：</p>
<pre class="line-numbers language-python"><code class="language-python">gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># star特征点检测  创建start特征点检测器</span>
star <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatures2d<span class="token punctuation">.</span>StarDetector_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取检测到的所有特征点</span>
keypoints <span class="token operator">=</span> star<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 绘制特征点</span>
mixture <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> cv<span class="token punctuation">.</span>DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS
<span class="token comment" spellcheck="true"># (原图，特征点，目标图像，flag)</span>
cv<span class="token punctuation">.</span>drawKeypoints<span class="token punctuation">(</span>img<span class="token punctuation">,</span> keypoints<span class="token punctuation">,</span> mixture<span class="token punctuation">,</span> flags<span class="token operator">=</span>f<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Mixture'</span><span class="token punctuation">,</span> mixture<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>sift特征值检测相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># sift特征点检测  创建sift特征点检测器</span>
sift <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatrures2d<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取检测到的所有特征点</span>
keypoints <span class="token operator">=</span> sift<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="特征值矩阵"><a href="#特征值矩阵" class="headerlink" title="特征值矩阵"></a>特征值矩阵</h4><p>图像的特征值矩阵（描述矩阵）记录了图像的特征点以及每个特征点的梯度信息。相似图像的特征值矩阵也相似。这样只要有足够多的样本，就可以基于隐马尔科夫模型进行图像内容的识别。</p>
<p>特征值矩阵相关API：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># sift特征点检测  创建sift特征点检测器</span>
sift <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatrures2d<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取检测到的所有特征点</span>
keypoints <span class="token operator">=</span> sift<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取图像的特征值矩阵</span>
_<span class="token punctuation">,</span> desc <span class="token operator">=</span> sift<span class="token punctuation">.</span>compute<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> keypoints<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo08_feat.py  特征值矩阵
"""</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> mp

img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'../ml_data/green.jpg'</span><span class="token punctuation">)</span>
gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># sift特征点检测  创建sift特征点检测器</span>
sift <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatures2d<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取检测到的所有特征点</span>
keypoints <span class="token operator">=</span> sift<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取特征值矩阵</span>
_<span class="token punctuation">,</span> desc <span class="token operator">=</span> sift<span class="token punctuation">.</span>compute<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> keypoints<span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>desc<span class="token punctuation">.</span>T<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'jet'</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Description'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Feature'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Sample'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
mp<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="物体识别"><a href="#物体识别" class="headerlink" title="物体识别"></a>物体识别</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo09_jpg.py   物体识别
"""</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> hmmlearn<span class="token punctuation">.</span>hmm <span class="token keyword">as</span> hl


<span class="token keyword">def</span> <span class="token function">search_files</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    搜索directory目录下的所有jpg文件，返回字典
    """</span>
    directory <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>directory<span class="token punctuation">)</span>
    objects <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> curdir<span class="token punctuation">,</span> subdirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> \
            os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> file <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            <span class="token keyword">if</span> file<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                label <span class="token operator">=</span> curdir<span class="token punctuation">.</span>split<span class="token punctuation">(</span>
                    os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> label <span class="token operator">not</span> <span class="token keyword">in</span> objects<span class="token punctuation">:</span>
                    objects<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>curdir<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
                objects<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">return</span> objects

train_samples <span class="token operator">=</span> search_files<span class="token punctuation">(</span>
    <span class="token string">'../ml_data/objects/training'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 加载训练集样本数据，训练模型，存储模型</span>
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> label<span class="token punctuation">,</span> filenames <span class="token keyword">in</span> train_samples<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    descs <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>
        image <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>
            image<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 整理图片的大小 若宽度较小，则把宽度</span>
        <span class="token comment" spellcheck="true"># 缩放到200，高度自适应。若高度较小，</span>
        <span class="token comment" spellcheck="true"># 则把高度缩放到200，宽度自适应。</span>
        h<span class="token punctuation">,</span> w <span class="token operator">=</span> gray<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        f <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">/</span> min<span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> None<span class="token punctuation">,</span> fx<span class="token operator">=</span>f<span class="token punctuation">,</span> fy<span class="token operator">=</span>f<span class="token punctuation">)</span>
        sift <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatures2d<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
        keypoints <span class="token operator">=</span> sift<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> desc <span class="token operator">=</span> sift<span class="token punctuation">.</span>compute<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> keypoints<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>descs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            descs <span class="token operator">=</span> desc
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            descs <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                descs<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>descs<span class="token punctuation">)</span>
    train_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 训练隐马模型</span>
models <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> descs<span class="token punctuation">,</span> label <span class="token keyword">in</span> zip<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> hl<span class="token punctuation">.</span>GaussianHMM<span class="token punctuation">(</span>
        n_components<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> covariance_type<span class="token operator">=</span><span class="token string">'diag'</span><span class="token punctuation">,</span>
        n_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
    models<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>descs<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 模型测试</span>

test_samples <span class="token operator">=</span> search_files<span class="token punctuation">(</span>
    <span class="token string">'../ml_data/objects/testing'</span><span class="token punctuation">)</span>
test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> label<span class="token punctuation">,</span> filenames <span class="token keyword">in</span> test_samples<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    descs <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>
        image <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>
            image<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 整理图片的大小 若宽度较小，则把宽度</span>
        <span class="token comment" spellcheck="true"># 缩放到200，高度自适应。若高度较小，</span>
        <span class="token comment" spellcheck="true"># 则把高度缩放到200，宽度自适应。</span>
        h<span class="token punctuation">,</span> w <span class="token operator">=</span> gray<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        f <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">/</span> min<span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> None<span class="token punctuation">,</span> fx<span class="token operator">=</span>f<span class="token punctuation">,</span> fy<span class="token operator">=</span>f<span class="token punctuation">)</span>
        sift <span class="token operator">=</span> cv<span class="token punctuation">.</span>xfeatures2d<span class="token punctuation">.</span>SIFT_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
        keypoints <span class="token operator">=</span> sift<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> desc <span class="token operator">=</span> sift<span class="token punctuation">.</span>compute<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> keypoints<span class="token punctuation">)</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>descs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            descs <span class="token operator">=</span> desc
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            descs <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                descs<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>descs<span class="token punctuation">)</span>
    test_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>

<span class="token keyword">for</span> descs<span class="token punctuation">,</span> test_label <span class="token keyword">in</span> zip<span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> pred_label<span class="token punctuation">,</span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        score <span class="token operator">=</span> model<span class="token punctuation">.</span>score<span class="token punctuation">(</span>descs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>test_label<span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> pred_label<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">airplane <span class="token operator">-</span><span class="token operator">></span> airplane <span class="token operator">-</span><span class="token number">120454.03702592754</span>
airplane <span class="token operator">-</span><span class="token operator">></span> car <span class="token operator">-</span><span class="token number">121061.63978531306</span>
airplane <span class="token operator">-</span><span class="token operator">></span> motorbike <span class="token operator">-</span><span class="token number">119660.8862679648</span>
car <span class="token operator">-</span><span class="token operator">></span> airplane <span class="token operator">-</span><span class="token number">162306.35159566175</span>
car <span class="token operator">-</span><span class="token operator">></span> car <span class="token operator">-</span><span class="token number">161333.75710071798</span>
car <span class="token operator">-</span><span class="token operator">></span> motorbike <span class="token operator">-</span><span class="token number">162209.1739355846</span>
motorbike <span class="token operator">-</span><span class="token operator">></span> airplane <span class="token operator">-</span><span class="token number">292652.6592317896</span>
motorbike <span class="token operator">-</span><span class="token operator">></span> car <span class="token operator">-</span><span class="token number">294093.2031186345</span>
motorbike <span class="token operator">-</span><span class="token operator">></span> motorbike <span class="token operator">-</span><span class="token number">290136.95963470405</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="人脸识别"><a href="#人脸识别" class="headerlink" title="人脸识别"></a>人脸识别</h3><p>人脸识别与图像识别的区别在于人脸识别需要识别出两个人的不同点。</p>
<h4 id="视频捕捉"><a href="#视频捕捉" class="headerlink" title="视频捕捉"></a>视频捕捉</h4><p>使用opencv访问视频设备，获取图像帧。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token comment" spellcheck="true"># 获取视频设备</span>
video_capture <span class="token operator">=</span> cv<span class="token punctuation">.</span>videoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 调用方法读取视频设备捕获的一帧图片</span>
frame <span class="token operator">=</span> video_capture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
video_capture<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token comment" spellcheck="true"># 0：下标为0的设备</span>
vc <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Video Capture'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

vc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="人脸定位"><a href="#人脸定位" class="headerlink" title="人脸定位"></a>人脸定位</h4><p>哈尔级联人脸定位</p>
<pre class="line-numbers language-python"><code class="language-python">fd <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/face.xml'</span><span class="token punctuation">)</span>
ed <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/eye.xml'</span><span class="token punctuation">)</span>
nd <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/nose.xml'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 构建级联人脸定位器</span>
<span class="token comment" spellcheck="true"># 1.3: 物体的最小尺寸</span>
<span class="token comment" spellcheck="true"># 5:   查找物体的最大个数</span>
faces <span class="token operator">=</span> fd<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># faces: [(),(),(),() ...]</span>
<span class="token keyword">for</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
    a<span class="token punctuation">,</span> b <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>frame<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#  原图片</span>
               <span class="token punctuation">(</span>l <span class="token operator">+</span> a<span class="token punctuation">,</span> t <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># 椭圆心</span>
               <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#半径</span>
               <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 椭圆旋转角度</span>
               <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 起始角，终止角</span>
               <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># 椭圆颜色   线宽</span>
    <span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token triple-quoted-string string">"""
demo11_face.py 人脸定位
"""</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

fd <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/face.xml'</span><span class="token punctuation">)</span>
ed <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/eye.xml'</span><span class="token punctuation">)</span>
nd <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'../ml_data/haar/nose.xml'</span><span class="token punctuation">)</span>

vc <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 识别脸</span>
    faces <span class="token operator">=</span> fd<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>frame<span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>l <span class="token operator">+</span> a<span class="token punctuation">,</span> t <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 识别鼻子和眼睛</span>
        face <span class="token operator">=</span> frame<span class="token punctuation">[</span>t<span class="token punctuation">:</span>t <span class="token operator">+</span> h<span class="token punctuation">,</span> l<span class="token punctuation">:</span>l <span class="token operator">+</span> w<span class="token punctuation">]</span>
        eyes <span class="token operator">=</span> ed<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> eyes<span class="token punctuation">:</span>
            a<span class="token punctuation">,</span> b <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>
                face<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> a<span class="token punctuation">,</span> t <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        nose <span class="token operator">=</span> nd<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>face<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> nose<span class="token punctuation">:</span>
            a<span class="token punctuation">,</span> b <span class="token operator">=</span> int<span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>
                face<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> a<span class="token punctuation">,</span> t <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Video'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
vc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<p>感谢我的朋友郭伟|Welian的汇总，这里我直接存放了他整理的内容．<br>博主最近时间不够充足，内容没有精力分块重新整合，见谅．<br>老规矩，如发现错误请不要吝啬，发邮件给博主更正内容，在此提前鸣谢．<br>Email: <a href="mailto:JentChang@163.com" target="_blank" rel="noopener">JentChang@163.com</a> （来信请注明文章标题，如果附带链接就更方便了）</p>

            </div>
            <hr>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">转载请注明: </span>
                    <a href="http://JentChang.github.io" class="b-link-green">简•客</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2019/02/26/ml-api/" class="b-link-green">机器学习基础：汇总　</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'qpXDIEw3JS2hKTceQz0VwJYI-gzGzoHsz',
        appKey: 'OdlNEyEHisewPTvSysbhzbXj',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '5',
        lang: 'zh-cn',
        placeholder: '请在上行点击输入昵称,邮箱和任意正确格式的网址后在这里留言'
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">上一篇</div>
            <div class="card">
                <a href="/2019/02/27/case-facerecognition/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="案例：人脸识别导图　">
                        
                        <span class="card-title">案例：人脸识别导图　</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">

老规矩，如发现错误请不要吝啬，发邮件给博主更正内容，在此提前鸣谢．Email: JentChang@163.com （来信请注明文章标题，如果附带链接就更方便了）
</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-02-27
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/MachineLearning/" class="post-category" target="_blank">
                                    MachineLearning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/MTCNN/" target="_blank">
                        <span class="chip bg-color">MTCNN</span>
                    </a>
                    
                    <a href="/tags/神经网络/" target="_blank">
                        <span class="chip bg-color">神经网络</span>
                    </a>
                    
                    <a href="/tags/卷积/" target="_blank">
                        <span class="chip bg-color">卷积</span>
                    </a>
                    
                    <a href="/tags/人脸识别/" target="_blank">
                        <span class="chip bg-color">人脸识别</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">下一篇</div>
            <div class="card">
                <a href="/2019/01/23/stats-47/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="统计学47：假设检验和p值">
                        
                        <span class="card-title">统计学47：假设检验和p值</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">统计学•目录 统计学•类别  math

假设检验和p值
博主个人能力有限，错误在所难免．如发现错误请不要吝啬，发邮件给博主更正内容，在此提前鸣谢．Email: JentChang@163.com （来信请注明文章标题，如果附带链接就更方便</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-01-23
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Statistical/" class="post-category" target="_blank">
                                    Statistical
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Statistical/" target="_blank">
                        <span class="chip bg-color">Statistical</span>
                    </a>
                    
                    <a href="/tags/Math/" target="_blank">
                        <span class="chip bg-color">Math</span>
                    </a>
                    
                    <a href="/tags/假设检验/" target="_blank">
                        <span class="chip bg-color">假设检验</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 简•客<br />'
            + '作者: Jent｜张通<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>

    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title">目录</div>
            <div id="toc-content">

            </div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&copy2018-2019 <a href="https://JentChang.github.io/about/" target="_blank">简۰客　</a> 
            <a href="https://JentChang.github.io/" target="_blank">JentChang.github.io</a>　一个基于python量化交易主题的博客　Blogger:
            <a href="https://github.com/JentChang" target="_blank">Jent｜张通</a>　Email:JentChang@163.com
        </div>
        <div class="col s12 m4 l4 social-link"><a href="https://github.com/JentChang" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:JentChang@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 1556915227" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title">搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input" autofocus>
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>

<script src="/libs/others/clicklove.js"></script>

<script src="/js/matery.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->


</body>
</html>